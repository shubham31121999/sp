"use strict";var f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e});var D,F,_,U,H,W,q,z,V,G,j,K,Y,Z,J,Q,X,ee,te,ne,ae,oe,re,ie,o,l,se,le,de,h,ce,e,ue,m,t,me,pe,ge,fe,ve,he,ye,d,i,T,n,Ce,E,b,Te,Ee,p,be,Se,r,Ie,we,xe,Me,s,c,u,g={},v=13,y=27,C="_kenytUserId_",S="_kenytIsNewUserId_",Le="_kenytviewstate_",I="MessageHub",ke="_kenytsessionstate_",w=":",x={CONTACT_FORM:{Trigger:"Open Lead Form"},APPOINTMENT_FORM:{Trigger:"Open Appointment Form"},ADDRESS_FORM:{Trigger:"Open Address Form"},LATLONG_FORM:{Trigger:"Open GeoLocation Form"},FIREBASE_FORM:{Trigger:"Open Firebase Form"},FILE_UPLOAD:{Trigger:"Open Upload Form"},CALLER:{Trigger:"Open Caller"},OTP:{Trigger:"Open OTP Form"},GENERIC_FORM:{Trigger:"Open Generic Form"},NAVIGATE:{Trigger:"NavigateTo",Pattern:/^NavigateTo\s*:\s*\[.*\]\(.*\)$/i},SETTINGS_OVERRIDE:{Trigger:"UpdateUxSettings",Pattern:/^UpdateUxSettings\s*:\s*.*$/i},SET_LANGUAGE:{Trigger:"Set Language"},SET_SESSION:{Trigger:"Set Session"},NOTIFY_LEAD_CAPTURE:{Trigger:"Notify Lead Capture"},NOTIFY_TYPING:{Trigger:"Notify Typing"},OPEN_RAZORPAY_BUTTON:{Trigger:"Open Razorpay Button"},OPEN_CASHFREE_BUTTON:{Trigger:"Capture Cashfree Payment"}},M="phone::",L="Intl Tel Input Plugin",k="../ChatbotUI/external/IntlTelInput/utils.js",A="_EMPTY_",N="en",R="kenytUnreadMessage",P=/(http|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/i,O=/\[.*\]\(.*\)/,B=/[\d]{4,}/,Ae={TRACKING_ID:"UA-64989543-27",EVENT_INITIAL_LOAD:"initial_event",EVENT_DOCUMENT_READY:"document_ready",EVENT_COOKIES_DISABLED:"cookies_disabled",EVENT_LOAD_CHAT_REQUESTED:"load_chatbot_requested",EVENT_LOAD_CHAT_RECEIVED:"load_chatbot_received",EVENT_LOAD_CHAT_INTIME:"load_chatbot_intime",EVENT_VALID_BOT_ID:"valid_botid",EVENT_AUTO_MESSAGE_REQUESTED:"auto_message_requested",EVENT_AUTO_MESSAGE_SKIPPED:"auto_message_skipped",EVENT_AUTO_MESSAGE_RECEIVED:"auto_message_received",EVENT_FIRST_USER_REQUEST:"first_user_request",EVENT_INITIALIZE_CONNECTION:"initialize_connection",EVENT_FIRST_BOT_RESPONSE:"first_bot_response",EVENT_MESSAGE_SENT:"client_message_sent",EVENT_MESSAGE_RECEIVED:"client_message_received",EVENT_MESSAGE_DELAY:"reply_delay",EVENT_MESSAGE_UNSUCCESSFUl:"client_message_unsuccessful",EVENT_MESSAGE_ABANDONED:"client_message_abandoned",EVENT_MESSAGE_FAILED:"client_message_failed",EVENT_LOCATION_OBTAINED:"location_obtained",EVENT_LOCATION_DENIED:"location_denied",DISCONNECT_IDLE_USER:"disconnect_idle_user"},Ne=750,Re="/signalr",Pe="/api/botsetup/loadchatwindow",Oe="",Be="",De="/botapp",Fe={PROD:"/dashboard",LOCAL:"http://localhost:4200"},_e=5,Ue=3,He=1440,We={TYPING_INDICATOR:"TypingIndicator",SENDER_DETAILS:"MessageSenderInfo",OTP_FORM:"OTPForm",PHONE_NUMBER_FORM:"PhoneNumberForm",SHOW_MORE_BUTTON:"ShowMoreButton",SMALL_BUTTON_CARD:"SmallButtonCard",MEDIUM_BUTTON_CARD:"MediumButtonCard",VISITING_CARD:"VisitingCard",VERTICAL_CARD:"VerticalCard",CARD_BUTTON:"CardButton",HEADER_MENU_ITEM:"HeaderMenuItem",FILE_CARD:"FileCard",LOCATION_CARD:"LocationCard",FOOTER_MENU:"FooterMenu",INTERACTIVE_CARD:"InteractiveList",INTERACTIVE_MENU_CARD:"ShowInteractiveMenuButton"},qe="enable-on-bot-reply",ze=[{text:"Afrikaans",value:"af",displayText:"Afrikaans"},{text:"Albanian",value:"sq",displayText:"shqipe"},{text:"Amharic",value:"am"},{text:"Arabic",value:"ar",displayText:"العَرَبِيَّة"},{text:"Armenian",value:"hy",displayText:"Հայերեն"},{text:"Azerbaijani",value:"az",displayText:"azərbaycan dili"},{text:"Basque",value:"eu",displayText:"euskara"},{text:"Belarusian",value:"be",displayText:"беларуская мова"},{text:"Bengali",value:"bn",displayText:"বাংলা"},{text:"Bosnian",value:"bs",displayText:"Bosanski Jezik"},{text:"Bulgarian",value:"bg",displayText:"български език"},{text:"Catalan",value:"ca",displayText:"català"},{text:"Cebuano",value:"ceb",displayText:"Cebuano"},{text:"Chadic",value:"ha",displayText:"Harshen Hausa"},{text:"Chinese (Mandarin)",value:"zh-CN",displayText:"中文"},{text:"Chinese(Traditional)",value:"zh-TW"},{text:"Corsican",value:"co",displayText:"Espanol - CO"},{text:"Croatian",value:"hr",displayText:"Hrvatski Jezik"},{text:"Czech",value:"cs",displayText:"český jazyk"},{text:"Danish",value:"da",displayText:"Dansk"},{text:"Dutch",value:"nl",displayText:"Nederlands"},{text:"English",value:"en"},{text:"Esperanto",value:"eo",displayText:"Esperanto"},{text:"Estonian",value:"et",displayText:"Eesti"},{text:"Filipino",value:"fl",displayText:"Pilipino"},{text:"Finnish",value:"fi",displayText:"Suomi"},{text:"French",value:"fr",displayText:"Français"},{text:"Frisian",value:"fy"},{text:"Galician",value:"gl",displayText:"Galego"},{text:"Georgian ",value:"ka",displayText:"ქართული"},{text:"German",value:"de",displayText:"Deutsch"},{text:"Greek",value:"el",displayText:"ελληνικά"},{text:"Gujarati",value:"gu",displayText:"ગુજરાતી"},{text:"Haitian Creole",value:"ht",displayText:"Kreyol Ayisyen"},{text:"Hausa",value:"ha ",displayText:"هَوُسَ"},{text:"Hawaiian",value:"haw"},{text:"Hebrew",value:"he",displayText:"עברית"},{text:"Hindi",value:"hi",displayText:"हिन्दी"},{text:"Hmong",value:"hmn",displayText:"Hmong"},{text:"Hungarian",value:"hu",displayText:"magyar"},{text:"Icelandic",value:"is",displayText:"Islenka"},{text:"Igbo",value:"ig",displayText:"Ásụ̀sụ̀"},{text:"Indonesian",value:"id",displayText:"Indonesia"},{text:"Irish",value:"ga",displayText:"Gaeilge"},{text:"Italian",value:"it",displayText:"Italiano"},{text:"Japanese",value:"ja",displayText:"日本語"},{text:"Javanese",value:"jv",displayText:"Basa Jawa"},{text:"Javanese",value:"jw"},{text:"Kannada",value:"kn",displayText:"ಕನ್ನಡ"},{text:"Kazakh",value:"kk",displayText:"қазақ тілі"},{text:"Khmer",value:"km    ",displayText:"ខ្មែរ,"},{text:"Korean",value:"ko",displayText:"한국어"},{text:"Kurdish",value:"ku"},{text:"Kyrgyz",value:"ky"},{text:"Lao",value:"lo",displayText:"ພາສາລາວ"},{text:"Latin",value:"la",displayText:"Latine"},{text:"Latvian",value:"lv",displayText:"latviešu valoda"},{text:"Lithuanian",value:"lt",displayText:"lietuvių kalba"},{text:"Luxembourgish",value:"lb"},{text:"Macedonian",value:"mk",displayText:"македонски јазик"},{text:"Malagasy",value:"mg",displayText:"Malagasy"},{text:"Malay",value:"ms",displayText:"Bahasa Melayu"},{text:"Malayalam",value:"ml",displayText:"മലയാളം"},{text:"Maltese",value:"mt",displayText:"Malti"},{text:"Maori",value:"mi",displayText:"Māori"},{text:"Marathi",value:"mr",displayText:"मराठी"},{text:"Mongolian",value:"mn",displayText:"монгол"},{text:"Myanmar(Burmese)",value:"my"},{text:"Nepali",value:"ne",displayText:"नेपाली"},{text:"Norwegian",value:"no",displayText:"Norsk"},{text:"Nyanja",value:"ny",displayText:"Chichewa"},{text:"Odia",value:"or",displayText:"ଓଡିଆ"},{text:"Pashto",value:"ps"},{text:"Persian",value:"fa"},{text:"Polish",value:"pl",displayText:"Polski"},{text:"Portuguese(Portugal, Brazil)",value:"pt",displayText:"Português"},{text:"Punjabi",value:"pa",displayText:"ਪੰਜਾਬੀ"},{text:"Romanian",value:"ro",displayText:"limba română "},{text:"Russian",value:"ru",displayText:"русский язык"},{text:"Samoan",value:"sm"},{text:"Scots Gaelic",value:"gd",displayText:"Gàidhlig na h-Alba"},{text:"Serbian",value:"sr",displayText:"српски језик"},{text:"Shona",value:"sn"},{text:"Sindhi",value:"sd"},{text:"Sinhala(Sinhalese)",value:"si",displayText:"සිංහල"},{text:"Slovak",value:"sk",displayText:"slovenčina"},{text:"Slovenian",value:"sl",displayText:"Slovenski Jezik"},{text:"Somali",value:"so",displayText:"Soomaali"},{text:"Spanish",value:"es",displayText:"Español"},{text:"Southern Sotho",value:"st",displayText:"Sesotho"},{text:"Sundanese",value:"su",displayText:"Basa Sunda"},{text:"Swahili",value:"sw",displayText:"Kiswahili"},{text:"Swedish",value:"sv",displayText:"Sverige"},{text:"Tagalog(Filipino)",value:"tl"},{text:"Tajik",value:"tg",displayText:"тоҷикӣ"},{text:"Tamil",value:"ta",displayText:"தமிழ்"},{text:"Telugu",value:"te",displayText:"తెలుగు"},{text:"Thai",value:"th",displayText:"ไทย"},{text:"Turkish",value:"tr",displayText:"Türkçe"},{text:"Ukrainian",value:"uk",displayText:"українська мова"},{text:"Urdu",value:"ur",displayText:"اُردُو"},{text:"Uzbek",value:"uz",displayText:"Oʻzbek"},{text:"Vietnamese",value:"vi",displayText:"Tiếng Việt"},{text:"Welsh",value:"cy"},{text:"Xhosa",value:"xh"},{text:"Yiddish",value:"yi",displayText:"ייִדיש"},{text:"Yoruba",value:"yo",displayText:"Ede Yorùbá"},{text:"Zulu",value:"zu",displayText:"isiZulu"}],Ve={EMAIL_VALIIDATION_PATTERN:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,PHONE_VALIDATION_SOURCE:L,URL_VALIIDATION_PATTERN:/^(http[s]?:\/\/)?(www\.)?(\w)+\.(\w)+([\/.][\w-#]*)*$/},Ge=detectAppName(),je=Ge+Re,Ke=Ge+Pe,$e=Ge+"/api/file/upload",Ye=Ge+"/api/tracking/ingestevents",Ze=Ge+"/api/tracking/ping",Je=Ge+"/api/genericbot/<botId>/updatefcmtoken",Qe={None:0,Thumbnail:1,Hero:2,Image:3,Gif:4,Video:5,QuickLink:6,SmallButton:7,MediumButton:8,VisitingCard:9,VerticalCard:10,Location:11,File:12,FooterMenu:13,InteractiveList:101},Xe=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CUP","CVF","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ESK","ETB","EUR","FJD","FKP","GBP","GEL","GGP","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LTL","LVL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRO","MRU","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VEF","VND","VUV","WST","XAF","XAG","XAU","XCD","XDR","XOF","XPF","YER","ZAR","ZMK","ZMW","ZWD"],et={UserMessage:1,AutoMessage:2,ManualMessage:3},tt={SetCustomContext:"kenytSetCustomContext",UnreadMessage:"kenytUnreadMessage",ChatWindowClose:"kenytChatWindowClose",ChatWindowBack:"kenytChatWindowBack",ChatWindowOpen:"kenytChatWindowOpen",FullScreenImage:"kenytFullScreenImage",NavigateToPage:"kenytNavigateToPage",ToggleFullScreen:"kenytToggleFullscreen",ForceFullHeight:"kenytForceFullHeight",TextColor:"kenytTextColor",IsWindowMinimizedResponse:"kenytIsWindowMinimizedResponse",WindowHover:"kenytWindowHover",GetPageTitle:"kenytPageTitle",GetReferrer:"kenytPageReferrer",Initialize:"kenytInitialize",FirebaseToken:"kenytFirebaseToken",PageInfoRequest:"kenytPageInfoRequest",PageInfoResponse:"kenytPageInfoResponse",CustomEventDispatch:"kenytCustomEventDispatch",SettingsUpdate:"kenytSettingsUpdate",UpdateChatBubbleColor:"kenytUpdateChatBubbleColor",UpdateAttentionMessage:"kenytUpdateAttentionMessage",UpdateBotPosition:"kenytUpdateBotPosition",MediaStreamingCommand:"kenytMediaStreamingCommand",SendMessage:"kenytSendMessage",ReportGoogleAnalyticsEvent:"reportGoogleAnalyticsEvent",OpenRazorpayForm:"kenytOpenRazorpayForm",SubmitRazorpayPayment:"kenytSubmitRazorpayPayment",FormSubmission:"kenytFormSubmission",OpenCashfreeForm:"kenytOpenCashfreeForm",SubmitCashfreePayment:"kenytSubmitCashfreePayment",UserGeneratedEvent:"user_generated_event",UpdateSssionPing:"update_session_ping"},nt={Load:"kenyt_Load",ChatStart:"kenyt_ChatStart",ContactFormSubmit:"kenyt_ContactFormSubmit",GenericFormSubmit:"kenyt_GenericFormSubmit",UserMessage:"kenyt_UserMessage",UserQueryResponse:"kenyt_UserQueryResponse",ChatWindowClose:"Kenyt_ChatWindowClose",ChatWindowBack:"Kenyt_ChatWindowBack",BotMessage:"Kenyt_BotMessage"},at={Form:"Form"},ot={SessionCount:1,ManualModeAtStart:!1},rt=!1,it={},st={},lt=!0,dt={},ct=!1,ut={pageStartAt:null,isSkipped:!0,isSent:!1,isSentAck:!1,isReceived:!1,sentAt:null,receivedAt:null},mt={FrameColor:"",FrameColorGradient:"",BubbleBackgroundColor:"",HeaderTitle:"Automated Live Chat",HeaderSubTitle:"Online",EnableSpeech:"False",EnableQRFeature:"False",ManualModeAtStart:"False",HeaderFontSize:"",HeaderTextColor:"#ffffff",FontSize:"",FontFamily:"",UserChatBubbleColor:"",UserChatBubbleColorGradient:"",BotChatBubbleColor:"#ffffff",PlaceholderText:"Type your message...",ShowPoweredBy:"True",PoweredBy:{},BotTextColor:"#000",UserTextColor:"#000",BackgroundImage:"",BackgroundColor:"",CustomPanelCss:"",HeaderImage:"/api/botsetup/getimage?imagetype=chatbubble-icon&botid=",HeaderShowOnline:"False",DesktopMinimizeBotAtStart:"True",MobileMinimizeBotAtStart:"True",OpenWindowAfterMilliSeconds:"0",Languages:"",UserPersona:"you",BotPersona:"chatbot",AttentionMessage:"",LiveAgentCall:"False",HideMenuInHeader:"False",IdleTimeoutSeconds:0,WindowStyle:"style1",Announcement:"",EnableAgentChatFeedback:"False"},pt={adaptiveHeight:!0,dots:!1,mobileFirst:!0,arrows:!0,autoplay:!0,autoplaySpeed:5e3,rtl:!1},gt=[],ft={},vt={headerMenu:{container:null,content:null},footerMenu:{container:null,content:null}},ht=[],yt=!1,Ct=!0,Tt=1,Et=1,bt=!1,St=!1,It=!1,wt={senderDetailsView:null,indicatorView:null},xt={"See Details":"See Details",Submit:"Submit","None of the above":"None of the above","Contact Information":"Contact Information","Please enter your contact details":"Please enter your contact details",Name:"Name",Email:"Email",Phone:"Phone",Mobile:"Mobile"},Mt={},Lt={},kt="style1";function updateButtonTexts(e){if(e)for(var t in e)Lt[t]=e[t]}updateButtonTexts(xt);var At,Nt,Rt,Pt,Ot={audio:!0},Bt=null,Dt={},Ft=null,_t={lastFocusedAt:null,idleTimeSec:0,isActiveSignalSent:!1,stopTimingTimeOut:null},Ut=!1;function capitalizeKeys(e){if(null===e||"object"!==(void 0===e?"undefined":a(e)))return e;var t=Array.isArray(e)?[]:{};for(var n in e){if(e.hasOwnProperty(n))t[n.charAt(0).toUpperCase()+n.slice(1)]=capitalizeKeys(e[n])}return t}window.dataLayer=window.dataLayer||[],initializeGoogleAnalytics();var Ht=!(window.KENYT_API={currentForm:null,onFormInputChange:null});function notifyParentKenytLoad(){gtag("event",Ae.EVENT_DOCUMENT_READY);var e=new URLSearchParams(window.location.search),t=e.get("setuserdataforbot"),P=e.get("enablePortal"),O="true"===e.get("hideChatHistory"),B="null"===e.get("kenytStartIntent")?null:e.get("kenytStartIntent");notifyParentAndListenCallback(tt.CustomEventDispatch,{EventName:nt.Load,EventData:{botId:ce}},t,function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=B;if(t&&(fe||(fe={}),t.name&&(fe.name=t.name),t.mobile&&(fe.mobile=t.mobile),t.email&&(fe.email=t.email),t.hasOwnProperty("selectedConversationId")&&null!==t.selectedConversationId&&(de=null)),Tt=1,D=document.querySelector("#chatWindow"),F=document.querySelector("#chatWindowHeader"),_=document.querySelector("#headerIconContainer"),U=document.querySelector("#headerImage"),H=document.querySelector("#headerOnlineIcon"),W=document.querySelector("#headerTitle"),q=document.querySelector("#headerSubTitle"),z=document.querySelector("#chatWindowBody"),G=document.querySelector("#chatInput"),j=document.querySelector("#chatActions"),K=document.querySelector("#sendButton"),Y=document.querySelector("#speechButton"),Z=document.querySelector("#cameraButton"),J=document.querySelector("#cameraOverlay"),Q=document.querySelector("#callButton"),Te=document.querySelector("#announcement"),vt.headerMenu.container=document.querySelector("#menuContainer"),vt.footerMenu.container=document.querySelector("#footer-menu"),vt.footerMenu.optionsContainer=document.querySelector("#footer-menu-options"),vt.footerMenu.menuline=document.querySelector(".menu-line"),vt.footerMenu.hidden=!0,vt.footerMenu.container.addEventListener("click",function(){if(vt.footerMenu.container.classList.contains("footer-minimized"))renderInteractiveMenu(vt.footerMenu.contentElement),vt.footerMenu.menuline.style.display="none";else{if(vt.footerMenu.container.classList.remove("open"),vt.footerMenu.container.classList.add("footer-minimized"),D.classList.remove("footer-menu"),vt.footerMenu.isOpen=!1,vt.footerMenu.referenceElement){var e=vt.footerMenu.optionsContainer.getElementsByClassName("interactive-menu-options");e&&0<e.length&&((e=e[0]).classList.add("d-none"),vt.footerMenu.referenceElement.appendChild(e))}vt.footerMenu.hidden&&vt.footerMenu.container.classList.add("footer-hidden"),vt.footerMenu.menuline.style.display="block"}}),vt.footerMenu.closeElement=document.querySelector("#footer-menu-closed"),vt.footerMenu.contentElement=document.querySelector("#footer-menu-content"),X=document.querySelector("#languageButton"),V=document.querySelector("#messageContainer"),ee=document.querySelector("#poweredByText"),te=ee.children[0],ne=document.querySelector("#chatWindowFooter"),ae=document.querySelector("#headerMaximizeMinimizeButton"),oe=document.querySelector("#headerCloseButton"),re=document.querySelector("#headerBackButton"),Ce=document.querySelector("#stopSpeech"),Ee=document.querySelector("#announcementCloseButton"),ie={},chatwindowHeaderTitleFix(),"true"!==P&&re.classList.add("k-hide"),pe=getParentUrl(),ce=getUrlParam("botid"),me="1"===getUrlParam("test")||0<ce.indexOf("-test"),ue=getUrlParam("userid",pe),ve=getUrlParam("hash"),mt.HeaderImage.includes("botid=")){var e=mt.HeaderImage.split("botid=")[1];e&&""!==e.trim()||(mt.HeaderImage=(isLocalEnvironment()?"":"/botapp")+mt.HeaderImage+ce)}mt.backgroundImage&&(mt.BackgroundImage=(isLocalEnvironment()?"":"/botapp")+mt.BackgroundImage+ce),Me=!1,ye=Le+ce+"_"+ve,he=ke+ce+"_"+ve,Ie=[],t&&t.hasOwnProperty("conversationMessages")&&null!==t.conversationMessages&&(t.conversationMessages=t.conversationMessages.map(function(e){return e.message&&(e.message=capitalizeKeys(e.message)),e}),Ie=t.conversationMessages),xe=testLocalStorage(),disableLoggingIfProduction(St=isLocalEnvironment()),xe||isLocalEnvironment()||gtag("event",Ae.EVENT_COOKIES_DISABLED,eventData("browser_info")),restoreUserIdIfExists();var a=retrieveLocalStateIfExists();ot=a&&a.botUserWebContext?a.botUserWebContext:ot,ft.previousStateLoaded=!1,a?t&&(t.hasOwnProperty("conversationMessages")&&null!==t.conversationMessages||t.hasOwnProperty("selectedConversationId")&&null!==t.selectedConversationId)?""!==t.conversationMessages&&(a.messages=t.conversationMessages,restoreState(a,O)):(console.debug("Found previous state, restoring.."),restoreState(a,O)):(Ie=[],console.debug("No previous state found")),ft.previousStateLoaded=!0;var o=retrieveSessionStateIfExists();o?(console.debug("Found previous session state, restoring..."),restoreSessionState(o),Ct=!1,o.queryUserDenied&&(ue=null)):console.debug("No previous session state found");var r=!1,i=!1;if(Ie&&0!=Ie.length){if(Ie.forEach(function(e){e.isUserMessage&&(Me=!0)}),Me?i=!(r=!1):(i=!(r=!0),clearChat()),pe&&!pe.includes("?")&&o){var s=o.pageUrl,l=s.indexOf("?");0<l&&(pe+=s.substring(l))}}else i=!(r=!0);var d=Ke+"?botId="+ce,c=new XMLHttpRequest;if(c.open("POST",d,!0),c.setRequestHeader("Content-type","application/json"),!ge){ge={};var u=(C=new URL(window.location.href)).searchParams.keys(),m=!0,p=!1,g=void 0;try{for(var f,v=u[Symbol.iterator]();!(m=(f=v.next()).done);m=!0){var h=f.value,y=h;y.startsWith("context-")&&(y=y.substring(8),ge[y]=C.searchParams.get(h))}}catch(e){p=!0,g=e}finally{try{!m&&v.return&&v.return()}finally{if(p)throw g}}}if(!fe){fe={};var C,T=(C=new URL(window.location.href)).searchParams.keys(),E=!0,b=!1,S=void 0;try{for(var I,w=T[Symbol.iterator]();!(E=(I=w.next()).done);E=!0){var x=I.value,M=x;M.startsWith("user-")&&(M=M.substring(5),fe[M]=C.searchParams.get(x))}}catch(e){b=!0,S=e}finally{try{!E&&w.return&&w.return()}finally{if(b)throw S}}}null!=n&&(r=!1);var L={IsTest:me,SessionUserId:se,IsNewSessionUserId:le,QueryClientUserId:ue,ConversationId:de,ConversationLanguage:we||"",TimezoneOffsetMinutes:-1*(new Date).getTimezoneOffset(),SourceUrl:pe,TriggerAutoMessage:r,InitializeConnection:i,ConversationContext:ge,User:fe};t&&t.hasOwnProperty("selectedConversationId")&&(""===(de=t.selectedConversationId.split("_").pop())&&(de=null),L={IsTest:me,SessionUserId:se,IsNewSessionUserId:!1,QueryClientUserId:ue,ConversationId:de,ConversationLanguage:we||"",TimezoneOffsetMinutes:-1*(new Date).getTimezoneOffset(),SourceUrl:pe,TriggerAutoMessage:null===de,InitializeConnection:i,ConversationContext:ge,User:fe});var k,A,N,R=JSON.stringify(L);c.onload=function(e){document.getElementById("chatLoader").style.display="none",t&&t.hasOwnProperty("userData")&&t.userData?handleLoadChatWindowResponse(e,t.userData):handleLoadChatWindowResponse(e),n&&sendMessageToServer(n,n)},c.onerror=function(){document.getElementById("chatLoader").style.display="none"},gtag("event",Ae.EVENT_LOAD_CHAT_REQUESTED),Dt.requestedAt=new Date,c.send(R),document.getElementById("chatLoader").style.display="flex",gtag("event",r?Ae.EVENT_AUTO_MESSAGE_REQUESTED:Ae.EVENT_AUTO_MESSAGE_SKIPPED),(window.hasOwnProperty("webkitSpeechRecognition")||window.hasOwnProperty("SpeechRecognition"))&&((be=new(window.webkitSpeechRecognition||window.SpeechRecognition)).lang="en-IN",be.onerror=function(e){"no-speech"===e.error?console.warn("No speech detected"):(trackError({message:"Speech recognition error: "+e},!1),console.warn(e))},be.onstart=function(e){setInputPlaceholderText("Listening... say something"),Y.classList.add("blink")},be.onend=function(e){setInputPlaceholderText(ie.PlaceholderText||mt.PlaceholderText),Y.classList.remove("blink")},be.onnomatch=function(e){console.warn("Failed to recognize speech")},be.onresult=function(e){var t=e.results[0][0].transcript;isNonEmptyString(t)&&(bt=!0,sendMessageToServer(t,t))},window.speechSynthesis&&(window.speechSynthesis.onerror=function(e){console.error("Error in speech synthesis"),console.error(e),trackError({message:"Text to speech error: "+e},!1)})),window.navigator&&(window.navigator.browserInfo=(A=navigator.userAgent,N=A.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(N[1])?"IE "+((k=/\brv[ :]+(\d+)/g.exec(A)||[])[1]||""):"Chrome"===N[1]&&null!=(k=A.match(/\b(OPR|Edge)\/(\d+)/))?k.slice(1).join(" ").replace("OPR","Opera"):(N=N[2]?[N[1],N[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(k=A.match(/version\/(\d+)/i))&&N.splice(1,1,k[1]),N.join(" ")))),registerEventListeners(),Se={isInitializing:!1,isConnected:!1,tryingToReconnect:!1},isMobileDevice()&&showElements(ae)})}function handleInput(){sendTypingResponse()}$(document).ready(function(){var e=new URLSearchParams(window.location.search);Ht="true"===e.get("enableMessageFeedback"),"false"===e.get("enablePortal")&&notifyParentKenytLoad()});var Wt=!1,qt=null;function sendTypingResponse(){var e={BotClientId:E?E.BotId:0,ConversationId:de,UserId:se,IsTyping:"true",Description:document.getElementById("chatInput").value};Se&&Se.isConnected?(Wt||l.invoke("UserTypingIndicator",e),qt&&clearTimeout(qt),qt=setTimeout(function(){return stopTypingResponse(e)},3e3)):initializeServerConnection()}function stopTypingResponse(e){Wt=!1,e.IsTyping=!1,Se&&Se.isConnected?l.invoke("UserTypingIndicator",e):initializeServerConnection()}function handleLoadChatWindowResponse(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;gtag("event",Ae.EVENT_LOAD_CHAT_RECEIVED),Dt.receivedAt=new Date;var n=!1;try{var a=JSON.parse(e.target.response);if(a){if(me=a.IsTest,a.OrgBot&&(E=a.OrgBot,gtag("event",Ae.EVENT_VALID_BOT_ID)),a.ConversationId&&handleConversationId(a.ConversationId),a.Response&&(handleBotResponse(a.Response),gtag("event",Ae.EVENT_AUTO_MESSAGE_RECEIVED)),a.InitializeConnection&&(n=!0),applyWindowStyling(mt),a.WindowConfiguration&&(a.WindowConfiguration.Properties&&(applyWindowStyling(ie=extractWindowConfig(a.WindowConfiguration.Properties)),Mt.HeaderTitle=ie.HeaderTitle||mt.HeaderTitle,Mt.HeaderSubTitle=ie.HeaderSubTitle||mt.HeaderSubTitle,h=ie.EnableAgentChatFeedback),a.WindowConfiguration.Javascript&&a.WindowConfiguration.Javascript.forEach(function(e){var t=document.createElement("script");t.setAttribute("src",e),t.type="text/javascript",document.head.appendChild(t)})),a.QueryUserDetails){var o=document.createElement("div"),r=document.createElement("p");if(r.innerText="Would you like to continue as",o.appendChild(r),a.QueryUserDetails.MaskedEmail){var i=document.createElement("p");i.innerText=a.QueryUserDetails.MaskedEmail,o.appendChild(i)}if(a.QueryUserDetails.MaskedPhone){var s=document.createElement("p");s.innerText=a.QueryUserDetails.MaskedPhone,o.appendChild(s)}var l=document.createElement("div");l.classList.add("card-thumbnail","text-center","mt-1"),o.appendChild(l);var d=document.createElement("div");d.classList.add("option-pill","pointer"),d.innerText="Yes",l.appendChild(d);var c=document.createElement("div");c.classList.add("option-pill","pointer"),c.innerText="No",l.appendChild(c),d.addEventListener("click",function(e){a&&a.QueryUserId&&handleUserId(a.QueryUserId),window.setTimeout(function(){sendMessageToServer("",null,!0,!0)},0),d.disabled=!0,c.disabled=!0}),c.addEventListener("click",function(e){m=!0,a&&a.SessionUserId&&handleUserId(a.SessionUserId),window.setTimeout(function(){sendMessageToServer("",null,!0,!0)},0),d.disabled=!0,c.disabled=!0});var u=createBotChatBubble();u.classList.add("w-95"),u.appendChild(o),addToChatWindow(u)}else a.SessionUserId&&handleUserId(a.SessionUserId,a.IsNewSessionUserId);a.LanguageSettings&&handleLanguageSettings(a.LanguageSettings)}}catch(e){e.message="load chatbot error:: "+(e&&e.message||""),trackError(e)}(n&&initializeServerConnection(),Dt.requestedAt&&Dt.receivedAt)&&((Dt.receivedAt.valueOf()-Dt.requestedAt.valueOf())/1e3<Ue&&gtag("event",Ae.EVENT_LOAD_CHAT_INTIME));(z.classList.remove("d-none"),ie.Announcement&&showAnnouncement(),t)&&sendMessageToServer(Object.entries(t).map(function(e){var t=f(e,2);return t[0]+"::"+t[1]}).join(", "),null,!1,!1,!1,void 0,void 0,void 0)}function requestGeoLocation(){window.navigator.geolocation&&window.navigator.geolocation.getCurrentPosition(function(e){u=e.coords,gtag("event",Ae.EVENT_LOCATION_OBTAINED),sendMessageToServer("Coordinates::"+e.coords.latitude+" "+e.coords.longitude)},function(e){sendMessageToServer("Coordinates denied by user"),console.warn("[Kenyt.AI] Location permission denied"),gtag("event",Ae.EVENT_LOCATION_DENIED)},{enableHighAccuracy:!0})}function requestFirebaseNotification(){notifyParent(tt.FirebaseToken)}function getUrlParam(e,t){return t=t||window.location.href,new URL(t).searchParams.get(e)}function gtag(){window.dataLayer.push(arguments)}function trackError(e,t){var n=e&&e.lineno||"0",a=e&&e.colno||"0",o="["+(e&&e.filename||"unknown-file")+":"+n+":"+a+"] "+(e&&e.message||"null");isLocalEnvironment()||gtag("event","exception",{description:o,fatal:t||!1})}function initializeGoogleAnalytics(){var e=getUrlParam("botid");isLocalEnvironment()&&(window["ga-disable-"+Ae.TRACKING_ID]=!0),gtag("js",new Date);var t=getUrlParam("googleAnalyticsId");t||(t=Ae.TRACKING_ID),gtag("config",t,{custom_map:{dimension1:"botClientId"}}),e&&gtag("event",Ae.EVENT_INITIAL_LOAD,{botClientId:e}),window.addEventListener("error",function(e){trackError(e,!1)})}function initializeServerConnection(){if(Se&&!Se.isInitializing){Se.isInitializing=!0,notifyConnectionIssues("Initializing connection");(o=$.hubConnection(je)).qs="botid="+ce,isLocalEnvironment()&&(o.logging=!0),o.connectionSlow(function(){console.warn("[Kenyt.AI] Connection is slow, may get disconnected"),gtag("event","connection_slow",eventData("connection"))}),o.reconnecting(function(){Se.tryingToReconnect=!0,Se.isConnected=!1,Se.reason="Reconnecting",notifyConnectionIssues("Reconnecting..."),console.warn("[Kenyt.AI] Lost connection to server, trying to reconnect..."+new Date),gtag("event","connection_lost",eventData("connection"))}),o.reconnected(function(){Se.tryingToReconnect=!1,Se.isConnected=!0,notifyConnectionIssues(Se.reason="Reconnected"),clearConnectionIssues(),console.warn("[Kenyt.AI] Reconnected to server..."+new Date),gtag("event","reconnected",eventData("connection")),sendSuspendedMessagesIfAny()}),(l=o.createHubProxy(I)).on("MessageReceived",handleMessageReceived),l.on("BotReply",handleBotResponse),l.on("ManualReply",handleManualReply),l.on("Error",handleError),l.on("NotifyAgentJoin",handleAgentJoin),l.on("NotifyAgentExit",handleAgentExit),l.on("NotifyWebRtcSignal",relayWebRtcSignalToParent),l.on("ChangeLanguage",handleLanguageSettings),l.on("RestartChat",restartSession),startConnection(onSuccessfulServerConnection,onFailedServerConnection,!1),o.disconnected(function(){if(o.lastError){var e=new Date;console.log("Disconnected at "+e),console.log("Disconnected. Reason: "+o.lastError.message);var t=void 0;t=Se.tryingToReconnect?"Disconnected after reconnecting failed;":"Disconnected without reconnecting;",t=o.lastError.message||t,console.error("[Kenyt.AI] "+t),Se.isConnected=!1,Se.tryingToReconnect=!1,Se.reason="disconnected",clearConnectionIssues(),Me&&(notifyConnectionIssues("Connection disconnected, Reconnecting in 5 secs..."),window.setTimeout(function(){initializeServerConnection()},5e3),t="(Reconnecting) "+t),trackError({message:"Connection Disconnected: "+t},!0)}})}}function startConnection(e,t,n){n?(gtag("event","forced_longpolling"),o.start({transport:"longPolling"}).done(e).fail(t)):o.start().done(e).fail(t)}function registerEventListeners(){G.addEventListener("keydown",handleKeyDown),G.addEventListener("input",handleInput),G.addEventListener("focus",function(){var e=ae.getAttribute("data-toggle");isMobileDevice()&&"maximize"===e&&toggleFullScreen(),scrollToEnd(z)});var e=document.getElementById("chatWindowHeader");e&&e.addEventListener("click",function(){var e=ae.getAttribute("data-toggle");isMobileDevice()&&"maximize"===e&&toggleFullScreen()});var t=document.getElementById("chatWindowBody");t&&t.addEventListener("click",function(){var e=ae.getAttribute("data-toggle");isMobileDevice()&&"maximize"===e&&toggleFullScreen()}),X&&X.addEventListener("focus",function(){var e=ae.getAttribute("data-toggle");isMobileDevice()&&"maximize"===e&&toggleFullScreen()}),K.addEventListener("click",handleSendButton),Y.addEventListener("click",handleSpeechButton),Q&&Q.addEventListener("click",function(e){handleCallButton()}),ae.addEventListener("click",function(e){e.stopPropagation(),updateLastActivity();var t=ae.getAttribute("data-toggle");toggleFullScreen(),gtag("event","Button_Minimize_Maximize",eventData("user_interaction",null,t))});var a=null,n=0,o=[],r=null,i=document.getElementById("cameraContainer"),s=document.getElementById("capturedImageContainer"),l=document.getElementById("videoElement"),d=document.getElementById("canvasElement"),c=document.getElementById("capturedImage"),u=document.getElementById("statusMessage");function showStatus(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2e3;u.textContent=e,u.style.display="block",setTimeout(function(){u.style.display="none"},t)}function startCamera(e){a&&a.getTracks().forEach(function(e){return e.stop()});var t={video:{deviceId:e?{exact:e}:void 0,width:{ideal:1920},height:{ideal:1080}}};return navigator.mediaDevices.getUserMedia(t).then(function(e){a=e,l.srcObject=a,document.getElementById("switchCameraBtn").style.display=1<o.length?"block":"none"}).catch(function(e){throw new Error("Unable to start camera: "+e.message)})}function closeCamera(){J.style.display="none",a&&(a.getTracks().forEach(function(e){return e.stop()}),a=null),r=null}Z.addEventListener("click",function(){J.style.display="flex",i.style.display="flex",s.style.display="none",showStatus("Initializing camera...",1e3),navigator.mediaDevices.enumerateDevices().then(function(e){if(0===(o=e.filter(function(e){return"videoinput"===e.kind})).length)throw new Error("No camera found");var t=o.findIndex(function(e){return e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("environment")});return startCamera(o[n=-1!==t?t:0].deviceId)}).catch(function(e){throw e}).then(function(){}).catch(function(e){console.error("Camera error:",e),showStatus("Failed to access camera",3e3),setTimeout(closeCamera,3e3)})}),document.getElementById("captureBtn").addEventListener("click",function(){if(a){var e=d,t=l,n=e.getContext("2d");e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0,e.width,e.height),r=e.toDataURL("image/png"),c.src=r,i.style.display="none",s.style.display="flex",a&&(a.getTracks().forEach(function(e){return e.stop()}),a=null),showStatus("Image captured!",1500)}}),document.getElementById("sendBtn").addEventListener("click",function(){if(r)try{var e=function(e){var t=e.width/e.height,n=Math.round(320/t);console.log("Original dimensions: "+e.width+"x"+e.height),console.log("Resized dimensions: 320x"+n);var a=document.createElement("canvas");a.width=320,a.height=n,a.getContext("2d").drawImage(e,0,0,320,n);var o=a.toDataURL("image/jpeg",.7);return o.length<1e4&&console.warn("Captured image seems to be blank or very small"),o}(d);addToChatWindow(createUserChatBubble("","",!1,e)),Ie.push({id:Tt++,isUserMessage:!0,message:"",displayMessage:"",messageTimestamp:getCurrentTimeString(),imageData:e});var t=e.match(/^data:(image\/[a-zA-Z0-9.+-]+);base64,(.+)$/);if(!t)return void alert("Invalid image data");var n=t[1],a=t[2];sendMessageToServer("iamge sent","",!1,!1,!1,{FileName:"captured_image_"+Date.now()+".png",MimeType:n,Base64Format:a},"File"),showStatus("Image sent successfully!",2e3),setTimeout(closeCamera,2e3)}catch(e){console.error("Error sending image:",e),showStatus("Error sending image",2e3)}}),document.getElementById("retakeBtn").addEventListener("click",function(){r=null,s.style.display="none",i.style.display="flex",startCamera(o[n].deviceId).then(function(){}).catch(function(e){console.error("Error restarting camera:",e),showStatus("Error restarting camera",2e3)})}),document.getElementById("closeCameraBtn").addEventListener("click",function(){closeCamera()}),document.getElementById("switchCameraBtn").addEventListener("click",function(){o.length<=1||(n=(n+1)%o.length,startCamera(o[n].deviceId).then(function(){showStatus("Camera switched",1500)}).catch(function(e){console.error("Error switching camera:",e),showStatus("Error switching camera",2e3)}))}),oe.addEventListener("click",hideChatWindow),re.addEventListener("click",goBackFromChatWindow),Te.addEventListener("mouseover",function(){p&&clearTimeout(p)}),Te.addEventListener("mouseleave",function(){setAnnouncementTimeout()}),Ee.addEventListener("click",function(){return toggleAnnouncementVisibility(!1)}),window.addEventListener("beforeunload",handleWindowClose),q.addEventListener("click",hideChatWindow),W.addEventListener("click",hideChatWindow),U.parentElement.addEventListener("click",hideChatWindow),document.addEventListener("keydown",function(e){var t=void 0;"key"in e?"Escape"!==e.key&&"Esc"!==e.key||(t=!0):t=e.keyCode===y,t&&hideChatWindow(),updateLastActivity()}),document.addEventListener("click",function(e){updateLastActivity()}),window.addEventListener("message",function(e){if(e.data&&"[object Object]"===Object.prototype.toString.call(e.data)&&e.data.type){var t=e.data;if(t.type===tt.IsWindowMinimizedResponse)lt=t.value,saveStateLocally(),lt||updateLastActivity();else if(t.type===tt.WindowHover)updateLastActivity();else if(t.type===tt.GetPageTitle)dt.pageTitle=t.value;else if(t.type===tt.GetReferrer)dt.pageReferrer=t.value;else if(t.type===tt.PageInfoResponse)t.value&&sendTrackingUpdate(t.value);else if(t.type===tt.SettingsUpdate)t.value&&applyWindowStyling(t.value,!1,!0);else if(t.type===tt.MediaStreamingCommand)relayWebRtcSignalFromParent(t.value);else if(t.type===tt.SendMessage){var n=t.value;n.messageToSend?sendMessageToServerRequest(n):sendMessageToServer(n,"",!1,!0)}else if(t.type===tt.ReportGoogleAnalyticsEvent)isLocalEnvironment()||(t.value.isException?gtag("event",t.value.eventName,t.value.details):gtag("event",t.value.eventName));else if(t.type===tt.SubmitRazorpayPayment){sendMessageToServerRequest({messageToSend:"Kcomplete paymenttransaction",displayMessage:"Payment completed",payload:t.value}),Kt.removeRazorpayButton()}else if(t.type===tt.SubmitCashfreePayment){sendMessageToServerRequest({messageToSend:"Kcomplete paymenttransaction",displayMessage:"Payment completed",payload:t.value}),Kt.removeCashfreeButton()}else if(t.type===tt.FirebaseToken)t.value&&updateUserFcmToken(t.value);else if(t.type===tt.SetCustomContext)t.hasOwnProperty("disableCustomMessage")&&!1!==t.disableCustomMessage||(t.hasOwnProperty("intent")&&t.intent?sendMessageToServer(t.intent,"",!1,!0,!1,t):sendMessageToServer("","",!0,!0,!0,t));else if(t.type===tt.UserGeneratedEvent){sendEventsToServerAsBase64({globalUserId:se,botId:ce,data:t.value})}else if(t.type===tt.UpdateSssionPing){var a=new XMLHttpRequest;a.open("GET",Ze+"?botId="+ce+"&globalUserId="+se,!0),a.send()}}})}function sendEventsToServerAsBase64(e){e=btoa(JSON.stringify(e));var t=new XMLHttpRequest;t.open("POST",Ye+"?botId="+ce,!0),t.setRequestHeader("Content-Type","application/octet-stream"),t.send(e)}function updateUserFcmToken(e){var t={fcmToken:e,globalUserId:se},n=new XMLHttpRequest,a=Je.replace("<botId>",ce);n.open("POST",a,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t))}function disconnectFromServer(){if(o)try{o.stop()}catch(e){}}function disconnectOnIdle(){var e=document.hasFocus();_t&&_t.idleTimeSec&&Se.isConnected&&_t.lastFocusedAt&&!e&&(((new Date).valueOf()-_t.lastFocusedAt.valueOf())/1e3>_t.idleTimeSec&&(disconnectFromServer(),gtag("event",Ae.DISCONNECT_IDLE_USER),Se.isConnected=!1,Se.tryingToReconnect=!1,Se.reason="idle",clearConnectionIssues(),notifyConnectionIssues("Connection disconnected (Idle User)",!0),document.getElementById("chatWindow").addEventListener("focus",handleDocumentFocus)))}function updateLastActivity(){if(_t){_t.lastFocusedAt=new Date;var e={BotClientId:E?E.BotId:0,ConversationId:de,UserId:se,IsActive:"true"};Se&&Se.isConnected?(_t.isActiveSignalSent||(_t.isActiveSignalSent=!0,l.invoke("SendUserActivity",e)),_t.stopTimingTimeOut||clearTimeout(_t.stopTimingTimeOut),_t.stopTimingTimeOut=setTimeout(function(){sendInActiveResponse(e)},5e3)):initializeServerConnection()}handleDocumentFocus()}function sendInActiveResponse(e){_t.isActiveSignalSent=!1,e.IsActive=!1,Se&&Se.isConnected?l.invoke("SendUserActivity",e):initializeServerConnection()}function handleDocumentFocus(){document.getElementById("chatWindow").removeEventListener("focus",handleDocumentFocus),!Se.isConnected&&Se.reason&&"idle"===Se.reason&&initializeServerConnection()}function onSuccessfulServerConnection(){if(ct=!1,gtag("event",o&&o.transport&&o.transport.name||"unknown",eventData("transport_type")),clearConnectionIssues(),Se.isConnected=!0,Se.tryingToReconnect=!1,Se.isInitializing=!1,E){var e={BotClientId:E.BotId,Conversation:{ConversationId:de},User:{UserId:se}};l.invoke("Subscribe",e),sendSuspendedMessagesIfAny()}}function onFailedServerConnection(e){Se.isInitializing=!1,e.message=e.message||"",e.message="Failed Server Connection: "+e.message,trackError(e)}function handleWindowClose(){disconnectFromServer();var e=retrieveLocalStateIfExists();e&&e.messages&&(Ie=e.messages),saveStateLocally()}function autoMessageAnalytics(){}function handleMessageReceived(){b&&(removeTimestamp(b),b=null)}function handleBotResponse(n){if(Ut=!1,n){if(i=new Date,d){var e=(i.valueOf()-d.valueOf())/1e3;Ue<e&&gtag("event",Ae.EVENT_MESSAGE_DELAY,eventData("messages",null,e))}if(c&&!s&&(s=!0,gtag("event",Ae.EVENT_FIRST_BOT_RESPONSE)),n.ClearChat&&clearChat(),renderBotMenu(n.BotMenu),n.Messages&&0<n.Messages.length){var a=-1,o="";n.Messages.forEach(function(e,t){e.DisplayName=n.DisplayName,e.IsPartial=n.IsPartial,(0<e.RichCards.length||null!=e.Text&&0<e.Text.length)&&(e.IsLastMessage=!0,a=t),null!=e.Id&&(o=e.Id)}),-1<a&&0<o.length&&(n.Messages[a].IsLastMessage=!0,n.Messages[a].MessageItemId=o),n.Messages.forEach(function(e){addToMessageQueue(e)}),saveStateLocally()}else hideTypingIndicator();Me&&gtag("event",Ae.EVENT_MESSAGE_RECEIVED,eventData("messages"));var t=document.getElementsByClassName(qe);if(t)for(var r=0;r<t.length;r++)enableElement(t[r]);dispatchEventToParent(nt.UserQueryResponse,{query:n.QueryScore})}dispatchEventToParent(nt.BotMessage,{botMessages:n.Messages})}function handleManualReply(e){var t={Text:e.Text,RichCards:[],CardsType:Qe.None,DisplayName:e.SenderName};t.Text&&x.SETTINGS_OVERRIDE.Pattern.test(t.Text.trim())?applyWindowStyling(parseWindowConfig(t.Text),!0):(t.Text&&(renderNewMessage(t),notifyUnreadMessages(t.Text)),e.Suggestion&&(e.Suggestion.DisplayName=e.SenderName,renderNewMessage(e.Suggestion),notifyUnreadMessages(e.Suggestion.Text)))}function handleFormValues(e,t,n,a){var o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"",i=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"";console.debug("Received values from form"),console.debug(t),disableElement(e.target,[qe]);var s={},l=!0;t.forEach(function(e){var t=e.inputElementRef?e.inputElementRef.value:e.defaultValue||"";if(t&&"checkbox"===e.datatype&&(e.inputElementRef.checked||(t="")),e.isMandatory||isNonEmptyString(t)){e.validationPattern&&!isRegExp(e.validationPattern)&&(e.validationPattern=new RegExp(e.validationPattern)),e.antiValidationPattern&&!isRegExp(e.antiValidationPattern)&&(e.antiValidationPattern=new RegExp(e.antiValidationPattern));var n=!0;(n=e.validationPattern?e.validationPattern.test(t):isNonEmptyString(t))&&e.antiValidationPattern&&(n=!e.antiValidationPattern.test(t)),e.validationSource&&e.pluginObj&&e.validationSource===L&&(n=e.pluginObj.isValidNumber(),t=e.pluginObj.getNumber()),e.prefixAttribute&&e.prefixAttribute.value&&n&&(t=e.prefixAttribute.value+"_"+t),n?(setFormFieldAsValid(e),s[e.field||e.displayName]=t):(setFormFieldAsInvalid(e),l=!1)}});var d=!0;if(l&&o){var c={};if(n){if(c.submit=n,c.values=s,a&&"values"===a){var u=[];Object.keys(s).forEach(function(e){u.push(""+s[e])});var m=u.join("\n");isNonEmptyString(c.payload=m)&&(sendMessageToServer(n,null,!1,!1,!1,m),d=!1)}else if(0<Object.keys(s).length){var p=n;0<i.trim().length&&(p=i),sendMessageToServer(n,p,!1,!1,!1,s),d=!1}}else{var g=convertToCSV(s);r&&(g+=", OnSubmit::"+r),isNonEmptyString(g)&&(sendMessageToServer(g,null,!1,!0),d=!1,c.csvString=g)}dispatchEventToParent(nt.GenericFormSubmit,c)}return d&&enableElement(e.target),{isFormValid:l,values:s}}function handleCustomFormValues(e,t,n,a){var o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];disableElement(e.target,[qe]);var r={},i=!0;t.forEach(function(e){var t=e.inputElementRef?e.inputElementRef.value:"";if(t&&"checkbox"===e.datatype&&(e.inputElementRef.checked||(t="")),e.isMandatory||isNonEmptyString(t)){e.validationPattern&&!isRegExp(e.validationPattern)&&(e.validationPattern=new RegExp(e.validationPattern)),e.antiValidationPattern&&!isRegExp(e.antiValidationPattern)&&(e.antiValidationPattern=new RegExp(e.antiValidationPattern));var n=!0;(n=e.validationPattern?e.validationPattern.test(t):isNonEmptyString(t))&&e.antiValidationPattern&&(n=!e.antiValidationPattern.test(t)),e.validationSource&&e.pluginObj&&e.validationSource===L&&(n=e.pluginObj.isValidNumber(),t=e.pluginObj.getNumber()),n?(setFormFieldAsValid(e),r[e.displayName]=t):(setFormFieldAsInvalid(e),i=!1)}});var s=!0;if(i&&o){var l={};if(n)if(l.submit=n,l.values=r,a&&"values"===a){var d=[];Object.keys(r).forEach(function(e){d.push(""+r[e])});var c=d.join("\n");isNonEmptyString(l.payload=c)&&(sendMessageToServer(n,null,!1,!1,!1,c),s=!1)}else 0<Object.keys(r).length&&(sendMessageToServer(n,null,!1,!1,!1,r),s=!1);else{var u=convertToCSV(r);isNonEmptyString(u)&&(sendMessageToServer(u,null,!1,!0),s=!1,l.csvString=u)}dispatchEventToParent(nt.GenericFormSubmit,l)}return s&&enableElement(e.target),{isFormValid:i,values:r}}function enableElement(e){e&&e.classList&&(e.disabled=!1,e.classList.remove(qe))}function disableElement(t,e){t&&t.classList&&(t.disabled=!0,e&&e.forEach(function(e){return t.classList.add(e)}))}function handleError(e){console.error(e),e&&(e.message=e.message||"",e.message="Handle Error: "+e.message),trackError(e)}function handleUserId(e,t){return se=e,le=!!t,saveStateLocally(),!0}function handleConversationId(e){return de=e,notifyParent(tt.Initialize,de),saveStateLocally(),!0}function handleLanguageSettings(e){if(e){if(e.LanguageCode&&changeConversationLanguage(e.LanguageCode,e.PreventHiMessage),e.Personas&&!isEmpty(e.Personas))for(var t in e.Personas)updatePersona(t,e.Personas[t],!0);else updatePersona("user",ie.UserPersona,!0),updatePersona("bot",ie.BotPersona,!0);updateButtonTexts(e.Buttons&&!isEmpty(e.Buttons)?e.Buttons:xt);var n=void 0;n=e.WindowContents&&!isEmpty(e.WindowContents)?e.WindowContents:Mt,e.WindowContents&&(applyWindowStyling(n,!0),notifyParent(tt.UpdateAttentionMessage,n.AttentionMessage)),changeContentDirection(e.RightToLeft)}}function changeContentDirection(e){var t=e?"rtl":"ltr";document.documentElement&&(getCurrentDirection()!=t&&(document.documentElement.setAttribute("dir",t),pt.rtl=!!e))}function getCurrentDirection(){var e="ltr";if(document.documentElement){var t=document.documentElement.getAttribute("dir");t&&(e=t)}return e}function extractWindowConfig(a){var o={};return a&&Object.keys(a).forEach(function(e){var t=a[e].Value,n=a[e].Key;n in mt&&(o[n]=t)}),o}function sendMessageToServerRequest(e){sendMessageToServer(e.messageToSend,e.displayMessage,e.isAutoMessage,e.preventMessageRender,e.isHidden,e.payload,e.payloadType,e.isPostback)}function sendMessageToServer(e,t,n,a,o,r,i,s,l,d,c,u){if((n||!e||0!==e.trim().length)&&!Ut){n||(updateLastActivity(),le=!1);var m=void 0;if(t&&!a){m=createUserChatBubble(t,'<span class="fa fa-spin fa-circle-o-notch"></span> sending..'),"user"!==T&&(addSenderDetails("user",getCurrentTimeString(),!0),T="user"),addToChatWindow(m),showTypingIndicator(st.name)}if(fe.UserId=se,r&&r.type&&r.type===tt.SetCustomContext){var p=["Name","Mobile","Email","type","intent"],g=["selectedConversationId","conversationMessages"],f=r.Name,v=r.Mobile,h=r.Email;for(var y in r)r.hasOwnProperty(y)&&-1===p.indexOf(y)&&-1===g.indexOf(y)&&(ge[y]=r[y]);f&&(fe.Name=f),v&&(fe.Mobile=v),h&&(fe.Email=h)}var C={RequestType:n?et.AutoMessage:et.UserMessage,Text:e,IsPostback:s,BotClientId:E?E.BotId:0,Conversation:{IsLocal:St,SourceUrl:pe,ConversationId:de,Context:ge},User:fe,IsTest:me,ConversationLanguage:we||"",IsHidden:!!o};d&&l&&(C.MessageFeedback=d,C.MessageItemId=l),u&&c&&(C.AgentChatRating=c,C.MessageItemId=l,C.AgentChatFeedback=u),r&&(C.Payload=r,i&&(C.PayloadType=i)),ut.pageStartAt=new Date,Se.isConnected?makeBotRequest(C,b=m,t,a):(console.warn("[Kenyt.AI] Connection not yet initiated, suspending message.."),suspendMessage(C,m||null,t,a),initializeServerConnection())}}function sendMessageFeedbackToServer(e,t,n){sendMessageToServer(e,"",!0,!0,!0,null,null,!1,t,n)}function sendAgentChatFeedbackToServer(e,t,n,a){sendMessageToServer(e,"",!0,!0,!0,null,null,!1,t,"",n,a)}function makeBotRequest(a,o,r,i,s){if(l&&!Ut){if(s||(s=0),c||a.RequestType!=et.UserMessage||(c=!0,gtag("event",Ae.EVENT_FIRST_USER_REQUEST)),!Me&&a.RequestType!==et.AutoMessage){Me=!0,dispatchEventToParent(nt.ChatStart,{messageText:r||a.Text});var e=getBrowserInformation();isObject(e)&&(a.BrowserInformation=e)}se&&!a.User.UserId&&(a.User.UserId=se),de&&!a.Conversation.ConversationId&&(a.Conversation.ConversationId=de),a.Conversation.TimezoneOffsetMinutes=-1*(new Date).getTimezoneOffset(),a.BotUserWebContext=ot,Ut=!0,l.invoke("UserMessage",E,a).done(function(e){if(Ut=!1,e)d=new Date,removeTimestamp(o),a.RequestType===et.AutoMessage&&(ut.isSentAck=!0),a.RequestType===et.UserMessage&&(It||me||window.setTimeout(function(){notifyParent(tt.PageInfoRequest)},100),dispatchEventToParent(nt.UserMessage,{messageText:a.Text}));else{if(notifyConnectionIssues("Send failed. Reconnecting..."),window.setTimeout(function(){initializeServerConnection()},5e3),a.RequestType===et.UserMessage)if(s<3){suspendMessage(a,o,r,i,"",s+1),i=!0;var t=a.BotClientId+"_"+a.Text;gtag("event",Ae.EVENT_MESSAGE_UNSUCCESSFUl,eventData("user_interaction",null,t))}else{var n=a.BotClientId+"_"+a.Text;gtag("event",Ae.EVENT_MESSAGE_ABANDONED,eventData("user_interaction",null,n))}Se.isConnected=!1,Se.reason="UserMessageFalse"}}).fail(function(e){if(Ut=!1,notifyConnectionIssues("Send failed. Reconnecting..."),window.setTimeout(function(){initializeServerConnection()},5e3),a.RequestType===et.UserMessage)if(s<3){suspendMessage(a,o,r,i,"",s+1),i=!0;var t=a.BotClientId+"_"+a.Text;gtag("event",Ae.EVENT_MESSAGE_UNSUCCESSFUl,eventData("user_interaction",null,t))}else{var n=a.BotClientId+"_"+a.Text;gtag("event",Ae.EVENT_MESSAGE_ABANDONED,eventData("user_interaction",null,n))}Se.isConnected=!1,Se.reason="UserMessageFail",handleFailedMessage(e),i=!0}),i||Ie.push({id:Tt++,isUserMessage:!0,message:a.Text,displayMessage:r,messageTimestamp:getCurrentTimeString()}),clearSilenceTimer(),Me&&gtag("event",Ae.EVENT_MESSAGE_SENT,eventData("messages")),saveStateLocally()}else console.error("[Kenyt.AI] Cannot send message - HubProxy is null")}function showTypingIndicator(e){hideTypingIndicator();var t=getTypingIndicator(e);wt.indicatorView=t[0],wt.senderDetailsView=t[1],V.appendChild(wt.senderDetailsView),V.appendChild(wt.indicatorView)}function hideTypingIndicator(){wt.senderDetailsView&&(wt.senderDetailsView.remove(),wt.senderDetailsView=null),wt.indicatorView&&(wt.indicatorView.remove(),wt.indicatorView=null)}function getTypingIndicator(e){var t=document.createElement("div"),n=createBotChatBubble();n.appendChild(getTemplate(We.TYPING_INDICATOR)),t.classList.add("col-12"),t.appendChild(n);var a=getTemplate(We.SENDER_DETAILS);return a.querySelector("[data-persona]").textContent=e,[t,a]}function removeTimestamp(e){if(e&&e instanceof HTMLDivElement){var t=e.querySelector(".message-timestamp");t&&t.remove()}}function handleFailedMessage(e){e&&(console.error(e),e.message=e.message||"",e.message="Failed Message: "+e.message,trackError(e))}function addToMessageQueue(e){0<gt.length?gt.push(e):0<e.SendWithDelayMs?(gt.push(e),window.setTimeout(function(){processMessageQueue()},e.SendWithDelayMs)):0<e.SendOnSilenceMs?(gt.push(e),window.setTimeout(function(){processMessageQueue()},10)):renderNewMessage(e)}function processMessageQueue(){if(0<gt.length){var e=gt.splice(0,1)[0];0<e.SendOnSilenceMs?startSilenceTimer(e.SendOnSilenceMs,function(){renderNewMessage(e),notifyUnreadMessages(e.Text)}):(renderNewMessage(e),notifyUnreadMessages(e.Text)),0<gt.length&&0===gt[0].SendWithDelayMs?processMessageQueue():0<gt.length&&0<gt[0].SendWithDelayMs&&window.setTimeout(function(){processMessageQueue()},gt[0].SendWithDelayMs)}}function startSilenceTimer(e,t){clearSilenceTimer(),r=window.setTimeout(function(){t()},e)}function clearSilenceTimer(){r&&(window.clearTimeout(r),r=0)}function renderNewMessage(e){showTypingIndicator("bot"===e.DisplayName?st.name:e.DisplayName),window.setTimeout(function(){hideTypingIndicator(),renderMessage(e,!1),T=e.DisplayName,Ie.push({id:Tt++,isUserMessage:!1,message:e,messageTimestamp:getCurrentTimeString(),displayMessage:null}),g[e.MessageItemId]=Ie[Ie.length-1].id,saveStateLocally()},Ne)}function renderMessage(e,t){if(e.IsPartial&&Ft)addMessageToLastCarousel(e);else{if(e.DisplayName===T||t||addSenderDetails(e.DisplayName,getCurrentTimeString()),e.Command&&e.Command.Name)if(e.Command.Name===x.CONTACT_FORM.Trigger)addFormToChatHistory((o=zt.getFormDetailsFromCommand(e.Command)).template,e.DisplayName),renderForm(o.template,o.setttings);else if(e.Command.Name===x.APPOINTMENT_FORM.Trigger){addFormToChatHistory((o=zt.getFormDetailsFromCommand(e.Command)).template,e.DisplayName),renderForm(o.template,o.setttings)}else if(e.Command.Name===x.ADDRESS_FORM.Trigger){addFormToChatHistory((o=zt.getFormDetailsFromCommand(e.Command)).template,e.DisplayName),renderForm(o.template,o.setttings)}else if(e.Command.Name===x.LATLONG_FORM.Trigger)t||requestGeoLocation();else if(e.Command.Name===x.FIREBASE_FORM.Trigger)t||requestFirebaseNotification();else if(e.Command.Name===x.FILE_UPLOAD.Trigger){var a=getFormSettings(e.Command.Value),i=getUploadFormTemplate();i.onSubmit=function(e){e.preventDefault();var t=e.target.getElementsByTagName("button");if(t&&t.length)for(var n=0;n<t.length;n++)disableElement(t[n]);var o=!0,r=[];i.fields.forEach(function(a){var t=[];t.push({inputElementRef:a.inputElementRef,feedbackElementRef:a.feedbackElementRef}),a.extraInputs&&a.extraInputs.forEach(function(e){t.push(e)}),t.forEach(function(e){var t=e.inputElementRef.value;if(a.isMandatory&&0==r.length||isNonEmptyString(t)){var n=isNonEmptyString(t);if(n&&"file"==a.datatype){20971520<e.inputElementRef.files[0].size&&(n=!1)}n?(setFormFieldAsValid(e),r.push(e.inputElementRef.files[0])):(setFormFieldAsInvalid(e),o=!1)}})}),o||(r=[]),handleUploadDocument(r,a,e)},renderForm(i,a),addFormToChatHistory(i,e.DisplayName)}else if(e.Command.Name===x.CALLER.Trigger)t||openWebRtcCaller(e);else if(e.Command.Name===x.OTP.Trigger){if(e.Command.Value){var n=null;try{n=JSON.parse(e.Command.Value).phone}catch(e){console.error("Error parsing command value",e)}addToChatWindow(convertToBotChatBubble(createOTPForm(n)))}}else if(e.Command.Name===x.GENERIC_FORM.Trigger){var o;if(e.Command.Value)addFormToChatHistory((o=zt.getFormDetailsFromCommand(e.Command)).template,e.DisplayName),renderForm(o.template,o.setttings)}else if(e.Command.Name===x.NAVIGATE.Trigger){if(!t){var r={url:e.Command.Value};notifyParent(tt.NavigateToPage,r)}}else if(e.Command.Name===x.SETTINGS_OVERRIDE.Trigger){applyWindowStyling(parseWindowConfig(e.Command.Value),!0)}else if(e.Command.Name===x.SET_SESSION.Trigger)t||updateSession(getFormSettings(e.Command.Value));else if(e.Command.Name===x.NOTIFY_LEAD_CAPTURE.Trigger){if(!t){var s=getFormSettings(e.Command.Value);dispatchEventToParent(nt.ContactFormSubmit,s)}}else if(e.Command.Name===x.OPEN_RAZORPAY_BUTTON.Trigger){(l=getFormSettings(e.Command.Value)).FrameColor=getFrameColor(),Kt.addRazorpayButton(l)}else if(e.Command.Name===x.OPEN_CASHFREE_BUTTON.Trigger){var l;(l=getFormSettings(e.Command.Value)).FrameColor=getFrameColor(),Kt.addCashfreeButton(l)}else if(e.Command.Name===x.NOTIFY_TYPING.Trigger){var d=getFormSettings(e.Command.Value);d.isTyping?showTypingIndicator(d.name):hideTypingIndicator()}if(e.Text||0<e.RichCards.length){var c=!1;(e.IsLastMessage||t&&0<e.MessageFeedback)&&(c=!0);var u=createBotChatBubble(e.Text,e.RichCards,e.CardsType,e.ContentType,e.XPath||"",e.Name,e.MultipleOptionsSettings,c,e);e.CardsType&&e.CardsType===Qe.FooterMenu&&(vt.footerMenu.content=e),addToChatWindow(u),bt&&isNonEmptyString(e.Text)&&speakText(e.Text)}}}function createMessageFeedbackContainer(e){if(e.MessageItemId){var t=e.MessageFeedback,n=e.MessageItemId,a=document.createElement("div");a.className="user-feedback-container";var o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.gap="8px";var r=document.createElement("span");r.innerHTML=1===t?'<i class="fas fa-thumbs-up"></i>':'<i class="far fa-thumbs-up"></i>',r.style.fontSize="18px",r.style.cursor="pointer",r.style.transition="transform 0.2s ease",r.style.color="#00c000",r.addEventListener("mouseover",function(){r.style.transform="scale(1.2)"}),r.addEventListener("mouseleave",function(){r.style.transform="scale(1)"}),r.addEventListener("click",function(){0===t&&(Ie[g[n]-1].message.MessageFeedback=1,saveStateLocally(),sendMessageFeedbackToServer("/userLikedMessage",n,t=1),r.querySelector("i").classList.replace("far","fas"),i.querySelector("i").classList.replace("fas","far"))});var i=document.createElement("span");i.innerHTML=2===t?'<i class="fas fa-thumbs-down" style="transform: scaleX(-1);"></i>':'<i class="far fa-thumbs-down" style="transform: scaleX(-1);"></i>',i.style.fontSize="18px",i.style.cursor="pointer",i.style.transition="transform 0.2s ease",i.style.color="#f64343",i.addEventListener("mouseover",function(){i.style.transform="scale(1.2)"}),i.addEventListener("mouseleave",function(){i.style.transform="scale(1)"}),i.addEventListener("click",function(){0===t&&(t=2,Ie[g[n]-1].message.MessageFeedback=2,saveStateLocally(),sendMessageFeedbackToServer("/userDislikedMessaage",n,t),r.querySelector("i").classList.replace("fas","far"),i.querySelector("i").classList.replace("far","fas"))}),o.appendChild(r),o.appendChild(i);var s=document.createElement("span");return s.innerHTML="Did this help ?",s.style.marginRight="10px",s.style.color="#8e8e8e",a.appendChild(s),a.appendChild(o),a}}function addMessageToLastCarousel(e){e&&e.RichCards&&addCardsToLastCarousel(e.RichCards,e.CardsType)}function createAgentChatFeedbackContainer(e){e.MessageFeedback;var a=e.MessageItemId;if(document.querySelector(".agent-chat-feedback-container"))return null;var t=document.createElement("div");t.className="agent-chat-feedback-container";var n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.alignItems="center",n.style.flexDirection="column",n.style.justifyContent="center";var o=document.createElement("div"),r=document.createElement("span");r.innerHTML='<i class="fas fa-times" style="font-size: 14px"></i>',r.style.cursor="pointer",o.style.display="flex",o.style.justifyContent="flex-end",o.style.width="100%",r.addEventListener("click",function(){hideAgentChatFeedback()}),o.appendChild(r);var l=document.createElement("div");l.style.display="flex",l.style.gap="8px",l.classList.add("rating-box"),l.style.padding="14px";var i=document.createElement("div");i.innerText="Submit Agent Feedback",i.style.padding="10px";var s=document.createElement("textarea");s.classList.add("chat-agent-feedback"),s.style.minHeight="70px",s.style.maxHeight="70px",s.style.width="100%",s.style.borderRadius="",s.style.overflowY="scroll";var d=document.createElement("div");d.style.display="flex",d.style.justifyContent="center";var c=document.createElement("button");c.innerText="Submit",c.classList.add("btn","primary-button"),c.style.cursor="pointer",c.style.marginTop="10px",c.addEventListener("click",function(){for(var e=s.value,t=0,n=1;n<=5&&l.querySelector("#rate_"+n).classList.contains("fas");n++)t++;s.innerText="",sendAgentChatFeedbackToServer("/agentchatfeedback",a,t,e),hideAgentChatFeedback()}),d.appendChild(c);for(var u=0;u<5;u++){var m=document.createElement("span");m.classList.add("far","fa-star"),m.style.cursor="pointer",m.style.fontSize="16px",m.setAttribute("id","rate_"+(u+1)),l.appendChild(m),m.addEventListener("click",function(e){var t=e.target.id;if(t){for(var n=1;n<=5;n++){var a=l.querySelector("#rate_"+n);a.classList.replace("fas","far"),a.style.color="black"}for(var o=parseInt(t.split("_")[1]),r=getRatingColor(o),i=1;i<=o;i++){var s=l.querySelector("#rate_"+i);s.classList.add("fas"),s.style.color=r}}})}return n.appendChild(o),n.appendChild(i),n.appendChild(l),n.appendChild(s),n.appendChild(d),t.appendChild(n),t}function getRatingColor(e){return e<=2?"red":3==e?"gold":"green"}function hideAgentChatFeedback(){document.querySelector(".agent-chat-feedback-container").classList.add("dis-none")}function selectChatRating(e){for(var t=1;t<=e;t++)thumbsUp.querySelector("i").classList}function handleUploadDocument(t,n,a){if(t&&0<t.length){var e=t[0];t.shift();var o=new FormData;o.append("UploadFile",e);var r=n.FailureCallback||"submit file failure",i={};i.FileName=e.name,$.ajax({url:$e+"?botId="+ce+"&userId="+se,type:"POST",data:o,success:function(e){e&&e.item2?sendMessageToServer(n.SubmitCallback||e.item1,null,!1,!0,!1,e.item2,"file"):sendMessageToServer(r,null,!1,!0,!1,i)},error:function(e){i.message=e,sendMessageToServer(r,null,!1,!0,!1,i)},complete:function(e){handleUploadDocument(t,n,a)},cache:!1,contentType:!1,processData:!1})}else{var s=a.target.getElementsByTagName("button");if(s&&s.length)for(var l=0;l<s.length;l++)enableElement(s[l])}}function renderBotMenu(e){e&&e.HeaderMenu&&renderHeaderMenu(e.HeaderMenu)}function renderHeaderMenu(e){if(vt.headerMenu.container&&e&&e.RichCards){vt.headerMenu.content=e;var o=vt.headerMenu.container.getElementsByClassName("dropdown-menu");if(0<o.length){for(var t=[],n=o[0].children,a=0;a<n.length;a++){var r=n[a];"DIV"==r.tagName&&t.push(r)}t.forEach(function(e){o[0].removeChild(e)});var i=e.RichCards,s=0;i&&i.length&&i.forEach(function(e){if(e){s++;var t=createCardByTemplate(e,We.HEADER_MENU_ITEM,s,i.length),n=t.innerText;n&&(n=n.trim());var a=t.getAttribute("message");a||(a=t.innerText)&&(a=a.trim()),t.addEventListener("click",function(){sendMessageToServer(a,n)}),o[0].appendChild(t)}})}}}function renderInteractiveMenu(e,t){var n=document.getElementById("footer-menu");if(e&&(ft.previousStateLoaded||vt.footerMenu.isOpened)){var a=e.getElementsByClassName("interactive-menu-options");if(a&&0<a.length)a=a[0],vt.footerMenu.optionsContainer.appendChild(a),a.classList.remove("d-none"),n.classList.remove("footer-hidden"),t=t||"Menu",document.getElementById("footer-menu-title").innerText=t,document.getElementById("chatWindow").classList.add("footer-menu"),n.classList.add("open"),n.classList.remove("footer-minimized"),vt.footerMenu.menuline.style.display="none",vt.footerMenu.isOpen=!0,vt.footerMenu.referenceElement=e}}function renderCards(e,t,n,a,o,r){var i=6<arguments.length&&void 0!==arguments[6]&&arguments[6];if(0<e.length){var s=document.createElement("div"),l=void 0;return t===Qe.None||t===Qe.Thumbnail?(l=e[0].Image?createCarousel(e):equalsIgnoreCase(n,"MultipleChoice")?createMultipleChoiceCard(e,o):equalsIgnoreCase(n,"Dropdown")?createDropdownCard(e):createOptionGroup(e,r,i)).classList.add("text-center"):t===Qe.SmallButton?l=createOptionGroupByTemplate(e,We.SMALL_BUTTON_CARD):t===Qe.MediumButton?l=createOptionGroupByTemplate(e,We.MEDIUM_BUTTON_CARD):t===Qe.VisitingCard?l=createOptionGroupByTemplate(e,We.VISITING_CARD):t===Qe.VerticalCard?l=createOptionGroupByTemplate(e,We.VERTICAL_CARD):t===Qe.Hero||(t===Qe.Image||t===Qe.Gif||t===Qe.Video?l=createCarousel(e):t===Qe.QuickLink||(t===Qe.Location?l=createOptionGroupByTemplate(e,We.LOCATION_CARD):t===Qe.File?l=createOptionGroupByTemplate(e,We.FILE_CARD):t===Qe.FooterMenu?l=createOptionGroupByTemplate(e,We.FOOTER_MENU,a):t===Qe.InteractiveList?l=createOptionGroupByTemplate(e,We.INTERACTIVE_CARD,a):(console.error("Cannot render card"),console.error("Unknown card type: "+t)))),l&&(Ft={container:l,size:e.length},l.classList.add("mt-1"),s.appendChild(l)),s}}function addCardsToLastCarousel(e,t){Ft&&0<e.length&&(t===Qe.None||t===Qe.Thumbnail?e[0].Image&&addToCarousel(e):t===Qe.SmallButton?addOptionGroupByTemplate(e,We.SMALL_BUTTON_CARD):t===Qe.MediumButton?addOptionGroupByTemplate(e,We.MEDIUM_BUTTON_CARD):t===Qe.VisitingCard?addOptionGroupByTemplate(e,We.VISITING_CARD):t===Qe.VerticalCard?addOptionGroupByTemplate(e,We.VERTICAL_CARD):t===Qe.Hero||(t===Qe.Image||t===Qe.Gif||t===Qe.Video?addToCarousel(e):t===Qe.QuickLink||(t===Qe.Location?addOptionGroupByTemplate(e,We.LOCATION_CARD):t===Qe.File?addOptionGroupByTemplate(e,We.FILE_CARD):t===Qe.FooterMenu?addOptionGroupByTemplate(e,We.FOOTER_MENU):t===Qe.InteractiveList?addOptionGroupByTemplate(e,We.INTERACTIVE_CARD):(console.error("Cannot render card"),console.error("Unknown card type: "+t)))))}function createOptionGroup(e,a,o){var r=document.createElement("div");r.classList.add("card-thumbnail");var i=0;if(e&&e.length&&e.forEach(function(e){if(o){var t=structuredClone(e);e=new Proxy(t,{get:function(e,t){return e[t]?e[t]:e[t.replace(/^./,function(e){return e.toLowerCase()})]?e[t.replace(/^./,function(e){return e.toLowerCase()})]:e[t.replace(/^./,function(e){return e.toUpperCase()})]?e[t.replace(/^./,function(e){return e.toUpperCase()})]:void 0}})}if(e){i++;var n=createOptionContainerGroupItem(e.Title,e.Options.tap,e.IsNavigational,a);r.appendChild(n),10<i&&n.classList.add("extra-option")}}),10<i){r.classList.add("show-less");var t=getTemplate(We.SHOW_MORE_BUTTON);t.addEventListener("click",function(){r.classList.remove("show-less")}),r.appendChild(t)}return r}function createOptionGroupByTemplate(e,n,t){var a=document.createElement("div"),o=0,r=10,i=getTemplate(n),s=i.getAttribute("data-max-cards");if(s&&(r=parseInt(s,10))<=0&&(r=10),e&&e.length){var l=getCarouselLength(e);e.forEach(function(e){if(e){var t=createCardByTemplate(e,n,++o,l);a.appendChild(t),r<o&&t.classList.add("extra-option")}})}var d=i.getAttribute("data-container");d||(d="");var c=i.getAttribute("data-container-class");switch(d){case"CarouselContainer":a.classList.add("custom-carousel");var u=getCurrentDirection();if(a.setAttribute("dir",u),c&&a.classList.add(c),e.length<=1){var m=JSON.parse(JSON.stringify(pt));m.arrows=!1,m.autoplay=!1,m.dots=!1,$(a).slick(m)}else $(a).slick(pt);$(a).slick("setPosition");break;case"FooterMenu":a.classList.add("interactive-menu-options"),a.classList.add("d-none"),vt.footerMenu.contentElement.innerHTML="",vt.footerMenu.contentElement.appendChild(a),vt.footerMenu.hidden=!1,vt.footerMenu.container.classList.remove("footer-hidden"),renderInteractiveMenu(vt.footerMenu.contentElement,t);var p=document.createElement("div");a=p;break;case"InteractiveMenu":a.classList.add("interactive-menu-options"),a.classList.add("d-none");var g=document.createElement("div"),f={};f.Title=t||"Menu",f.Image="icon:bars",f.Options=[];var v=createCardByTemplate(f,We.SMALL_BUTTON_CARD,1,1);v.addEventListener("click",function(e){renderInteractiveMenu(g,t)}),g.appendChild(v),g.appendChild(a),a=g;break;default:if(a.classList.add("card-thumbnail"),r<o){a.classList.add("show-less");var h=getTemplate(We.SHOW_MORE_BUTTON);h.addEventListener("click",function(){a.classList.remove("show-less")}),a.appendChild(h)}}return a}function addOptionGroupByTemplate(e,n){var t=getTemplate(n).getAttribute("data-container");switch(t||(t=""),t){case"CarouselContainer":var a=Ft.size;$(Ft.container).slick("slickRemove",a-1);var o=e.length+a-1,r=getCarouselLength(e);e.forEach(function(e){var t=createCardByTemplate(e,n,a,r);t&&($(Ft.container).slick("slickAdd",t),a++)}),$(Ft.container).slick("slickGoTo",Ft.size-1),Ft.size=o}}function getCarouselLength(e){var t=e.length;return e[e.length-1].IsNavigational&&(t=e[e.length-1].Total),t}function createOptionGroupItem(n,a,o,r){var e=document.createElement("div");return n=getButtonsText(n),e.textContent=n,e.classList.add("option-pill"),a&&(e.classList.add("pointer"),e.addEventListener("click",function(e){var t={messageToSend:a,displayMessage:n,preventMessageRender:o,isPostback:!0};r?r(e,t):sendMessageToServerRequest(t)})),e}function createOptionContainerGroupItem(e,t,n,a){var o=createOptionGroupItem(e,t,n,a),r=document.createElement("div");return r.classList.add("option-pill-container"),r.appendChild(o),r}function isValidUrl(e){try{return new URL(e),!0}catch(e){return!1}}function getFileIcon(e){return{pdf:{icon:"file-pdf",color:"red"},ppt:{icon:"file-powerpoint",color:"#c7421d"},pptx:{icon:"file-powerpoint",color:"#c7421d"},xls:{icon:"file-excel",color:"green"},xlsx:{icon:"file-excel",color:"green"},zip:{icon:"file-archive",color:"purple"},txt:{icon:"file-alt",color:"black"},doc:{icon:"file-word",color:"#325b9d"},docx:{icon:"file-word",color:"#325b9d"}}[e.split(".").pop().toLowerCase()]||{icon:"file",color:"black"}}function createCardByTemplate(i,e,t,n){var s=getTemplate(e);if(i.ElementId&&(s.id=i.ElementId),s.querySelectorAll("[data-card-title]").forEach(function(e){e&&i.Title&&(e.textContent=i.Title.trim())}),s.querySelectorAll("[data-card-subtitle]").forEach(function(e){if(e&&i.SubTitle){e.textContent=i.SubTitle;var t=s.querySelectorAll("[data-card-file-icon]");if(null!=t&&0<t.length){var n;t=t[0];var a=getFileIcon(i.SubTitle),o=a.icon,r=a.color;(n=t.classList).remove.apply(n,_toConsumableArray(t.classList)),t.classList.add("fa"),t.classList.add("fa-"+o),t.style.color=r}}}),i.Coordinates){var a=s.querySelector("[data-card-coordinates]");if(a||s.hasAttribute("data-card-coordinates")&&(a=s),a){var o="https://www.google.com/maps?q="+i.Coordinates.Item1+","+i.Coordinates.Item2;a.addEventListener("click",function(){window.open(o,"_blank")})}}s.querySelectorAll("[data-card-fileurl]").forEach(function(e){e&&i.FileUrl&&e.addEventListener("click",function(){if(isValidUrl(i.FileUrl))window.open(i.FileUrl,"_blank");else try{for(var e=i.MIMEType,t=atob(i.FileUrl),n=new Array(t.length),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);var o=new Uint8Array(n),r=new Blob([o],{type:e});window.open(URL.createObjectURL(r),"_blank")}catch(e){console.error("Error converting Base64 to Blob:",e)}})}),s.querySelectorAll("[data-card-description]").forEach(function(e){e&&i.Description&&(e.innerHTML=marked(i.Description))});var r=s.querySelector("[data-card-tapbutton]");r||s.hasAttribute("data-card-tapbutton")&&(r=s);var l=createIconElement(i.Image);if(l)s.querySelectorAll("[data-card-icon-container]").forEach(function(e){e&&(e.firstChild?e.insertBefore(l,e.firstChild):e.appendChild(l))});else if(i.Image){s.querySelectorAll("[data-card-image]").forEach(function(e){e&&(e.src=i.Image)})}else s.classList.add("no-image");if(r&&i.OnClick)r.addEventListener("click",function(e){i.OnClick(e)});else if(r&&i.Options){var d=Object.keys(i.Options);if(0<d.length){var c=i.Options.tap;c||(c=i.Options[d[0]]),r.addEventListener("click",function(){sendMessageToServerRequest({messageToSend:c,displayMessage:i.Title,preventMessageRender:i.IsNavigational,isPostback:!0})})}}var u=s.querySelector("[data-card-add-btns]");u&&i.Options&&Object.keys(i.Options).forEach(function(e){switch(e){case"Open":break;default:var t=getTemplate(We.CARD_BUTTON);t&&(t.textContent=e,t.addEventListener("click",function(){sendMessageToServerRequest({messageToSend:i.Options[e],displayMessage:e,preventMessageRender:i.IsNavigational,isPostback:!0})}),u.appendChild(t))}});var m=i.Total||n;m&&1<m&&s.querySelectorAll("[data-card-slide-number]").forEach(function(e){e&&(i.IsNavigational||(e.textContent=t+"/"+m))});return s.querySelectorAll("[data-marked-content]").forEach(function(e){e&&e.innerHTML&&(e.innerHTML=marked(e.innerHTML))}),s}function updateCardById(e,t){var n=document.getElementById(e);if(n){if(t.Title)n.querySelectorAll("[data-card-title]").forEach(function(e){e&&(e.textContent=t.Title)});var a=n.querySelector("[data-card-tapbutton]");a||n.hasAttribute("data-card-tapbutton")&&(a=n),t.RemoveId&&n.removeAttribute("id"),a&&t.RemoveClick&&(n.removeAttribute("class"),a.outerHTML=a.outerHTML)}}function createCarousel(e,a){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=document.createElement("div");if(e&&0<e.length){var i=getCarouselLength(e),s=1;e.forEach(function(e){if(o){var t=structuredClone(e);e=new Proxy(t,{get:function(e,t){return e[t]?e[t]:e[t.replace(/^./,function(e){return e.toLowerCase()})]?e[t.replace(/^./,function(e){return e.toLowerCase()})]:e[t.replace(/^./,function(e){return e.toUpperCase()})]?e[t.replace(/^./,function(e){return e.toUpperCase()})]:void 0}})}var n=createCarouselItem(e,s,i,a);n&&(r.appendChild(n),s++)})}r.classList.add("custom-carousel");var t=getCurrentDirection();if(r.setAttribute("dir",t),e.length<=1){var n=JSON.parse(JSON.stringify(pt));n.arrows=!1,n.autoplay=!1,n.dots=!1,$(r).slick(n)}else $(r).slick(pt);return $(r).slick("setPosition"),r}function createCarouselItem(t,e,n,a){var o=document.createElement("div"),r=createVideoCard(t);if(r||(t.Image&&isNonEmptyString(t.Image)?(r=document.createElement("img")).src=t.Image:t.Gif&&isNonEmptyString(t.Gif)&&((r=document.createElement("img")).src=t.Gif)),r){o=document.createElement("div");var i=document.createElement("div");i.classList.add("img-container");var s=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),c=null,u=document.createElement("div"),m=document.createElement("span");if(!t.IsNavigational){var p=t.Total||n;m.textContent=e+"/"+p}if(r.setAttribute("data-index",e),r.alt=t.Title,r.classList.add("custom-carousel-image","loading","pointer"),r.addEventListener("load",function(){r.classList.remove("loading")}),r.addEventListener("error",function(){trackError({message:"Media not found: "+mediaUrl},!1)}),t.Options){var g=[],f=!1;if(Object.keys(t.Options).forEach(function(e){switch(e){case"Open":o.setAttribute("data-open-imageurl",t.Options.Open),o.setAttribute("data-open-caption",t.Title),o.addEventListener("click",function(e){openImages(o)}),f=!0;break;default:g.push({title:e,value:t.Options[e]})}}),0<g.length){if(!f){var v=g[0];r.addEventListener("click",function(){sendMessageToServerRequest({messageToSend:v.value,displayMessage:v.title,preventMessageRender:t.IsNavigational,isPostback:!0})})}(c=document.createElement("div")).classList.add("text-center"),g.forEach(function(e){return c.appendChild(createOptionGroupItem(e.title,e.value,t.IsNavigational,a))})}}s.textContent=t.Title,l.textContent=t.SubTitle,d.textContent=t.Description,d.textContent&&(d.innerHTML=marked(d.textContent)),o.classList.add("card-border"),s.classList.add("text-center"),s.classList.add("data-title"),l.classList.add("text-center"),l.classList.add("data-subtitle"),d.classList.add("text-center"),m.classList.add("text-center"),u.classList.add("text-center","card-index","primary-border"),u.appendChild(m),u.style.height=u.style.width,s.textContent&&o.appendChild(genericContainer([],s)),i.appendChild(r),o.appendChild(i),1<n&&i.appendChild(u),l.textContent&&o.appendChild(genericContainer([],l)),d.textContent&&o.appendChild(genericContainer([],d)),c&&o.appendChild(genericContainer([],c))}return o}function createVideoCard(t){if(t&&isNonEmptyString(t.Video))try{var e=new URL(t.Video).searchParams.get("v");if(e)return createYoutubeEmbedIframe(e);var n=document.createElement("video");n.setAttribute("controls","");var a=document.createElement("source");return a.src=t.Video,n.appendChild(a),n}catch(e){console.error("[Kenyt.AI] Error rendering Youtube Video: "+t.Video),console.error(e)}return null}function createYoutubeEmbedIframe(e){var t=document.createElement("iframe");return t.src="https://www.youtube-nocookie.com/embed/"+e,t.frameBorder=0,t.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",t.allowFullscreen="allowFullscreen",t}function openImages(e){var t=getImageIndex(e);if(0<=t){for(var n=[],a=e.previousElementSibling;a;){var o=getImageIndex(a);if(0<=o&&o<t){if(c=a.getAttribute("data-open-imageurl")){var r={imageUrl:c,caption:a.getAttribute("data-open-caption")};n.push(r)}a=a.previousElementSibling}else a=null}for(var i=[],s=e,l=t;s;){var d=getImageIndex(s);if(0<=d&&l<=d){var c;if(l=d,c=s.getAttribute("data-open-imageurl")){var u={imageUrl:c,caption:s.getAttribute("data-open-caption")};i.push(u)}s=s.nextElementSibling}else s=null}var m={};for(m.currentSlideNumber=n.length+1,m.slides=[];n.length;){var p=n.pop();m.slides.push(p)}for(var g=0;g<i.length;g++)m.slides.push(i[g]);notifyParent(tt.FullScreenImage,m)}}function getImageIndex(e){var t=-1,n=e.getElementsByClassName("custom-carousel-image");return n&&(n=n[0])&&(t=n.getAttribute("data-index")),t}function addToCarousel(e){if(Ft&&e&&0<e.length){var n=Ft.size;$(Ft.container).slick("slickRemove",n-1);var t=e.length+n-1,a=getCarouselLength(e);e.forEach(function(e){var t=createCarouselItem(e,n,a);t&&($(Ft.container).slick("slickAdd",t),n++)}),$(Ft.container).slick("slickGoTo",Ft.size-1),Ft.size=t}}function createOTPForm(e){var n=getTemplate(We.OTP_FORM),a=n.querySelector("[data-input-field]"),o=n.querySelector("[data-submit]").querySelector("span"),t=n.querySelector("[data-mobile-number]"),r=n.querySelector("[data-error-description]"),i=n.querySelector("[data-change-mobile-number]"),s=n.querySelector("form");return t.textContent=e||"your mobile",a.pattern=B.source,a.addEventListener("change",function(){r.textContent=""}),i.addEventListener("click",function(){var e=n.parentElement,t=convertToBotChatBubble(createPhoneNumberForm());n.remove(),e.appendChild(t)}),s.addEventListener("submit",function(e){e.preventDefault();var t=a.value;r.textContent="",o.classList.remove("fa-paper-plane"),o.classList.add("fa-spin","fa-spinner"),B.test(t)?(sendMessageToServer(t,t,!1,!1,!1),n.remove()):(console.warn("OTP Invalid"),r.textContent="The OTP you entered is invalid, try again")}),n}function createPhoneNumberForm(){var t=getTemplate(We.PHONE_NUMBER_FORM),n=t.querySelector("[data-input-field]"),a=t.querySelector("[data-error-description]"),e=t.querySelector("form");return window.intlTelInput(n,{geoIpLookup:function(e){e("IN")},hiddenInput:"full_number",initialCountry:"auto",placeholderNumberType:"MOBILE",separateDialCode:!0,utilsScript:k}),n.addEventListener("change",function(){a.textContent=""}),e.addEventListener("submit",function(e){e.preventDefault(),a.textContent="",n.value?(sendMessageToServer(""+M+n.value,n.value,!1,!1,!1),t.remove()):a.textContent="Please enter a valid mobile number"}),t}function createMultipleChoiceCard(e,a){var t=document.createElement("div");t.classList.add("multiplechoices");var o=document.createElement("div");t.appendChild(o);var r=document.createElement("button");null!=a&&0<a.MinimumChoices&&r.classList.add("k-hide"),r.textContent=getButtonsText("None of the above")+" ",r.classList.add("btn","primary-button","submit","mt-2");var n=document.createElement("span");return n.classList.add("fa","fa-send"),r.appendChild(n),r.addEventListener("click",function(){submitMultipleChoices(o)}),t.appendChild(r),e&&e.length&&e.forEach(function(e){if(e){var t=document.createElement("div");t.textContent=e.Title,t.classList.add("option-pill"),e.Options.tap&&(t.setAttribute("content",e.Options.tap),t.classList.add("pointer"),t.addEventListener("click",function(){t.classList.toggle("isSelected"),updateMultipleChoiceSubmitContent(r,o,a)}));var n=document.createElement("div");n.classList.add("option-pill-container"),n.appendChild(t),o.appendChild(n)}}),t}function getMultipleChoiceSelection(e){var t=[],n=[];if(e&&e.children)for(var a=e.children,o=0;o<a.length;o++){var r=a[o].children[0];r.classList.contains("isSelected")&&(t.push(r.getAttribute("content")),n.push(r.textContent))}var i={};return i.selected=t.join(),i.display=n.join(),i}function updateMultipleChoiceSubmitContent(e,t,n){var a=getMultipleChoiceSelection(t);e&&a&&(null==n||0==n.MinimumChoices?a.selected?e.textContent=getButtonsText("Submit")+" ":e.textContent=getButtonsText("None of the above")+" ":a.selected&&a.selected.split(",").length>=n.MinimumChoices?(e.textContent=getButtonsText("Submit")+" ",e.classList.remove("k-hide")):e.classList.add("k-hide"))}function submitMultipleChoices(e){var t=getMultipleChoiceSelection(e);t.selected?sendMessageToServer(t.selected,t.display):sendMessageToServer("None of the above",getButtonsText("None of the above"))}function createDropdownCard(e){var t=document.createElement("div");t.classList.add("dropdown");var n=[];e&&e.length&&e.forEach(function(e){if(e&&e.Options.tap){var t=e.Title+":"+e.Options.tap;n.push(t)}});var a=createDropdownElement(n,"");t.appendChild(a),a=converDropdowntToSearchDropDown(a);var o=document.createElement("button");o.textContent=getButtonsText("Submit")+" ",o.classList.add("btn","primary-button","submit","mt-2");var r=document.createElement("span");return r.classList.add("fa","fa-send"),o.appendChild(r),o.addEventListener("click",function(){submitSelectedChoice(a)}),t.appendChild(o),t}function converDropdowntToSearchDropDown(e){var t=e.parentNode,n=document.createElement("div");n.classList.add("dropdown-search"),t.insertBefore(n,e);var a=document.createElement("input");a.classList.add("primary-border"),a.classList.add("pointer"),n.appendChild(a);var o=document.createElement("div");o.classList.add("options"),o.classList.add("smooth-scroll"),o.classList.add("thin-scroll"),o.classList.add("empty-input"),o.classList.add("primary-border"),n.appendChild(o),e.childNodes.forEach(function(e){var t=document.createElement("div");t.classList.add("no-match"),t.setAttribute("data-value",e.value),t.classList.add("primary-hover"),t.classList.add("pointer"),t.innerText=e.innerText,e.value?(o.appendChild(t),t.addEventListener("click",function(e){!function(e){var t=e.target,n=t.parentNode,a=n.previousSibling;a.value=t.innerText;var o=t.getAttribute("data-value");a.setAttribute("data-value",o),t.parentNode.classList.add("empty-input");var r=n.nextSibling;r.classList.add("fa-caret-down"),r.classList.remove("fa-caret-up"),e.stopPropagation(),updateLastActivity(),scrollToEnd(z)}(e)})):a.placeholder=e.innerText}),a.addEventListener("keyup",function(e){showOptions(e.target)}),a.addEventListener("keydown",function(e){showOptions(e.target)}),a.addEventListener("focus",function(e){showOptions(e.target)});var r=document.createElement("span");r.classList.add("fa"),r.classList.add("fa-caret-down"),r.classList.add("icon"),r.classList.add("pointer"),n.appendChild(r),r.addEventListener("focus",function(e){showOptions(e.target.previousSibling.previousSibling)});var i=document.createElement("span");function showOptions(e){e.removeAttribute("data-value");var t=e.nextSibling,n=t.nextSibling.nextSibling;if(e.value){t.classList.remove("empty-input"),n.classList.remove("d-none");for(var a=!1,o=t.getElementsByTagName("div"),r=0;r<o.length;r++)o[r].innerText.toLowerCase().includes(e.value.toLowerCase())?(o[r].classList.remove("no-match"),a=!0):o[r].classList.add("no-match");a||t.classList.add("empty-input")}else{t.classList.remove("empty-input"),n.classList.add("d-none");for(o=t.getElementsByTagName("div"),r=0;r<o.length;r++)o[r].classList.remove("no-match")}var i=t.nextSibling;i.classList.remove("fa-caret-down"),i.classList.add("fa-caret-up"),scrollToEnd(z)}return i.innerText="close",i.classList.add("material-icons-outlined"),i.classList.add("remove-icon"),i.classList.add("pointer"),i.classList.add("d-none"),i.addEventListener("click",function(e){var t=e.target.previousSibling.previousSibling.previousSibling;t.value="",t.focus(),showOptions(t)}),n.appendChild(i),t.removeChild(e),a}function submitSelectedChoice(e){var t=e.value,n="";if(e.options&&e.selectedIndex)n=e.options[e.selectedIndex].text;else if(e.list&&e.list.options)for(var a=0;a<e.list.options.length;a++)e.list.options[a].value==t&&(n=e.list.options[a].innerText);else e.hasAttribute("data-value")&&(t=e.getAttribute("data-value"),n=e.value);t&&(n||(n=t),sendMessageToServer(t,n))}function handleKeyDown(e){e.which===v||e.keyCode===v?e.target.value&&(e.preventDefault(),handleSendButton()):auto_grow(e.target)}function handleSendButton(){if(!Ut){var e=G.value;e&&(bt=!1,sendMessageToServer(e,e),G.value=""),auto_grow(G)}}function addToChatWindow(e){if(V){var t=document.createElement("div");t.classList.add("col-12"),rt?rt=!1:t.classList.add("mt-2");for(var n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];a.forEach(function(e){t.classList.add(e)}),t.appendChild(e),fitChatWindowBubble(t),V.appendChild(t),window.setTimeout(function(){scrollToEnd(z)},100)}}function fitChatWindowBubble(e){jt.setFittingClassByText(e)}function toggleAnnouncementVisibility(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Te&&(Te.style.display=e?"block":"none")}function showAnnouncement(){toggleAnnouncementVisibility(!0),setAnnouncementTimeout()}function setAnnouncementTimeout(){p=setTimeout(function(){toggleAnnouncementVisibility(!1)},1e4)}function applyWindowStyling(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=[],o=isMobileDevice(),r="py-1";if(e){if(isNonEmptyString(e.Announcement)){var i=document.querySelector("#announcementText"),s=document.querySelector("#announcementContainer");Te&&s&&i&&(i.innerText=e.Announcement,s.style.borderColor=e.FrameColor,s.style.backgroundColor=e.FrameColor+"7a")}if(isNonEmptyString(e.FontFamily)&&a.push({elementSelector:"#chatWindow",properties:[{property:"font-family",value:"'"+e.FontFamily+"'"}]}),isNonEmptyString(e.BotPosition)&&notifyParent(tt.UpdateBotPosition,e.BotPosition),isNonEmptyString(e.FrameColor)){var l=Gt.getThemeSettings(e.FrameColor,e.FrameColorGradient);if(l){var d=Gt.getThemeSettings("#ffffff","#ffffff");l.backgroundColor?F.style.backgroundColor=l.backgroundColor:F.style.backgroundImage=l.backgroundGradient,F.style.color=l.textColor,K.style.color=l.textColor,X.style.color=l.textColor,G.style.borderColor=l.color,X.style.backgroundColor=l.color,K.style.backgroundColor=l.color,notifyParent(tt.UpdateChatBubbleColor,l.color),notifyParent(tt.TextColor,l.textColor),a.push(),a.push({elementSelector:".option-pill:hover",properties:[{property:"color",value:""+l.buttonColorHover,override:!0},{property:"border-color",value:""+l.buttonBackgroundColorHover,override:!0},{property:"background-color",value:""+l.buttonBackgroundColorHover,override:!0}]},{elementSelector:".option-pill.isSelected",properties:[{property:"color",value:""+l.buttonColorHover,override:!0},{property:"border-color",value:""+l.buttonBackgroundColorHover,override:!0},{property:"background-color",value:""+l.buttonBackgroundColorHover,override:!0}]},{elementSelector:".option-pill",properties:[{property:"color",value:""+l.buttonColor,override:!0},{property:"border-color",value:""+l.buttonBorderColor,override:!0},{property:"background-color",value:""+l.buttonBackgroundColor,override:!0}]},{elementSelector:".bg-accent",properties:[{property:"background-image",value:""+l.backgroundGradient,override:!0}]},{elementSelector:".text-accent",properties:[{property:"color",value:""+d.textColor,override:!0}]},{elementSelector:".bot-chat-bubble",properties:[{property:"color",value:d.textColor+" !important"}]},{elementSelector:".interactivelist-card:hover",properties:[{property:"color",value:""+l.buttonColorHover,override:!0},{property:"border-color",value:""+l.colorTo,override:!0},{property:"background-color",value:""+l.colorTo,override:!0}]},{elementSelector:".primary-border",properties:[{property:"border-color",value:l.color+" !important"}]},{elementSelector:".primary-background",properties:[{property:"background-color",value:l.color+" !important"}]},{elementSelector:".primary-color",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".primary-text",properties:[{property:"color",value:l.textColor+" !important"}]},{elementSelector:".primary-button",properties:[{property:"color",value:l.textColor+" !important"},{property:"background-color",value:l.color+" !important"}]},{elementSelector:".style3 .text-center.data-subtitle",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".style3 .user-chat-bubble",properties:[{property:"background-color",value:l.color+" !important"},{property:"color",value:l.textColor+" !important"}]},{elementSelector:".style3 .send-btn",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".style3 #chatWindowHeader",properties:[{property:"background-color",value:l.color+" !important"}]},{elementSelector:".style3 .slick-next:before",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".style3 .slick-prev:before",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".primary-hover:hover",properties:[{property:"color",value:""+l.buttonColorHover,override:!0},{property:"border-color",value:""+l.buttonBackgroundColorHover,override:!0},{property:"background-color",value:""+l.buttonBackgroundColorHover,override:!0}]})}}if(isNonEmptyString(e.BubbleBackgroundColor)&&_&&(_.style.backgroundColor=e.BubbleBackgroundColor),isNonEmptyString(e.EnableSpeech)&&window.hasOwnProperty("webkitSpeechRecognition")&&(equalsIgnoreCase(e.EnableSpeech,"true")?showElements(Y):hideElements(Y)),isNonEmptyString(e.EnableQRFeature)&&(equalsIgnoreCase(e.EnableQRFeature,"true")?(showElements(Z),showElements(J)):(hideElements(Z),hideElements(J))),isNonEmptyString(e.ManualModeAtStart)&&ot&&(equalsIgnoreCase(e.ManualModeAtStart,"true")?ot.ManualModeAtStart=!0:ot.ManualModeAtStart=!1),applyStyle(e.WindowStyle),isNonEmptyString(e.UserPersona)&&(t&&(e.UserPersona=replaceImageLink(e.UserPersona)),updatePersona("user",e.UserPersona,t)),isNonEmptyString(e.BotPersona)&&(t&&(e.BotPersona=replaceImageLink(e.BotPersona)),updatePersona("bot",e.BotPersona,t)),isNonEmptyString(e.FontSize)&&(V.style.fontSize=""+e.FontSize),isNonEmptyString(e.HeaderTextColor)&&(W.style.color=e.HeaderTextColor,q.style.color=e.HeaderTextColor),isNonEmptyString(e.HeaderTitle)&&(e.HeaderTitle===A?(W.innerHTML="&nbsp;",F.classList.contains(r)||F.classList.add(r)):W.textContent=e.HeaderTitle),isNonEmptyString(e.HeaderSubTitle)&&(e.HeaderSubTitle===A?q.innerHTML="&nbsp;":(q.textContent=e.HeaderSubTitle,F&&e.HeaderTitle!==A&&F.classList.contains(r)&&F.classList.remove(r))),isNonEmptyString(e.HeaderFontSize)&&(W.style.fontSize=e.HeaderFontSize),!t&&(equalsIgnoreCase(e.ShowPoweredBy,"true")?te.classList.remove("d-none"):te.classList.add("d-none"),e.PoweredBy&&e.PoweredBy.Name&&e.PoweredBy.Website)){var c=document.getElementById("brand-link");c&&(te.classList.remove("d-none"),c.setAttribute("href",e.PoweredBy.Website),c.innerText=e.PoweredBy.Name)}if(isNonEmptyString(e.PlaceholderText)&&setInputPlaceholderText(e.PlaceholderText),isNonEmptyString(e.BackgroundImage)&&setChatBackgroundImage(e.BackgroundImage),isNonEmptyString(e.BackgroundColor)&&setChatBackgroundColor(e.BackgroundColor),isNonEmptyString(e.UserChatBubbleColor)){var u=Gt.getThemeSettings(e.UserChatBubbleColor,e.UserChatBubbleColorGradient);u&&a.push({elementSelector:".user-chat-bubble",properties:[{property:"background-color",value:u.color+" !important"},{property:"color",value:u.textColor+" !important"}]})}if(isNonEmptyString(e.HeaderImage)&&(U.src=e.HeaderImage),isNonEmptyString(e.HeaderShowOnline)&&(equalsIgnoreCase(e.HeaderShowOnline,"true")?showElements(H):hideElements(H)),isNonEmptyString(e.LiveAgentCall)&&equalsIgnoreCase(e.LiveAgentCall,"true")&&equalsIgnoreCase(e.HideMenuInHeader,"false")&&vt.headerMenu.container&&showElements(vt.headerMenu.container.parentElement),Ct&&(e.DesktopMinimizeBotAtStart=e.DesktopMinimizeBotAtStart||"",e.MobileMinimizeBotAtStart=e.MobileMinimizeBotAtStart||"",e.OpenWindowAfterMilliSeconds||(e.OpenWindowAfterMilliSeconds=0),n||(o?((""==e.MobileMinimizeBotAtStart||equalsIgnoreCase(e.MobileMinimizeBotAtStart,"false")||0<e.OpenWindowAfterMilliSeconds)&&setTimeout(function(){maximizeChatWindow()},e.OpenWindowAfterMilliSeconds),toggleFullScreen()):(""==e.DesktopMinimizeBotAtStart||equalsIgnoreCase(e.DesktopMinimizeBotAtStart,"false")||0<e.OpenWindowAfterMilliSeconds)&&setTimeout(function(){maximizeChatWindow()},e.OpenWindowAfterMilliSeconds))),0<a.length&&injectStyles(a),isNonEmptyString(e.Languages)){var m=e.Languages.trim().split(",");if(m&&0<m.length){var p=getLanguageItems(m);p&&1<=p.length&&(p[0].value,p.forEach(function(e){e.value===we&&e.value})),addLanguageDropdown(p)}}if(e.CustomPanelCss){var g=document.createElement("style");g.innerText=e.CustomPanelCss,document.head.appendChild(g)}e.IdleTimeoutSeconds&&(_t.idleTimeSec=e.IdleTimeoutSeconds,_t.disconnectOnIdleId&&window.clearInterval(_t.disconnectOnIdleId),_t.disconnectOnIdleId=window.setInterval(disconnectOnIdle,1e3*_t.idleTimeSec))}}function changeMaterialIcon(e){}function changeFontAwesomeIcon(e,t){var n=e.classList,a=!0,o=!1,r=void 0;try{for(var i,s=n[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value;l.startsWith("fa-")&&e.classList.remove(l)}}catch(e){o=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}e.classList.add(t)}function addStyle(e){document.body.classList.remove("style1"),document.body.classList.remove("style3"),document.body.classList.add(e)}function calculateLength(e,t){if(e.textContent){for(var n=0,a=0;a<e.textContent.length;a++){var o=e.textContent.charAt(a);" "==o?n+=4:o==o.toLowerCase()?n+=9:n+=12}var r=1;"style3"==kt?n<=50?r=3:n<=100&&(r=2):n<=90?r=3:n<=160&&(r=2),t.push(r)}else t.push(-1);return t}function bubbleResize(){var e=document.querySelectorAll(".option-pill-container");if(e&&e.length){var t=[];Array.prototype.forEach.call(e,function(e){t=calculateLength(e,t)});for(var n=3,a=0;a<t.length;){for(var o=t[a],r=t[a],i=!0,s=1;s<o;s++)a+s<t.length?t[a+s]>=r||(i=!1):i&&0<a&&r==n?(o=s,s+=t[a]):i=!1;if(i){var l="option-pill-"+r;for(s=0;s<o;s++)e[a+s].className=e[a+s].className.replace(/option-pill-\d+/g,l);a+=o,r<n&&(n=r)}else t[a]=t[a]-1}}}function applyStyle(e){if(isNonEmptyString(e)){kt=e;var t=document.querySelectorAll(".fa-fw"),n=["fa-paper-plane","fa-play"],a=Array.from(t).filter(function(e){var t=Array.from(e.classList);return n.some(function(e){return t.includes(e)})});equalsIgnoreCase(e,"style3")?(addStyle(e),changeMaterialIcon("more_horiz"),a.forEach(function(e){changeFontAwesomeIcon(e,"fa-play")}),replaceChatwindowCssWithNewFile("chatwindow_style3"),bubbleResize()):(addStyle(e),changeMaterialIcon("more_vert"),a.forEach(function(e){changeFontAwesomeIcon(e,"fa-paper-plane")}))}}function replaceChatwindowCssWithNewFile(e){var t=document.createElement("link");t.href="./dist/css/"+e+".css",t.rel="stylesheet",document.head.appendChild(t)}function replaceImageLink(e){var t=e;if(isNonEmptyString(e)){var n=e.match(O);if(n&&0<n.length){var a=n[0],o=a.match(P);o&&0<o.length&&(t=e.replace(a,o[0]))}}return t}function chooseColor(e){var t=Gt.normalizeColor(e);return t&&Gt.getPercievedBrightness(t)>=Gt.BRIGHTNESS_THRESHOLD?"#000000ff":e}function setWindowTitle(e){e&&W&&(W.textContent=e)}function setInputPlaceholderText(e){e&&G&&(G.placeholder=e)}function getHeaderImage(){return ie&&ie.HeaderImage&&"string"==typeof ie.HeaderImage?ie.HeaderImage:defaultWindowConfig.HeaderImage}function getFrameColor(){return isNonEmptyString(ie.FrameColor)?ie.FrameColor:mt.FrameColor}function setChatBackgroundImage(e){e&&z&&(z.style.backgroundImage="url("+e+")")}function setChatBackgroundColor(e){isNonEmptyString(e)&&(z.style.backgroundColor=e)}function hideChatWindow(){notifyParent(tt.ChatWindowClose),dispatchEventToParent(nt.ChatWindowClose,{source:"userClick"})}function goBackFromChatWindow(){T=null,notifyPortalWindow(tt.ChatWindowBack,"user-click"),document.getElementById("chatWindow").classList.add("k-hide"),document.getElementById("chatWindowHeader").style.display="none",document.getElementById("chatWindowBody").style.zIndex="",document.getElementById("chatWindowFooter").style.zIndex="",document.getElementById("headerBackButton").classList.add("k-hide")}function notifyPortalWindow(e,t){var n={type:e,value:t||null};window.postMessage(n,"*")}function maximizeChatWindow(){notifyParent(tt.ChatWindowOpen)}function createUserChatBubble(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=document.createElement("div");if(o.classList.add("d-inline-block","px-2","py-2","float-right","user-chat-bubble"),a){var r=document.createElement("img");r.src=a,r.alt="User sent image",r.classList.add("user-sent-image"),r.style.maxWidth="200px",r.style.display="block",r.style.marginTop="5px",o.appendChild(r)}else if(e){var i=document.createElement("p");i.textContent=e,o.appendChild(i)}return n||o.appendChild(getMessageTimestamp(t)),o}function createBotChatBubble(e,t,n,a,o,r,i){var s=7<arguments.length&&void 0!==arguments[7]&&arguments[7],l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:null;e||(e="");var d=document.createElement("div");if(d.classList.add("d-inline-block","px-2","py-2","bot-chat-bubble"),d.innerHTML=marked(e),modifyLinksToOpenInNewTab(d),t&&0<t.length){var c=renderCards(t,n,a,r,i);c&&d.appendChild(c),n&&(n!==Qe.MediumButton&&n!==Qe.VerticalCard||d.classList.add("chat-bubble-fullwidth"),n===Qe.File&&d.classList.add("min-width-50"),n===Qe.Location&&(d.classList.add("min-width-50"),d.classList.add("chat-bubble-flexible-width")))}if(o){var u=me;if(!u){var m=(isLocalEnvironment()?Fe.LOCAL:Fe.PROD)+"/create/bot";pe&&pe.startsWith(m)&&(u=!0)}if(u&&E){var p=document.createElement("div");p.classList.add("pointer","intent-edit");var g=(isLocalEnvironment()?Fe.LOCAL:Fe.PROD)+"/settings/training?orgid="+E.OrganizationId+"&botid="+E.BotId+"&xpath="+o;p.innerHTML='<span class="fa fa-pencil intent-edit-icon"></span>',p.addEventListener("click",function(){var e={url:g,openInSamePage:!1};notifyParent(tt.NavigateToPage,e)}),d.appendChild(p)}}if(s&&l&&Ht){var f=createMessageFeedbackContainer(l);f&&d.appendChild(f)}if("Agent has left the conversation."==e&&l&&h){var v=createAgentChatFeedbackContainer(l);v&&d.appendChild(v)}return d}function convertToBotChatBubble(e){return e&&e.classList.add("d-inline-block","px-2","py-2","bot-chat-bubble"),e}function modifyLinksToOpenInNewTab(e){if(e){var t=Array.from(e.querySelectorAll("a"));t&&0<t.length&&t.forEach(function(e){e.target||(e.target="_blank")})}}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function isString(e){return e&&"string"==typeof e}function isNonEmptyString(e){return isString(e)&&0<e.trim().length}function getCurrentState(){return{botName:ce,lastConversationId:de,conversationLanguage:we,timestamp:new Date,botUserWebContext:ot,messages:me?[]:Ie}}function getCurrentSessionState(){return{conversationId:de,isMinimized:lt,menu:vt.headerMenu.content,userPersona:it,botName:ce,expandType:ae&&ae.getAttribute("data-toggle")||null,timestamp:new Date,pageUrl:pe,queryUserDenied:m}}function restoreUserIdIfExists(){if(xe){var e=window.localStorage.getItem(C);if(e){se=e;var t=window.localStorage.getItem(S);le=!(!t||"true"!==t)}}}function restoreState(e,t){e&&(e.timestamp&&(e.timestamp=new Date(e.timestamp)),e.lastConversationId&&e.lastConversationId!==de&&(differenceInMinutes(e.timestamp,new Date)<He?(de=e.lastConversationId,notifyParent(tt.Initialize,de),e.messages&&0<e.messages.length&&(restoreChatHistory(e.messages,t),window.setTimeout(function(){scrollToEnd(z)},0))):(Ie=[],ot.SessionCount?ot.SessionCount=ot.SessionCount+1:ot.SessionCount=1)),e.conversationLanguage&&(we=e.conversationLanguage))}function restoreSessionState(e){if(e&&e.botName&&e.botName===ce){if(e.conversationId&&(de=e.conversationId),e.userPersona&&updatePersona("user",e.userPersona),e.expandType)ae.getAttribute("data-toggle")!==e.expandType&&toggleFullScreen();e.isMinimized||!1===lt||maximizeChatWindow(),renderHeaderMenu(e.menu)}}function restoreChatHistory(e,t){t||e.forEach(function(e){if(e.message)if(e.isUserMessage){"user"!==T&&addSenderDetails("user",e.messageTimestamp,!0);var t=null;e&&(t=e.imageData),addToChatWindow(createUserChatBubble(e.displayMessage?e.displayMessage:e.message,e.messageTimestamp,!0,t)),T="user"}else{if(T!==e.message.DisplayName&&addSenderDetails(e.message.DisplayName,e.messageTimestamp),e.customMessage&&e.customMessage.messageType===at.Form&&isArray(e.customMessage.values)){var n=shallowClone(e.customMessage.values);n.fields.forEach(function(e){e&&isNonEmptyString(e.validationPattern)&&(e.validationPattern=new RegExp(e.validationPattern))}),T!==e.customMessage.displayName&&addSenderDetails(e.customMessage.displayName,e.messageTimestamp),renderForm(n)}(isObject(e.message)||isNonEmptyString(e.message))&&renderMessage(e.message,!0),T=e.message.DisplayName}}),0<(Ie=e||[]).length&&!isNaN(Ie[Ie.length-1].id)&&(Tt=Ie[Ie.length-1].id+1||Tt)}function saveStateLocally(){if(xe){window.localStorage.setItem(C,se||""),le?window.localStorage.setItem(S,"true"):window.localStorage.removeItem(S);var e=getCurrentState();window.localStorage.setItem(ye,JSON.stringify(e)),saveSessionState()}else console.warn("[Kenyt.AI] Unable to store state, Cookies are disabled")}function saveSessionState(){var e=getCurrentSessionState();window.sessionStorage.setItem(he,JSON.stringify(e))}function retrieveLocalStateIfExists(){if(xe){var e=window.localStorage.getItem(ye);return e?JSON.parse(e):e}return null}function retrieveSessionStateIfExists(){if(xe){var e=window.sessionStorage.getItem(he);return e?JSON.parse(e):e}return null}function getParentUrl(){var e=getUrlParam("origin")||document.referrer;return e||console.warn("Cannot retrieve parent URL"),e}function isLocalEnvironment(){var e=window.location.href;return 0<=e.indexOf("http://localhost")||e.startsWith("file:///")}function isNgrokEnvironment(){return 0<=window.location.href.indexOf("ngrok-free.app")}function detectAppName(){return isLocalEnvironment()?Be:isNgrokEnvironment()?"https://"+window.location.hostname+Oe:De}function isDate(e){return e&&!isNaN(e.getTime())}function disableLoggingIfProduction(e){}function createForm(n,i,t,e){var a=n.tag||"div",s=document.createElement(a);s.classList.add("form"),s.style.backgroundColor=n.formBgColor||"#ffffff",checkIfBackgroundDark(s.style.backgroundColor)&&(s.style.color="White");var o=document.createElement("span"),r=document.createElement("p");o.classList.add("h6","font-weight-bold"),r.classList.add("m-0"),o.textContent=null!=i.Title?i.Title:n.title,r.textContent=null!=i.Description?i.Description:n.description,s.appendChild(rowContainer(["mt-1"],columnContainer(["text-center"],o,r)));var l=document.querySelector(".portal-header-title");if(l instanceof HTMLElement&&(l.textContent=n.description),i.Slots){var d=i["Appointment Date"];d||(d={}),d.datetimepickersettings||(d.datetimepickersettings={}),d.datetimepickersettings.beforeShowDay=function(e){var t=Vt.getDateKeys(e),n=!1;return t.every(function(e){return!i.Slots[e]||(n=0<i.Slots[e].length,!1)}),[n,""]},i["Appointment Date"]=d;var c=i["Appointment Time"];c||(c={}),c.datatype="dropdown",c.need="Appointment Date",c.beforeShow=function(e){var n=this,t=Vt.getDateKeys(e),a=c.value;t.every(function(e){return!i.Slots[e]||(a=i.Slots[e],!1)}),a||(a="10 AM, 11 AM, 12 PM, 1 PM, 2 PM, 3 PM, 4 PM, 5 PM, 6 PM, 7 PM, 8 PM"),this.inputElementRef.innerHTML="",a.forEach||(a=a.split(",")),a.forEach(function(e){var t=document.createElement("option");t.innerText=e,t.value=e,n.inputElementRef.appendChild(t)})},i["Appointment Time"]=c}var u=void 0,m="";n.fields.forEach(function(r){var e=createInputRowFromField(r,i),a=e.colEle;if("submit"===e.inputElementRef.type&&(m=e.inputElementRef.placeholder),a&&"true"!==r.hide){if(r.inputElementRef=e.inputElementRef,r.inputContainer=e.inputContainer,r.feedbackElementRef=e.feedbackElementRef,r.takeHalfRow&&a.classList.add("col-6"),u)u.appendChild(a),s.appendChild(u),u=null;else{var t=rowContainer(["mt-2"],a);s.appendChild(t),r.takeHalfRow&&(u=t)}if(r.need&&n.fields.forEach(function(o){if(r.need===o.field&&o&&o.inputElementRef){if("datetime"===o.datatype){!r.beforeShow&&o.Slots&&(r.beforeShow=function(e){var n=this,t=Vt.getDateKeys(e),a=r.value;t.every(function(e){return!o.Slots[e]||(a=o.Slots[e],!1)}),a||(a="10 AM, 11 AM, 12 PM, 1 PM, 2 PM, 3 PM, 4 PM, 5 PM, 6 PM, 7 PM, 8 PM"),this.inputElementRef.innerHTML="",a.forEach||(a=a.split(",")),a.forEach(function(e){var t=document.createElement("option");t.innerText=e,t.value=e,n.inputElementRef.appendChild(t)})});var t=o.datetimepickersettings.onChangeDateTime;o.datetimepickersettings.onChangeDateTime=function(e){t&&t(e),r.beforeShow&&r.beforeShow(e),showElements(r.inputContainer),scrollToEnd(z)}}else o.inputElementRef.addEventListener("change",function(){showElements(r.inputContainer),scrollToEnd(z)},!1);hideElements(r.inputContainer)}}),r.addMore){r.extraInputs=r.extraInputs||[];var o=document.createElement("button");o.textContent=" + ",o.classList.add("btn","primary-button","add-more-btn"),o.addEventListener("click",function(e){e.preventDefault();var t=createInputRowFromField(r,i),n=rowContainer(["mt-2"],t.colEle);a.parentNode.parentNode.insertBefore(n,a.parentNode.nextSibling),r.extraInputs.push({inputElementRef:t.inputElementRef,feedbackElementRef:t.feedbackElementRef}),4==r.extraInputs.length&&hideElements(o)}),a.appendChild(o)}}});var p=document.createElement("button");p.textContent="Cancel",p.classList.add("btn","btn-secondary"),e&&p.addEventListener("click",function(){e()});var g=document.createElement("button");return g.textContent=" "+(m||n.submit||getButtonsText("Submit"))+" ",g.classList.add("btn","primary-button"),e||g.classList.add("mr-2"),n.onSubmit?s.onsubmit=n.onSubmit:t&&g.addEventListener("click",function(e){n.OnSubmit?t(e,n.fields,n.submit,n.submitType,!0,n.OnSubmit,m):t(e,n.fields,n.submit,n.submitType,!0,"",m)}),e?s.appendChild(rowContainer(["mt-2"],columnContainer(["text-center"],g,p))):s.appendChild(rowContainer(["mt-2"],columnContainer(["text-center"],g))),s}function createInputRowFromField(t,n,e){if(n[t.field]){if(n[t.field].value&&(t.value=n[t.field].value),n[t.field].isMandatory&&(t.isMandatory=n[t.field].isMandatory),n[t.field].need&&(t.isMandatory=n[t.field].need),n[t.field].beforeShow&&(t.beforeShow=n[t.field].beforeShow),n[t.field].telSettings)if(t.telSettings)Object.keys(n[t.field].telSettings).forEach(function(e){t.telSettings[e]=n[t.field].telSettings[e]});else t.telSettings=n[t.field].telSettings;if(n[t.field].datetimepickersettings)if(t.datetimepickersettings)Object.keys(n[t.field].datetimepickersettings).forEach(function(e){t.datetimepickersettings[e]=n[t.field].datetimepickersettings[e]});else t.datetimepickersettings=n[t.field].datetimepickersettings;n[t.field].errorMessage&&(t.errorMessage=n[t.field].errorMessage),n[t.field].validationPattern&&(t.validationPattern=n[t.field].validationPattern),n[t.field].image&&(t.image=n[t.field].image),n[t.field].imageClass&&(t.imageClass=n[t.field].imageClass)}var a=document.createElement("label"),o=document.createElement("input"),r=document.createElement("div");if(t.dataType&&(t.datatype=t.dataType),"dropdown"===t.datatype){t.options=t.options||t.value;var i=t.displayName||t.field;(o=createDropdownElement(t.options,i)).name=t.field}else o.type=t.datatype,t.placeholder?a.innerHTML=t.placeholder:a.textContent=t.displayName||t.field,o.placeholder=t.placeholder||t.displayName||t.field,o.placeholder=getButtonsText(o.placeholder),t.value&&(o.value=t.value);t.name&&(o.name=t.name),o.classList.add("form-control"),o.style.fontStyle="inherit",t.readonly&&o.setAttribute("readonly","readonly"),t.min&&(o.min=t.min),t.max&&(o.max=t.max),r.classList.add("invalid-feedback","d-none"),r.textContent=t.errorMessage;var s=void 0,l=void 0,d=void 0;if("money"===t.datatype){(d=document.createElement("div")).classList.add("currency-container");var c=createDropdownElement(Xe,"");c.style.width="25%",c.style.border="1px solid #ced4da",c.value="INR",d.appendChild(c),d.appendChild(o),o.type="number",t.prefixAttribute=c}if(t.image){var u=createIconElement(t.image);if(u){var m="icon-container";t.imageClass&&(m=m+","+t.imageClass),m=m.split(","),o.placeholder&&u.setAttribute("title",o.placeholder);var p=genericContainer(m,u);l=genericContainer(["input-container"],p,d||o)}}if(l||(l=d?genericContainer(["input-container"],d):genericContainer([],o)),"checkbox"===t.datatype?(o.name=t.field,o.classList.remove("form-control"),equalsIgnoreCase(t.value,"true")&&(o.checked=!0),(s=columnContainer([],l,a,r)).classList.add("checkbox"),r.style.display="block"):s=t.useLabel?columnContainer([],a,l,r):columnContainer([],l,r),n&&n.Mandatory&&n.Mandatory.includes(t.field)&&(t.isMandatory=!0),"tel"===t.datatype&&t.validationSource===L){var g="IN";n&&n.CountryCode&&(g=n.CountryCode);var f={geoIpLookup:function(e){e(g)},hiddenInput:"full_number",initialCountry:"auto",placeholderNumberType:"MOBILE",preferredCountries:["in","us"],separateDialCode:!0,utilsScript:k};if(t.telSettings)Object.keys(t.telSettings).forEach(function(e){f[e]=t.telSettings[e]});o.value||(o.setAttribute("type","number"),o.setAttribute("onkeydown","javascript: return event.keyCode == 69 ? false : true"));var v=window.intlTelInput(o,f);o.style.paddingLeft="85px",r.style.display="block",t.pluginObj=v}return o.addEventListener("change",handleFormInputChange),{colEle:s,inputElementRef:o,inputContainer:l,feedbackElementRef:r}}function createDropdownElement(e,t){var a=document.createElement("select");if(e){e.forEach||(e=e.split(","));var n=document.createElement("option");n.innerText=t||"Please select",n.value="",a.appendChild(n),e.forEach(function(e){var t=document.createElement("option"),n=e.split(":");t.value=1<n.length?n[1]:n[0],t.innerText=n[0],a.appendChild(t)})}return a}function handleFormInputChange(e){if(window.KENYT_API&&window.KENYT_API.onFormInputChange){var t={event:e,state:window.KENYT_API};window.KENYT_API.onFormInputChange(t)}}function rowContainer(e){e.push("row");for(var t=arguments.length,n=Array(1<t?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return genericContainer.apply(void 0,[e].concat(n))}function getButtonsText(e){var t=e;return e&&Lt&&Lt[e]&&(t=Lt[e]),t}function columnContainer(e){e.push("col");for(var t=arguments.length,n=Array(1<t?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return genericContainer.apply(void 0,[e].concat(n))}function genericContainer(e){var t=document.createElement("div");e.forEach(function(e){return t.classList.add(e)});for(var n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return a.forEach(function(e){return t.appendChild(e)}),t}function hideElements(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){e&&!e.classList.contains("d-none")&&e.classList.add("d-none")})}function showElements(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){e&&e.classList.contains("d-none")&&e.classList.remove("d-none")})}function setFormFieldAsValid(e){var t=e.inputElementRef;t&&(t.classList.contains("is-invalid")?replaceClass(t,"is-invalid","is-valid"):t.classList.add("is-valid")),hideElements(e.feedbackElementRef)}function setFormFieldAsInvalid(e){var t=e.inputElementRef;t&&(t.classList.contains("is-valid")?replaceClass(t,"is-valid","is-invalid"):t.classList.add("is-invalid")),showElements(e.feedbackElementRef)}function convertToCSV(t){var n=[];return t&&"object"===(void 0===t?"undefined":a(t))&&Object.keys(t).forEach(function(e){n.push(e+"::"+t[e])}),n.join(", ")}function notifyParent(e,t){var n={type:e,value:t||null};window.parent.postMessage(n,"*")}function notifyParentAndListenCallback(e,t,n,a){var o={type:e,value:t||null},r=!1;function handleMessage(e){e&&e.data&&e.data.type===tt.SetCustomContext&&(window.removeEventListener("message",handleMessage),r||(a(e.data),r=!0)),r||(window.removeEventListener("message",handleMessage),a())}if("true"===n){window.addEventListener("message",handleMessage);setTimeout(function(){r||(window.removeEventListener("message",handleMessage),a(),r=!0)},3e3)}else a();window.parent.postMessage(o,"*")}function notifyInFrameWindow(e,t){var n={type:e,value:t||null};window.parent.postMessage(n,"*");var a=document.querySelector("#kenytInWindow").contentWindow;if(a){var o={type:tt,value:value};a.postMessage(o,"*")}}function getCurrentTimeString(){var e=new Date,t=e.getHours()%12;return 0===t&&(t=12),t+":"+("0"+e.getMinutes()).slice(-2)+" "+(12<=e.getHours()?"PM":"AM")}function getMessageTimestamp(e){var t=document.createElement("span");return t.classList.add("float-right","text-muted","message-timestamp"),t.innerHTML=e||getCurrentTimeString(),t}function scrollToEnd(e){e&&(e.scrollTop=e.scrollHeight)}function notifyUnreadMessages(e){lt&&(e&&(e=marked(e)),notifyParent(tt.UnreadMessage,e))}function injectStyles(e){if(e&&0<e.length){var n="";e.forEach(function(e){var t="";e.properties&&(e.properties.forEach(function(e){t+=e.property+":"+e.value+" "+(e.override?"!important":"")+";"}),n+=e.elementSelector+"{"+t+"}")}),$("<style>"+n+"</style>").appendTo("head")}}function sendSuspendedMessagesIfAny(){ht&&0<ht.length&&(ht.forEach(function(e){e.invokeType?l.invoke(e.invokeType,e.botRequest):makeBotRequest(e.botRequest,e.viewRef,e.displayText,e.skipHistory,e.count)}),ht=[])}function testLocalStorage(){var e="__feature_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}function notifyConnectionIssues(e,t){var n=document.querySelector("#errorbar");if(n){e=e||"Lost connection due to inactivy. ",t||(e+=' <span class="fa fa-spin fa-spinner fa-pulse"></span>'),n.innerHTML=e;var a=new Date;if(ut&&ut.pageStartAt)10<(a.valueOf()-ut.pageStartAt.valueOf())/1e3?showElements(n):console.log(e)}}function clearConnectionIssues(){var e=document.querySelector("#errorbar");e&&(hideElements(e),e.innerHTML="")}function sendTrackingUpdate(e){if(e&&!It){for(var t=0;t<e.length;t++)e[t].UserId=se,t===e.length-1&&(e[t].EndTime=new Date);l.invoke("TrackingUpdate",se,ce,e).done(function(e){e||trackError({message:"Tracking update returned false"},!1)}).fail(function(e){trackError({message:"Tracking update failed: "+e},!1)}),It=!0}}function isMobileDevice(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function eventData(e,t,n){return{event_category:e||null,event_label:t||null,value:n||null}}function changeConversationLanguage(e,t){isNonEmptyString(e)&&(we=e,be&&(be.lang=e),0<Ie.length&&(t||sendMessageToServer("start conversation",null,!1,!0)),gtag("event","language_change",eventData("user_interaction",null,e)),X&&(X.textContent=e.substr(0,2).toUpperCase()))}function requestLanguageChange(e,t){t||(t=!1);var n={UserId:se,ConversationId:de,BotId:E?E.BotId:0,LanguageCode:e,PreventHiMessage:t};Se.isConnected?l.invoke("ChangeChatLanguage",n):(console.warn("[Kenyt.AI] Connection not yet initiated, suspending message.."),suspendMessage(n,null,!1,!0,"ChangeChatLanguage"),initializeServerConnection())}function getLanguageItems(e){var n=[];return e&&0<e.length&&e.forEach(function(t){if(isNonEmptyString(t)){var e=ze.find(function(e){return e.value===t.trim().toLowerCase()||e.value===t.trim()});e?n.push(e):console.warn("ignoring Unknown language code: "+t)}}),n}function addLanguageDropdown(e){var a=document.querySelector("#languageMenu");if(e&&a){for(;a.hasChildNodes();)a.removeChild(a.firstChild);if(e.length<=1)hideElements(X);else{showElements(X);var t=document.createElement("h6");t.classList.add("dropdown-header"),t.textContent="Choose language",a.appendChild(t),e.forEach(function(t){var n=document.createElement("button");n.textContent=t.displayText?t.displayText:t.text,n.addEventListener("click",function(){requestLanguageChange(t.value);var e=Array.from(a.querySelectorAll(".dropdown-item.active"));e&&0<e.length&&e.forEach(function(e){return e.classList.remove("active")}),n.classList.add("active")}),n.classList.add("dropdown-item"),a.appendChild(n)})}}}function updateSession(e){e.setNewUser&&(de=se="",saveStateLocally(),sendMessageToServer("start conversation",null,!1))}function restartSession(t){var e=Ke+"?botId="+ce,n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-type","application/json");var a={IsTest:me,SessionUserId:se,QueryClientUserId:ue,ConversationId:t.NewConversationId,ConversationLanguage:"",TimezoneOffsetMinutes:-1*(new Date).getTimezoneOffset(),SourceUrl:pe,TriggerAutoMessage:!0,AutoMessageText:t.AutoMessageText,InitializeConnection:!0,ConversationContext:ge},o=JSON.stringify(a);n.onload=function(e){t.ClearWindow&&clearChat(),handleLoadChatWindowResponse(e)},n.send(o)}function toggleFullScreen(){var e=ae.getAttribute("data-toggle"),t=ae.querySelector("span");notifyParent(tt.ToggleFullScreen,e),"maximize"===e?(ae.setAttribute("data-toggle","minimize"),t&&replaceClass(t,"fa-window-maximize","fa-window-minimize")):(ae.setAttribute("data-toggle","maximize"),t&&replaceClass(t,"fa-window-minimize","fa-window-maximize")),saveStateLocally()}function addSenderDetails(e,t,n){if(isNonEmptyString(e)&&isNonEmptyString(t)){var a=document.createElement("div"),o=document.createElement("span"),r=document.createElement("span");if(o.textContent=e,o.classList.add("persona"),r.textContent=""+t,r.classList.add("timestamp","mx-1"),"user"===e||"bot"===e){var i=document.createElement("img"),s="bot"===e?st:it,l="bot"===e?"bot-persona":"user-persona",d=document.createElement("span");"bot"===e?d.classList.add("fa","fa-robot"):d.classList.add("fa","fa-user"),o.textContent=s.name,o.classList.add(l),i.classList.add(l),isNonEmptyString(s.imageUrl)?(i.src=s.imageUrl,d.classList.add("d-none")):i.classList.add("d-none"),i.addEventListener("error",function(){i.classList.add("d-none"),console.warn("Image not found: "+imageUrl)}),15==ce&&a.appendChild(d),a.appendChild(i)}a.appendChild(o),a.appendChild(r),a.classList.add("message-sender","px-3","w-100","mt-2"),n&&a.classList.add("text-right"),V.appendChild(a),rt=!0}}function differenceInMinutes(e,t){if(isDate(e)&&isDate(t)){var n=Math.abs(e.valueOf()-t.valueOf());return Math.floor(n/1e3/60)}return NaN}function forceFullHeight(){notifyParent(tt.ForceFullHeight)}function replaceClass(e,t,n){return!!(e&&t&&n&&e.classList.contains(t))&&(e.classList.remove(t),e.classList.add(n),!0)}function updatePersona(e,t,n){if(isNonEmptyString(e)&&isNonEmptyString(t)){var a=t.match(P),o=a&&0<a.length?a[0]:null,r=void 0;o&&(t=" "+t.replace(o,"").trim());var i={name:t,imageUrl:o};if(equalsIgnoreCase(e,"bot")?(st=i,r="bot-persona"):equalsIgnoreCase(e,"user")&&(it=i,r="user-persona"),!n&&isNonEmptyString(r)){var s=Array.from(V.querySelectorAll("span."+r));Array.from(V.querySelectorAll("img."+r)).forEach(function(e){isNonEmptyString(i.imageUrl)?(e.src=i.imageUrl,e.classList.remove("d-none")):e.classList.add("d-none")}),s.forEach(function(e){e.textContent=i.name})}}}function createIconElement(e){var t=null;if(e)if(e.startsWith("icon:")){var n=e.substr(5);n&&(t=document.createElement("span")).classList.add("fa","fa-"+n)}else e.startsWith("fa-")&&(t=document.createElement("span")).classList.add("fa",""+e);return t}function equalsIgnoreCase(e,t){return isString(e)&&isString(t)&&e.toLowerCase()===t.toLowerCase()}function parseWindowConfig(e){var t={};if(e)for(var n=e.split(";"),a=0;a<n.length;a++){var o=n[a];if(o){var r=o.split("=");if(1<r.length){var i=r[0].trim(),s=r[1].trim();t[i]=s}}}return t}function renderForm(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(e){zt.sanitizeFormTemplate(e);var o=createForm(e,t,n=n||handleFormValues);if(a)return o;var r=createBotChatBubble();r.classList.add("w-95"),r.appendChild(o),addToChatWindow(r),e.fields.forEach(function(e){e.afterAppend&&e.afterAppend()})}else console.warn("Invalid form"),console.warn(e)}function getFormSettings(e){var t=[];return e&&(t=JSON.parse(e)),t}function addFormToChatHistory(e,t){var n=shallowClone(e);n.fields.forEach(function(e){e&&e.validationPattern&&isRegExp(e.validationPattern)&&(e.validationPattern=e.validationPattern.source)}),Ie.push({id:Tt++,isUserMessage:!1,message:" ",messageTimestamp:getCurrentTimeString(),displayMessage:null,customMessage:{messageType:at.Form,values:n,displayName:t}})}function clearChatWindow(){if(V)for(var e=V.childElementCount;1<e;){var t=V.lastElementChild;V.removeChild(t),e-=1}}function clearChat(){Ie=[],T=null,clearChatWindow(),gt=[],saveStateLocally()}function isObject(e){return e&&"object"===(void 0===e?"undefined":a(e))}function isFunction(e){return e&&"function"==typeof e}function isArray(e){return isObject(e)&&e instanceof Array}function isRegExp(e){return isObject(e)&&e instanceof RegExp}function isEmpty(e){return 0===Object.keys(e).length}function shallowClone(t){var n=void 0;return isArray(t)?(n=[],t.forEach(function(e){n.push(shallowClone(e))})):isFunction(t)||(isObject(t)?(n={},Object.keys(t).forEach(function(e){n[e]=shallowClone(t[e])})):n=t),n}function handleAgentJoin(e,t){addToChatWindow(createTextSpan("⛊ You are now chatting with "+(t||e||"Agent")),"text-strip")}function handleAgentExit(e,t){addToChatWindow(createTextSpan("⛊ "+(t||e||"Agent")+" has left the conversation"),"text-strip")}function createTextSpan(e){var t=document.createElement("span");return t.textContent=e,t}function deleteChild(e){if(e)for(var t=e.lastElementChild;t;)e.removeChild(t),t=e.lastElementChild}function handleSpeechButton(){be&&(be.abort(),be.start(),gtag("event","Button_Speech_Start",eventData("user_interaction",null,null)))}function handleCallButton(){sendMessageToServer("Caller form","Contact Agent",!1,!1,!1)}function onStopSpeechRecognition(){be.stop(),gtag("event","Button_Speech_Stop",eventData("user_interaction",null,null))}function speakText(e){if(window.speechSynthesis){var t=new SpeechSynthesisUtterance(e);t.lang=we+"-IN",t.pitch=1,t.rate=1,t.volume=1,speechSynthesis.paused&&speechSynthesis.resume(),window.speechSynthesis.speak(t)}}function getDateValue(e,t,n){var a=new Date,o=String(a.getDate()+e).padStart(2,"0"),r=String(a.getMonth()+t+1).padStart(2,"0");return a=String(a.getFullYear()+n)+"-"+r+"-"+o}function getBrowserInformation(){window.navigator||(window.navigator={});var e=window.navigator.userAgent.toLowerCase(),t="";t=0<=e.indexOf("windows")?"Windows":0<=e.indexOf("linux")?"Linux":0<=e.indexOf("mac")?"macOS":0<=e.indexOf("blackberry")?"BlackBerry":0<=e.indexOf("android")?"Android":0<=e.indexOf("iphone")||0<=e.indexOf("ipad")?"iOS":"unknown";var n="Desktop";return isMobileDevice()&&(n="Mobile"),{Browser:window.navigator.browserInfo||"",OperatingSystem:t,Referrer:dt.pageReferrer||"",Device:n,RawUserAgent:window.navigator.userAgent||"",PageUrl:getParentUrl()||"",PageTitle:dt.pageTitle||""}}function getContactFormTemplate(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=[{field:"Name",datatype:"text",errorMessage:"please enter a valid name",isMandatory:!1,image:"icon:user"},{field:"Email",datatype:"email",errorMessage:"please enter a valid email address",validationPattern:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,isMandatory:!1,image:"icon:envelope"},{field:"Mobile",datatype:"tel",errorMessage:"please enter a valid phone number",validationSource:L,isMandatory:!1,image:"icon:phone"}],n={title:getButtonsText("Contact Information"),description:getButtonsText("Please enter your contact details"),fields:t};if(e){var a=JSON.parse(e);a.OnSubmit&&(n.OnSubmit=a.OnSubmit)}return n}function getTemplate(e){var t=void 0,n=document.querySelector("#"+e);return n&&(t=document.importNode(n.content.firstElementChild,!0)),t}function getUploadFormTemplate(){return{title:"Please upload your file(s)",description:"",fields:[{field:"File",datatype:"file",name:"file",errorMessage:"please select a valid file",isMandatory:!0,addMore:{limit:5}}],tag:"form"}}function dispatchEventToParent(e,t){var n={EventName:e,EventData:t||null};notifyParent(tt.CustomEventDispatch,n)}function suspendMessage(e,t,n,a,o,r){ht||(ht=[]),ht.push({botRequest:e,viewRef:t,displayText:n,skipHistory:a,invokeType:o,count:r})}function isSafariBrowser(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function getlocaltime(){return new Date}function get2_DigitFormatting(e){return("0"+e).slice(-2)}function chatwindowHeaderTitleFix(){document.getElementById("header-content").offsetWidth?W.style.whiteSpace="nowrap":window.setTimeout(function(){chatwindowHeaderTitleFix()},1e3)}var zt={getFormDetailsFromCommand:function(e){var t,n,a;switch(e.Name){case x.APPOINTMENT_FORM.Trigger:n=(new Date).getTimezoneOffset(),a=Math.abs(n),o={title:"Select Appointment Date and Time UTC"+(n=(n<0?"+":"-")+("00"+Math.floor(a/60)).slice(-2)+":"+("00"+a%60).slice(-2)),description:"",fields:[{field:"Appointment Date",datatype:"datetime",errorMessage:"please select a valid date",isMandatory:!0,readonly:!0,image:"icon:calendar"},{field:"Appointment Time",datatype:"dropdown",errorMessage:"please select a valid time",isMandatory:!0,value:["10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM"],need:"Appointment Date",image:"icon:clock-o"}]},t=getFormSettings(e.Value);break;case x.CONTACT_FORM.Trigger:o=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=[{field:"Name",datatype:"text",placeholder:"Your Name",errorMessage:"please enter a valid name",isMandatory:!1,image:"icon:user"},{field:"Email",datatype:"email",placeholder:"Email Address",errorMessage:"please enter a valid email address",validationPattern:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,isMandatory:!1,image:"icon:envelope"},{field:"Mobile",datatype:"tel",placeholder:"Mobile Number",errorMessage:"please enter a valid phone number",validationSource:L,isMandatory:!1,image:"icon:phone"}],n={title:getButtonsText("Contact Information"),description:getButtonsText("Please enter your contact details"),fields:t};if(e){var a=JSON.parse(e);a.OnSubmit&&(n.OnSubmit=a.OnSubmit)}return n}(e.Value),t=getFormSettings(e.Value);break;case x.ADDRESS_FORM.Trigger:o={title:"Address Information",description:"Please enter your address details",fields:[{field:"Address Line 1",datatype:"text",errorMessage:"please enter a valid address",isMandatory:!0},{field:"Address Line 2",datatype:"text",errorMessage:"please enter a valid address",isMandatory:!1},{field:"City",datatype:"text",errorMessage:"Please enter a valid City",isMandatory:!0,takeHalfRow:!0},{field:"State",datatype:"text",errorMessage:"please enter a valid State",isMandatory:!0,takeHalfRow:!0},{field:"Country",datatype:"text",errorMessage:"please enter a valid Country",isMandatory:!0,takeHalfRow:!0},{field:"Zip Code",datatype:"text",errorMessage:"Please enter a valid Zip Code",validationPattern:/^[1-9][0-9]{5}$/,isMandatory:!0,takeHalfRow:!0}],submit:"address form submission",submitType:"values"},t=getFormSettings(e.Value);break;case x.GENERIC_FORM.Trigger:var o;e.Value&&(o=JSON.parse(e.Value))&&(t=getFormSettings(o.settings))}return{template:o,setttings:t}},sanitizeFormTemplate:function(e){e&&e.fields&&e.fields.forEach(function(a){if(a.dataType&&(a.datatype=a.dataType),a.datatype)if("email"===a.datatype)a.validationPattern||(a.validationPattern=Ve.EMAIL_VALIIDATION_PATTERN);else if("tel"===a.datatype)a.validationSource||(a.validationSource=Ve.PHONE_VALIDATION_SOURCE);else if("url"===a.datatype)a.validationSource||(a.validationPattern=Ve.URL_VALIIDATION_PATTERN,a.antiValidationPattern=Ve.EMAIL_VALIIDATION_PATTERN);else if("datetime"===a.datatype){if(a.datetimepickersettings){var t={timepicker:!1,format:"d-M-Y",minDate:"-1970/01/1",maxDate:"+1970/06/1",scrollMonth:!1,scrollInput:!1};Object.keys(t).forEach(function(e){a.datetimepickersettings[e]||(a.datetimepickersettings[e]=t[e])})}else a.datetimepickersettings={timepicker:!1,format:"d-M-Y",minDate:"-1970/01/1",maxDate:"+1970/06/1",scrollMonth:!1,scrollInput:!1};a.Slots&&(a.datetimepickersettings.beforeShowDay=function(e){var t=Vt.getDateKeys(e),n=!1;return t.every(function(e){return!a.Slots[e]||(n=0<a.Slots[e].length,!1)}),[n,""]}),a.readonly=!0,a.image="icon:calendar",a.afterAppend=function(){this.inputElementRef&&($(this.inputElementRef).datetimepicker(this.datetimepickersettings),this.inputContainer&&this.datetimepickersettings&&this.datetimepickersettings.inline&&this.inputContainer.classList.add("inline-datetime"))}}})}},Vt=function(){function getFullDateKey(e){var t=e.getMonth()+1,n=e.getDate();return[e.getFullYear(),(9<t?"":"0")+t,(9<n?"":"0")+n].join("-")}return{getDateKeys:function(e){var t,n,a,o,r=[];return e&&(getFullDateKey(e)==getFullDateKey(new Date)?r.push("today"):(r.push(getFullDateKey(e)),r.push((a=(n=e).getMonth()+1,o=n.getDate(),["****",(9<a?"":"0")+a,(9<o?"":"0")+o].join("-"))),r.push(["****","**",(9<(t=e.getDate())?"":"0")+t].join("-")),r.push(e.getDay()))),r}}}(),Gt=function(){var r=150,i="#000000ff",s="#ffffffff",l=/^#[0-9a-f]{6}$/i,d=/^#[0-9a-f]{6}$/i,c=/^#[0-9a-f]{8}$/i,u=/^rgb\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)$/i,m=/^rgba\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*(\d|\d\.\d+)\s*\)$/i;function normalizeColor(e){if(!e)return e;var t={red:0,green:0,blue:0,alpha:1};if(e=e.trim(),c.test(e))t.red=hexToDecimal(e.substr(1,2)),t.green=hexToDecimal(e.substr(3,2)),t.blue=hexToDecimal(e.substr(5,2)),t.alpha=hexToDecimal(e.substr(7,2));else if(l.test(e))t.red=hexToDecimal(e.substr(1,2)),t.green=hexToDecimal(e.substr(3,2)),t.blue=hexToDecimal(e.substr(5,2));else if(d.test(e))t.red=hexToDecimal(e[1]+"{"+e[1]),t.green=hexToDecimal(e[2]+"{"+e[2]),t.blue=hexToDecimal(e[3]+"{"+e[3]);else if(m.test(e)){var n=replaceAll(e," ",""),a=(n=n.substring(n.indexOf("(")+1,n.lastIndexOf(")"))).split(",");t.red=Math.min(parseInt(a[0]),255),t.green=Math.min(parseInt(a[1]),255),t.blue=Math.min(parseInt(a[2]),255),t.alpha=Math.min(parseFloat(a[3]),1)}else if(u.test(e)){var o=replaceAll(e," ",""),r=(o=o.substring(o.indexOf("(")+1,o.lastIndexOf(")"))).split(",");t.red=Math.min(parseInt(r[0]),255),t.green=Math.min(parseInt(r[1]),255),t.blue=Math.min(parseInt(r[2]),255),t.alpha=1}else console.warn("color format unsupported: "+e),t=null;return t}function getPercievedBrightness(e){return e?Math.floor(Math.sqrt(.241*e.red*e.red+.691*e.green*e.green+.068*e.blue*e.blue)):0}function getColorInFullHex(e){if(!e)return e;return"#"+padString(decimalToHex(e.red),"0",2)+padString(decimalToHex(e.green),"0",2)+padString(decimalToHex(e.blue),"0",2)+padString(decimalToHex(e.alpha),"0",2)}function decimalToHex(e){return e.toString(16)}function hexToDecimal(e){return parseInt("0x"+e)}function replaceAll(e,t,n){if(e&&t)for(n||(n="");0<=e.indexOf(t);)e=e.replace(t,n);return e}function padString(e,t,n){return e&&t&&n&&(e=e.padStart(n,t[0])),e}function increase_brightness(e,t){3==(e=e.replace(/^\s*#|\s*$/g,"")).length&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16),r="#"+padString((0|256+n+(256-n)*t/100).toString(16).substr(1),"0",2);return r+=padString((0|256+a+(256-a)*t/100).toString(16).substr(1),"0",2),r+=padString((0|256+o+(256-o)*t/100).toString(16).substr(1),"0",2)}return{getThemeSettings:function(e,t){var n=null,a=getColorInFullHex(normalizeColor(e));if(a){a=a.substr(0,7),(n={}).color=a;var o=getColorInFullHex(normalizeColor(t));n.backgroundColor=o?(o=o.substr(0,7))===a?(n.colorFrom=a,n.colorTo=o,n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",a):(n.colorFrom=a,n.colorTo=o,n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",""):(n.colorFrom=increase_brightness(a,-30),n.colorTo=increase_brightness(a,30),n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",""),n.percievedBrightness=getPercievedBrightness(normalizeColor(n.colorFrom)),n.percievedBrightness1=getPercievedBrightness(normalizeColor(n.color)),n.percievedBrightness2=getPercievedBrightness(normalizeColor(n.colorTo)),n.textColor=n.percievedBrightness<=r?s:i,n.buttonColor=(n.percievedBrightness,i),n.buttonBorderColor=(n.percievedBrightness,a),n.buttonBackgroundColor=(n.percievedBrightness,s),n.buttonColorHover=(n.percievedBrightness,s),n.buttonBackgroundColorHover=n.percievedBrightness<=r?a:"#525252"}return n},getTextColorForBackground:function(e){var t="#000000ff";if(!e)return t;var n=normalizeColor(e);return n&&getPercievedBrightness(n)<=150?"#ffffffff":t},setAlpha:function(e,t){if(!e||isNaN(t))return e;t=Math.floor(255*Math.min(Math.max(0,t),1));var n=normalizeColor(e);return n.alpha=t,getColorInFullHex(n)},normalizeColor:normalizeColor,getPercievedBrightness:getPercievedBrightness,BRIGHTNESS_THRESHOLD:r}}(),jt={isMessageFitting:function(e,t,n){var a=!0,o=e.cloneNode(!0);if(o.getElementsByClassName(t)){var r=document.getElementById("roughMessageContainer");r.appendChild(o);var i=o.getElementsByClassName("option-pill-container");Array.prototype.forEach.call(i,function(e){var t=e.firstElementChild;t.scrollHeight>t.clientHeight&&(a=!1)}),a||(i=e.getElementsByClassName("option-pill-container"),Array.prototype.forEach.call(i,function(e){e.classList.remove(t),e.classList.add(n)})),r.removeChild(o)}return a},setFittingClassByText:function(e){var t=e.getElementsByClassName("option-pill-container");if(t&&t.length){var r=[];Array.prototype.forEach.call(t,function(e){if(e.textContent){for(var t=0,n=0;n<e.textContent.length;n++){var a=e.textContent.charAt(n);" "==a?t+=4:a==a.toLowerCase()?t+=9:t+=12}var o=1;"style3"==kt?t<=50?o=3:t<=100&&(o=2):t<=90?o=3:t<=160&&(o=2),r.push(o)}else r.push(-1)});for(var n=3,a=0;a<r.length;){for(var o=r[a],i=r[a],s=!0,l=1;l<o;l++)a+l<r.length?r[a+l]>=i||(s=!1):s&&0<a&&i==n?(o=l,l+=r[a]):s=!1;if(s){var d="option-pill-"+i;for(l=0;l<o;l++)t[a+l].classList.add(d);a+=o,i<n&&(n=i)}else r[a]=r[a]-1}}}},Kt=function(){function removeRazorpayButton(){updateCardById("krazorpay-btn",{Title:"Transaction Completed",RemoveClick:!0,RemoveId:!0})}function removeCashfreeButton(){updateCardById("kcashfree-btn",{Title:"Transaction Completed",RemoveClick:!0,RemoveId:!0})}return{addRazorpayButton:function(t){removeRazorpayButton();var e={Title:"Make Payment",OnClick:function(e){notifyParent(tt.OpenRazorpayForm,t),e.stopPropagation(),updateLastActivity()},ElementId:"krazorpay-btn"},n=[];n.push(e),renderMessage({RichCards:n,Text:"Please make the payment",CardsType:Qe.SmallButton}),notifyParent(tt.OpenRazorpayForm,t),scrollToEnd(z)},removeRazorpayButton:removeRazorpayButton,addCashfreeButton:function(t){removeCashfreeButton();var e={Title:"Make Payment",OnClick:function(e){notifyParent(tt.OpenCashfreeForm,t),e.stopPropagation(),updateLastActivity()},ElementId:"kcashfree-btn"},n=[];n.push(e),renderMessage({RichCards:n,Text:"Please make the Cashfree payment",CardsType:Qe.SmallButton}),scrollToEnd(z)},removeCashfreeButton:removeCashfreeButton}}();function openWebRtcCaller(e){e.Command&&relayWebRtcSignalToParent({Type:"UserChat",Command:"StartCall",Data:e})}function relayWebRtcSignalToParent(e){notifyParent(tt.MediaStreamingCommand,e)}function relayWebRtcSignalFromParent(e){var t={UserId:se||"",ConversationId:de||"",BotClientName:ce||""};l.invoke("OnMediaSignal",e,t).done().fail(function(e){console.error("Message sending failed: "+e)})}function auto_grow(e){e.style.height="5px",e.style.height=e.scrollHeight+"px",e.style.borderRadius="5px"}function checkIfBackgroundDark(e){var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(t){var n=parseInt(t[1]),a=parseInt(t[2]),o=parseInt(t[3]);return.2126*(n/=255)+.7152*(a/=255)+.0722*(o/=255)<.5}return!1}var $t={HeroTemplate:'<div class="portal-template-hero-container" style="background-image: url({{backgroundImage}});" trigger>\n            <div class="portal-template-hero-overlay"></div>\n            <div class="portal-template-hero-text">\n                {{text}}\n            </div>\n        </div>',ArticlePreviewTemplate:'<div class="portal-card" trigger>\n            <img src={{thumbnail}} alt="Article Image" onerror="this.style.display=\'none\';" />\n            <p class="portal-card-title">{{title}}</p>\n            <p>{{description}}</p>\n        </div>',CheckListItemTemplate:'<div class="portal-card checklist-item">\n            <div class="checklist-header" onclick="this.nextElementSibling.classList.toggle(\'k-hide\')">\n                <input {{#if isComplete}}checked{{/if}} id="checkbox-{{templateId}}" type="checkbox" class="checklist-checkbox" trigger/>\n                <p class="portal-card-title">{{title}}</p>\n            </div>\n            <div class="checklist-description k-hide">\n                <p>{{description}}</p>\n            </div>\n        </div>',SearchTemplate:'<div class="portal-template-search-container">\n            <input type="text" id={{templateId}} value="{{value}}" class="portal-template-search-input" placeholder={{placeholder}} />\n\n            <div class="portal-template-search-icon-wrapper" trigger >\n                <i class="portal-template-search-icon fas fa-search"></i>\n            </div>\n        </div>',InputTemplate:'<div class="portal-template-input-container">\n        <input type={{type}} id={{templateId}} value="{{value}}" class="portal-template-input-field" placeholder={{placeholder}} />\n\n        <div class="portal-template-input-icon-wrapper" trigger >\n            <i class="portal-template-input-icon fas fa-chevron-right"></i>\n        </div>\n    </div>',ListTemplate:'<ul class="portal-template-list-container">\n            {{#each listElements}}\n            <li>\n                <a class="portal-template-list-item" target="_blank" href={{this.relativePath}}>\n                    <div class="text">{{this.rowTitle}}</div>\n                    <i class="fas fa-chevron-right portal-template-item-icon"></i>\n                </a>\n            </li>\n            {{/each}}\n        </ul>',CarouselTemplate:'\n    <div class="portal-template-carousel" id="carousel-{{templateId}}">\n        <div class="portal-template-carousel-container" trigger>\n                {{#each carouselElements}}\n                <div class="portal-template-carousel-item">\n                    <div class="portal-template-carousel-image-container">\n                        <img src="{{this.imageUrl}}" alt="{{this.text}}" class="portal-template-carousel-image">\n                    </div>\n                    <div class="portal-template-carousel-text">{{this.text}}</div>\n                </div>\n                {{/each}}\n        </div>\n        <button class="portal-template-carousel-prev">&lt;</button>\n        <button class="portal-template-carousel-next">&gt;</button>\n    </div>',FormTemplate:'\n    <form class="portal-template-form-container" id="form-{{templateId}}">\n        <div class="mt-1 row">\n            <div class="text-center col">\n                <h2 class="h6 font-weight-bold">{{this.customForm.title}}</h2>\n                <p>{{this.customForm.description}}</p>\n            </div>\n        </div>\n        {{#each this.customForm.fields}}\n                <div class="portal-template-input-group">\n                    <i class="fas {{this.image}}"></i>\n                    <input class="form-control" type="{{this.datatype}}" placeholder="{{this.placeholder}}" />\n                </div>  \n        {{/each}}\n        <button type="submit" class="portal-template-submit-btn">Submit</button>\n    </form>',ConversationListTemplate:'\n        {{#if listElements.length}}\n            <ul class="conversation-list">\n                {{#each listElements}}\n                <li class="conversation-list-item" trigger>\n                    \x3c!-- Chat icon on the left --\x3e\n                    <span class="conversation-chat-icon">\n                        <span class="material-icons-outlined">chat</span>\n                    </span>\n                    \x3c!-- Main content area with text and timestamp --\x3e\n                    <div class="conversation-content">\n                        <div class="conversation-text">\n                            {{this.lastMessage}}\n                        </div>\n                        <div class="conversation-message-from">\n                            {{this.messageFrom}} - {{this.lastMessageTime}}\n                        </div>\n                    </div>\n\n                    \x3c!-- Arrow icon on the right --\x3e\n                    <span class="conversation-arrow-front-icon">\n                        <span class="material-icons-outlined">arrow_forward_ios</span>\n                    </span>\n                </li>\n                {{/each}}\n            </ul>\n        {{else}}\n            <div class="no-conversations-container">\n                <div class="no-conversations-content">\n                    <span class="material-icons-outlined no-conversations-chat-icon">chat</span>\n                    <p class="no-conversations-text">No Conversations</p>\n                    <p class="past-conversations-text">Your past conversations will be shown here</p>\n                </div>\n            </div>\n        {{/if}}',ButtonTemplate:'<div class="conversation-start-new" trigger>\n            <button>\n                {{label}}\n                <span class="conversation-add-icon">\n                    <span class="material-icons-outlined">add</span>\n                </span>\n            </button>\n        </div>'},Yt=null,Zt="kenytChatWindow",Jt="chatbox-container",Qt="kenytBotLoaded",Xt="",en=null,tn=function(){return document.getElementById(Zt)};function openChatWindowByConversationId(a){var e=kenytExtractRootUrl();clearExistingWindow(e);var t=window.location.search,n=new URLSearchParams(t),o=window.parent.document.createElement("script");o.src=e+"/ChatbotUI/dist/js/bot-loader.js",o.type="text/javascript",o.async=!0,n.has("data-position")&&o.setAttribute("data-position",n.get("data-position")),o.dataset.bot=n.get("botid"),window.parent.document.body.appendChild(o);var r=!0;window.parent.document.addEventListener("kenytEvent",function(e){if("kenyt_Load"===e.detail.eventType&&r){var t=window.parent.document.getElementById(Zt),n={selectedConversationId:a,conversationMessages:Yt[a],disableCustomMessage:!0,type:"kenytSetCustomContext"};t&&t.contentWindow&&t.src&&(t.contentWindow.postMessage(n,t.src),kenytOpenChatWindow()),r=!1}}),notifyParentKenytLoad()}function createNewConversation(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=kenytExtractRootUrl();clearExistingWindow(e);var t=window.location.search,n=new URLSearchParams(t),o=window.parent.document.createElement("script");o.src=e+"/ChatbotUI/dist/js/bot-loader.js",o.setAttribute("data-position","center"),o.type="text/javascript",o.async=!0,o.dataset.bot=n.get("botid"),window.parent.document.body.appendChild(o);var r=!0;window.parent.document.addEventListener("kenytEvent",function(e){if("kenyt_Load"===e.detail.eventType&&r){var t=window.parent.document.getElementById("kenytChatWindow"),n={selectedConversationId:"",disableCustomMessage:!0,type:"kenytSetCustomContext"};a&&(n.userData=a),t&&t.contentWindow&&t.src&&(t.contentWindow.postMessage(n,t.src),kenytOpenChatWindow()),r=!1}}),notifyParentKenytLoad()}function clearExistingWindow(e){for(var t=[tn()],n=0;n<document.scripts.length;n++){var a=document.scripts[n];a.src===e+"/ChatbotUI/dist/js/bot-loader.js"?t.push(a):a.src.indexOf("/chatbubble.js")&&t.push(a)}for(var o=0;o<window.parent.document.scripts.length;o++){var r=window.parent.document.scripts[o];r.src===e+"/ChatbotUI/dist/js/bot-loader.js"?t.push(r):r.src.indexOf("/chatbubble.js")&&t.push(r)}document.getElementById("messageContainer").innerHTML="",t.forEach(function(e){return e&&e.remove()})}function handleSearch(e,t){var n=document.getElementById(e).value;n&&kenytUseApiCall({url:"/api"+t,method:"GET",queryParams:{search:n}},function(){return console.debug("SEARCHING")},function(e){console.debug("API_ERROR",e)})}var nn="chatbox-container",an="kenytChatBubble",on="data-unreadcount",rn="portal-window-container",sn=function(){var e=window.location.search,t=new URLSearchParams(e);if("false"!==t.get("enablePortal")){var n,a,o,r,i,u='\n            <a href="#" id="portal-home" class="portal-footer-tab">\n                <i class="portal-footer-tab-icon fas fa-home"></i>\n                <div class="portal-footer-tab-name">Home</div>\n            </a>',m='\n            <div id="portal-home-section" tabId="portal-home" class="portal-section">\n            </div>',s='\n    <div id="portal-window-container">\n        <div class="portal-header">\n            <div class="portal-icon-container">\n                <img src="" class="portal-header-image" />\n            </div>\n          <div class="portal-header-title">\n            Home\n          </div>\n            <div class="header-button" id="portal-window-close">\n                <i class="fas fa-times"></i>\n            </div>\n        </div>\n        <div id="top-spinner" class="spinner k-hide"></div>\n        <div id="full-page-spinner" class="kt-overlay k-hide">\n            <div class="spinner"></div>\n        </div>\n        <div class="portal-body">\n        </div>\n\n        <div class="portal-footer">\n          <button type="button" aria-label="Previous" class="scroll-button left k-hide"></button>\n          <button type="button" aria-label="Next" class="scroll-button right k-hide"></button>\n        </div>\n    </div>',l=kenytExtractRootUrl(),d=detectAppName(),c=d+"/api/portal/getportalconfig",p=d+"/api/botsetup/websettings",g=t.get("botid"),f=l+d+"/api/botsetup/getimage?imagetype=chatbubble-icon&botid=";console.debug("PORTAL WINDOW JS FILE LOADED"),window.addEventListener("message",function(e){if(e.data&&e.data.type&&"kenytChatWindowBack"===e.data.type)try{document.querySelector("#portal-messages").dispatchEvent(new CustomEvent("customClick"))}catch(e){console.debug("TAB_TRIGGER",e)}}),(n=new URLSearchParams(window.location.search)).get("enablePortal"),a="true"===n.get("enableHomePortal"),o="true"===n.get("enableMessagePortal"),r="true"===n.get("enableTodoPortal"),i=n.get("data-portal")?n.get("data-portal"):n.get("forms")||"portal-messages",kenytUseApiCall({url:l+c,method:"GET",queryParams:{botId:g,enableHomePortal:a,enableMessagePortal:o,enableTodoPortal:r,dataPortal:i}},createPortalWindow,function(e){console.debug("API_ERROR",e)}),kenytOverrideIframeWindowForPortal()}function createPortalWindow(e){var t=kenytHtmlToElement(s),n=(e.header,e.footer);en=n.tabs,t.querySelector("#portal-window-close").addEventListener("click",hideChatWindow),document.body.insertBefore(t,document.body.firstChild),document.getElementById("chatWindowHeader").style.display="none",kenytUseApiCall({url:l+p,method:"GET",queryParams:{botid:g}},function(e){var t=e.webSettings,n=document.querySelector(".portal-header-image");n.src=""+(t.headerimage||f)+g;var a=document.documentElement;a.style.setProperty("--portal-window-theme-color",t.framecolor);var o=fn.getThemeSettings(t.framecolor,t.framecolorgradient),r=document.querySelector(".portal-header");r.style.background=o.backgroundColor||o.backgroundGradient},function(e){console.debug("THEME_API_ERROR",e)});var a=new URLSearchParams(window.location.search),o=a.get("data-portal")?a.get("data-portal"):a.get("forms")||"portal-messages";if(-1<(Xt=o).indexOf("forms:")){var r=o.split(",").map(function(e){return e.replace("forms:","").trim()}),i=3;r.forEach(function(e){var t={id:"portal-forms-"+e.replace(/\s+/g,"-").toLowerCase(),name:e,order:i++,iconPath:"fa-file-text",onLoadUrl:getEndPoint(kenytExtractRootUrl(),"/api/formsportal/onload"),customParams:{FormName:e}};n.tabs.push(t)}),o="portal-forms-"+r[0].replace(/\s+/g,"-").toLowerCase()}!function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=document.querySelector(".portal-footer"),a=e.tabs,o=0,r=a.findIndex(function(e){return e.id===t});4<r+1&&(o=r-4+1);if(4<a.length){var i=n.querySelectorAll(".scroll-button")[0],s=n.querySelectorAll(".scroll-button")[1],l=function(){0===o?i.classList.add("k-hide"):i.classList.remove("k-hide"),o===a.length-4?s.classList.add("k-hide"):s.classList.remove("k-hide")};l(),i.addEventListener("click",function(){(o-=1)<0&&(o=0),l();var e=a.findIndex(function(e){return e.id===Xt});c(e<o||o+4<=e?a[o].id:Xt)}),s.addEventListener("click",function(){(o+=1)>a.length-4&&(o=a.length-4),l();var e=a.findIndex(function(e){return e.id===Xt});c(e<o||o+4<=e?a[o+4-1].id:Xt)})}var d=document.createElement("div");d.className="tab-container";var c=function(e){d.innerHTML="",document.querySelector(".portal-body").innerHTML="";var t=a.slice(o,o+4);if(t.forEach(function(e,t){var n,a,o=kenytHtmlToElement(u);if(o.id=e.id,a=e,(n=o).addEventListener("customClick",function(e){return onFooterTabClick(e,a)}),n.addEventListener("click",function(e){return onFooterTabClick(e,a)}),function(e,t){var n=document.querySelector(".portal-body"),a=kenytHtmlToElement(m);a.setAttribute("tabId",e.id),a.setAttribute("id",e.id+"-section"),t&&a.classList.add("active");n.appendChild(a)}(e),e.iconPath){var r=o.querySelector(".portal-footer-tab-icon");!function(e,t){if(t.includes("http")){var n=new Image;n.onload=function(){e.style.backgroundImage="url("+t+")",e.classList.remove("fa-home")},n.onerror=function(){console.error("Failed to load image, using fallback icon.")},n.src=t}else e.classList.remove("fa-home"),e.classList.add(t)}(r,e.iconPath)}if(e.name){var i=o.querySelector(".portal-footer-tab-name");i.textContent=capitalizeInitialCharacter(addSpacesBetweenCapitals(e.name))}d.appendChild(o)}),e){var n=document.querySelector("#"+e);n.dispatchEvent(new CustomEvent("customClick"))}};n.appendChild(d),c(t)}(n,o)}function handleTabTemplates(a,e,t){3<arguments.length&&void 0!==arguments[3]&&arguments[3];t&&(a.innerHTML=""),e.forEach(function(n){var r=void 0;if("OptionsGroupTemplate"==n.templateType)r=renderCards(n.options,Qe.Thumbnail,"text","Todo menu",null,function(e,t){console.log(t,"REQUEST_DATA"),n.data=t,handleTemplateClick(e,n)},!0);else if("FormTemplate"==n.templateType)r=renderForm(n.customForm,{},function(e){return handleTemplateClick(e,n)},!0);else if("ChatWindowTemplate"==n.templateId)n.data?n.data.selectedConversationId?openChatWindowByConversationId(n.data.selectedConversationId):createNewConversation(n.data):createNewConversation();else if("CarouselTemplate"===n.templateType)(r=createCarousel(n.carouselCards,function(e,t){n.data=t,handleTemplateClick(e,n)},!0)).id=n.templateId,r.classList.add("portal-card");else{var e=kenytRenderTemplate($t[n.templateType],n);r=kenytHtmlToElement(e)}if(n.onClickUrl){var t=r.hasAttribute("trigger")?r:r.querySelector("[trigger]");t&&t.addEventListener("click",function(e){e.preventDefault(),handleTemplateClick(e,n)})}"ConversationListTemplate"===n.templateType&&(Yt={},n.listElements.forEach(function(t){if(Yt[t.selectedConversationId]=t.messages,t.onClickUrl){var e=t.templateId,n=parseInt(e.split("-")[1],10),a=r.querySelector("li:nth-child("+(n+1)+")"),o=a.hasAttribute("trigger")?a:a.querySelector("[trigger]");o&&o.addEventListener("click",function(e){e.preventDefault(),handleTemplateClick(e,t)})}})),a.appendChild(r),"FormTemplate"==n.templateType&&n.customForm.fields.forEach(function(e){e.afterAppend&&e.afterAppend()})})}function onFooterTabClick(t,n){document.querySelector("#top-spinner").classList.remove("k-hide"),t.stopPropagation(),t.preventDefault(),function(e){for(var t=document.getElementsByClassName("portal-section"),n=document.getElementsByClassName("portal-footer-tab"),a=document.querySelector(".portal-header-title"),o=0;o<t.length;o++)t[o].classList.remove("active"),n[o].classList.remove("active");var r=document.querySelector("#"+e),i=r.querySelector(".portal-footer-tab-name").textContent;document.querySelector("[tabId="+e+"]").classList.add("active"),r.classList.add("active"),a.textContent=i}(t.currentTarget.id);var e=Object.assign({},n.customParams||{},{botId:g,userId:window.localStorage.getItem("_kenytUserId_")||"none"});try{n.onLoadUrl&&kenytUseApiCall({url:n.onLoadUrl,method:"GET",queryParams:e},function(e){handleTabTemplates(document.querySelector("[tabId="+n.id+"]"),e.templates,!0,t.detail),document.querySelector("#top-spinner").classList.add("k-hide")},function(e){document.querySelector("#top-spinner").classList.add("k-hide"),console.debug("TabTriggerApi",e)}),Xt=n.id}catch(e){console.debug("TAB_TRIGGER",e)}}function handleTemplateClick(e,t){console.log("trigger clicked"),e.stopPropagation();var n=window.localStorage.getItem("_kenytUserId_")||"none",a={method:"POST",url:t.onClickUrl,queryParams:{templateId:t.templateId,botId:g}},o=!0;switch(t.templateId.startsWith("conversationListItem")&&(a.body={selectedConversationId:t.selectedConversationId}),t.templateType){case"HeroTemplate":break;case"SearchTemplate":var r=document.getElementById(t.templateId).value;a.body={searchText:r};break;case"ArticlePreviewTemplate":break;case"FormTemplate":var i=handleFormValues(e,t.customForm.fields,t.customForm.submit,t.customForm.submitType,!1),s=i.isFormValid,l=i.values;o=s,a.body=l,a.body.userId=n,t&&t.customForm&&(a.body.formName=t.customForm.title);break;case"CarouselTemplate":a.body=t.data;break;case"CheckListItemTemplate":var d=document.getElementById("checkbox-"+t.templateId);a.body={complete:d.checked,command:t.metadata.options.complete,userId:n};break;default:t.data&&(a.body=t.data)}o&&kenytUseApiCall(a,function(e){e.forEach(function(e){e.tabId&&document.querySelector("#"+e.tabId).dispatchEvent(new CustomEvent("customClick",{detail:{tabId:e.tabId,templateId:e.templateId,data:e.data}}))}),handleTabTemplates(document.querySelector("[tabId="+Xt+"]"),e,!0)},function(e){console.debug(e)})}}(),ln="bot-loader.js",dn="/botapp",cn={center:"position-center",left:"position-left",right:"position-right",bottom:"position-bottom"},un=void 0,mn=void 0,pn=void 0,gn={EMAIL_VALIIDATION_PATTERN:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,PHONE_VALIDATION_SOURCE:"Intl Tel Input Plugin",URL_VALIIDATION_PATTERN:/^(http[s]?:\/\/)?(www\.)?(\w)+\.(\w)+([\/.][\w-#]*)*$/};function kenytIsMobileDevice(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function kenytNotifyChatWindow(e,t){var n=document.querySelector("#kenytChatWindow").contentWindow;if(n){var a={type:e,value:t};n.postMessage(a,"*")}else console.warn("[Kenyt.AI] Iframe load error")}function kenytUpdateAmpFrameWindowSize(e){if(e){var t=100,n=100;"none"===un.style.display?n=t=100:un.classList&&(n=un.classList.contains("k-hide")?t=100:un.classList.contains("force-fullscreen")?t=1e3:un.classList.contains("full-height")?(t=370,1e3):kenytIsMobileDevice()?(t=370,350):(t=370,470)),t&&100<=t&&n&&100<=n&&window.parent.postMessage({sentinel:"amp",type:"embed-size",width:t,height:n},"*")}}function kenytGetPositionClass(e){if(e&&"string"==typeof e&&(e=e.trim().toLowerCase()))for(var t=Object.keys(cn),n=0;n<t.length;n++)if(t[n]===e)return cn[t[n]];return cn.right}function kenytSetChatBubbleTrigger(t){var n=window.parent.document.getElementById(an);n.replaceWith(n.cloneNode(!0)),(n=window.parent.document.getElementById(an)).addEventListener("click",function(){var e=document.getElementById(t);e.classList.contains("k-hide")?(e.classList.remove("k-hide"),n.classList.add("k-hide")):(e.classList.add("k-hide"),n.classList.remove("k-hide"))})}function kenytOpenPortalWindow(){document.getElementById(rn).classList.remove("k-hide")}function kenytOpenChatWindow(){pn=document.getElementById(rn),mn=document.getElementById(an),document.getElementById("chatWindow").classList.remove("k-hide"),document.getElementById("headerBackButton").classList.remove("k-hide"),document.getElementById("chatWindowBody").style.zIndex="100",document.getElementById("chatWindowFooter").style.zIndex="100",document.getElementById("chatWindowHeader").style.display="",kenytUpdateAmpFrameWindowSize(0<window.location.href.indexOf("ampframe.html"))}function kenytHtmlToElement(e){e=e.trim();var t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}function kenytParseHtmlTemplate(e,t,n){var a=e.find(function(e){return e.id==t}).html;for(key in n){var o="{{"+key+"}}";a=a.replaceAll(o,n[key])}return a}function kenytGetScriptParam(e){var t=Array.from(window.parent.document.scripts).find(function(e){return-1<e.src.indexOf("bot-loader.js")}),n="";if(t){var a=""+e;t.hasAttribute(a)&&(n=t.getAttribute(a))}return n}function kenytExtractRootUrl(){var e=window.location.origin,t="";if(e){e.startsWith("//www.")?e="https:"+e:(e.startsWith(".")||e.startsWith("/"))&&(e=window.location.protocol+"//"+window.location.hostname,window.location.port&&(e+=":"+window.location.port));var n=new URL(e);t=n.protocol+"//"+n.hostname,n.port&&(t+=":"+n.port)}return t}function getEndPoint(e,t){return t=0<=e.indexOf("localhost")?""+e+t:0<e.indexOf("ngrok-free.app")?"https://"+window.location.hostname+t:""+e+dn+t}function kenytUseApiCall(e,t,n){var a=e.url,o=e.method,r=void 0===o?"GET":o,i=e.headers,s=void 0===i?{}:i,l=e.body,d=void 0===l?null:l,c=e.queryParams,u=void 0===c?null:c,m=a;u&&0<Object.keys(u).length&&(m=a+"?"+Object.entries(u).map(function(e){var t=f(e,2),n=t[0],a=t[1];return encodeURIComponent(n)+"="+encodeURIComponent(a)}).join("&"));var p=new XMLHttpRequest;for(var g in p.open(r,m,!0),s)p.setRequestHeader(g,s[g]);p.onreadystatechange=function(){if(p.readyState===XMLHttpRequest.DONE)if(200<=p.status&&p.status<300)try{var e=JSON.parse(p.responseText);t(e)}catch(e){n(e,"Error parsing response JSON")}else n("API error: "+p.status+" "+p.statusText)},p.onerror=function(){n("Network error occurred")},!d||"POST"!==r&&"PUT"!==r?p.send():(p.setRequestHeader("Content-Type","application/json"),p.send(JSON.stringify(d)))}function kenytRenderTemplate(e,t){try{var n=Handlebars.compile(e);return t.helpers={kenytCarouselInit:kenytCarouselInit},n(t)}catch(e){return console.log(e),"<div></div>"}}function kenytCarouselInit(e){console.log("CAROUSEL_INITIALIZED");var t=e.querySelector(".portal-template-carousel-container"),n=t.querySelectorAll(".portal-template-carousel-item"),a=e.querySelector(".portal-template-carousel-prev"),o=e.querySelector(".portal-template-carousel-next"),r=0;function showSlide(e){console.log(e,"INDEX"),t.style.transform="translateX(-"+100*e+"%)"}o.addEventListener("click",function(){console.log(r,"CURRENT_INDEX_BEFORE"),r=(r+1)%n.length,console.log(r,"CURRENT_INDEX"),showSlide(r)}),a.addEventListener("click",function(){console.log(r,"CURRENT_INDEX_BEFORE_prev"),r=(r-1+n.length)%n.length,console.log(r,"CURRENT_INDEX_prev"),showSlide(r)}),showSlide(0)}var fn=function(){var r=150,i="#000000ff",s="#ffffffff",l=/^#[0-9a-f]{6}$/i,d=/^#[0-9a-f]{6}$/i,c=/^#[0-9a-f]{8}$/i,u=/^rgb\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)$/i,m=/^rgba\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*(\d|\d\.\d+)\s*\)$/i;function normalizeColor(e){if(!e)return e;var t={red:0,green:0,blue:0,alpha:1};if(e=e.trim(),c.test(e))t.red=hexToDecimal(e.substr(1,2)),t.green=hexToDecimal(e.substr(3,2)),t.blue=hexToDecimal(e.substr(5,2)),t.alpha=hexToDecimal(e.substr(7,2));else if(l.test(e))t.red=hexToDecimal(e.substr(1,2)),t.green=hexToDecimal(e.substr(3,2)),t.blue=hexToDecimal(e.substr(5,2));else if(d.test(e))t.red=hexToDecimal(e[1]+"{"+e[1]),t.green=hexToDecimal(e[2]+"{"+e[2]),t.blue=hexToDecimal(e[3]+"{"+e[3]);else if(m.test(e)){var n=replaceAll(e," ",""),a=(n=n.substring(n.indexOf("(")+1,n.lastIndexOf(")"))).split(",");t.red=Math.min(parseInt(a[0]),255),t.green=Math.min(parseInt(a[1]),255),t.blue=Math.min(parseInt(a[2]),255),t.alpha=Math.min(parseFloat(a[3]),1)}else if(u.test(e)){var o=replaceAll(e," ",""),r=(o=o.substring(o.indexOf("(")+1,o.lastIndexOf(")"))).split(",");t.red=Math.min(parseInt(r[0]),255),t.green=Math.min(parseInt(r[1]),255),t.blue=Math.min(parseInt(r[2]),255),t.alpha=1}else console.warn("color format unsupported: "+e),t=null;return t}function getPercievedBrightness(e){return e?Math.floor(Math.sqrt(.241*e.red*e.red+.691*e.green*e.green+.068*e.blue*e.blue)):0}function getColorInFullHex(e){if(!e)return e;return"#"+padString(decimalToHex(e.red),"0",2)+padString(decimalToHex(e.green),"0",2)+padString(decimalToHex(e.blue),"0",2)+padString(decimalToHex(e.alpha),"0",2)}function decimalToHex(e){return e.toString(16)}function hexToDecimal(e){return parseInt("0x"+e)}function replaceAll(e,t,n){if(e&&t)for(n||(n="");0<=e.indexOf(t);)e=e.replace(t,n);return e}function padString(e,t,n){return e&&t&&n&&(e=e.padStart(n,t[0])),e}function increase_brightness(e,t){3==(e=e.replace(/^\s*#|\s*$/g,"")).length&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16),r="#"+padString((0|256+n+(256-n)*t/100).toString(16).substr(1),"0",2);return r+=padString((0|256+a+(256-a)*t/100).toString(16).substr(1),"0",2),r+=padString((0|256+o+(256-o)*t/100).toString(16).substr(1),"0",2)}return{getThemeSettings:function(e,t){var n=null,a=getColorInFullHex(normalizeColor(e));if(a){a=a.substr(0,7),(n={}).color=a;var o=getColorInFullHex(normalizeColor(t));n.backgroundColor=o?(o=o.substr(0,7))===a?(n.colorFrom=a,n.colorTo=o,n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",a):(n.colorFrom=a,n.colorTo=o,n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",""):(n.colorFrom=increase_brightness(a,-30),n.colorTo=increase_brightness(a,30),n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",""),n.percievedBrightness=getPercievedBrightness(normalizeColor(n.colorFrom)),n.percievedBrightness1=getPercievedBrightness(normalizeColor(n.color)),n.percievedBrightness2=getPercievedBrightness(normalizeColor(n.colorTo)),n.textColor=n.percievedBrightness<=r?s:i,n.buttonColor=(n.percievedBrightness,i),n.buttonBorderColor=(n.percievedBrightness,a),n.buttonBackgroundColor=(n.percievedBrightness,s),n.buttonColorHover=(n.percievedBrightness,s),n.buttonBackgroundColorHover=n.percievedBrightness<=r?a:"#525252"}return n},getTextColorForBackground:function(e){var t="#000000ff";if(!e)return t;var n=normalizeColor(e);return n&&getPercievedBrightness(n)<=150?"#ffffffff":t},setAlpha:function(e,t){if(!e||isNaN(t))return e;t=Math.floor(255*Math.min(Math.max(0,t),1));var n=normalizeColor(e);return n.alpha=t,getColorInFullHex(n)},normalizeColor:normalizeColor,getPercievedBrightness:getPercievedBrightness,BRIGHTNESS_THRESHOLD:r}}(),vn={getFormDetailsFromCommand:function(e){var t,n,a,o;switch(e.Name){case x.APPOINTMENT_FORM.Trigger:a=(new Date).getTimezoneOffset(),o=Math.abs(a),r={title:"Select Appointment Date and Time UTC"+(a=(a<0?"+":"-")+("00"+Math.floor(o/60)).slice(-2)+":"+("00"+o%60).slice(-2)),description:"",fields:[{field:"Appointment Date",datatype:"datetime",errorMessage:"please select a valid date",isMandatory:!0,readonly:!0,image:"icon:calendar"},{field:"Appointment Time",datatype:"dropdown",errorMessage:"please select a valid time",isMandatory:!0,value:["10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM"],need:"Appointment Date",image:"icon:clock-o"}]},t=getFormSettings(e.Value);break;case x.CONTACT_FORM.Trigger:n=[{field:"Name",datatype:"text",placeholder:"Your Name",errorMessage:"please enter a valid name",isMandatory:!1,image:"icon:user"},{field:"Email",datatype:"email",placeholder:"Email Address",errorMessage:"please enter a valid email address",validationPattern:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,isMandatory:!1,image:"icon:envelope"},{field:"Mobile",datatype:"tel",placeholder:"Mobile Number",errorMessage:"please enter a valid phone number",validationSource:L,isMandatory:!1,image:"icon:phone"}],r={title:getButtonsText("Contact Information"),description:getButtonsText("Please enter your contact details"),fields:n},t=getFormSettings(e.Value);break;case x.ADDRESS_FORM.Trigger:r={title:"Address Information",description:"Please enter your address details",fields:[{field:"Address Line 1",datatype:"text",errorMessage:"please enter a valid address",isMandatory:!0},{field:"Address Line 2",datatype:"text",errorMessage:"please enter a valid address",isMandatory:!1},{field:"City",datatype:"text",errorMessage:"Please enter a valid City",isMandatory:!0,takeHalfRow:!0},{field:"State",datatype:"text",errorMessage:"please enter a valid State",isMandatory:!0,takeHalfRow:!0},{field:"Country",datatype:"text",errorMessage:"please enter a valid Country",isMandatory:!0,takeHalfRow:!0},{field:"Zip Code",datatype:"text",errorMessage:"Please enter a valid Zip Code",validationPattern:/^[1-9][0-9]{5}$/,isMandatory:!0,takeHalfRow:!0}],submit:"address form submission",submitType:"values"},t=getFormSettings(e.Value);break;case x.GENERIC_FORM.Trigger:var r;e.Value&&(r=JSON.parse(e.Value))&&(t=getFormSettings(r.settings))}return{template:r,setttings:t}},sanitizeFormTemplate:function(e){e&&e.fields&&e.fields.forEach(function(a){if(a.dataType&&(a.datatype=a.dataType),a.datatype)if("email"===a.datatype)a.validationPattern||(a.validationPattern=gn.EMAIL_VALIIDATION_PATTERN);else if("tel"===a.datatype)a.validationSource||(a.validationPattern=gn.PHONE_VALIDATION_SOURCE);else if("url"===a.datatype)a.validationSource||(a.validationPattern=gn.URL_VALIIDATION_PATTERN,a.antiValidationPattern=gn.EMAIL_VALIIDATION_PATTERN);else if("datetime"===a.datatype){if(a.datetimepickersettings){var t={timepicker:!1,format:"d-M-Y",minDate:"-1970/01/1",maxDate:"+1970/06/1",scrollMonth:!1,scrollInput:!1};Object.keys(t).forEach(function(e){a.datetimepickersettings[e]||(a.datetimepickersettings[e]=t[e])})}else a.datetimepickersettings={timepicker:!1,format:"d-M-Y",minDate:"-1970/01/1",maxDate:"+1970/06/1",scrollMonth:!1,scrollInput:!1};a.Slots&&(a.datetimepickersettings.beforeShowDay=function(e){var t=Vt.getDateKeys(e),n=!1;return t.every(function(e){return!a.Slots[e]||(n=0<a.Slots[e].length,!1)}),[n,""]}),a.readonly=!0,a.image="icon:calendar",a.afterAppend=function(){this.inputElementRef&&($(this.inputElementRef).datetimepicker(this.datetimepickersettings),this.inputContainer&&this.datetimepickersettings&&this.datetimepickersettings.inline&&this.inputContainer.classList.add("inline-datetime"))}}})},renderForm:renderForm,createInputRowFromField:function(t,n,e){n[t.field]&&(n[t.field].value&&(t.value=n[t.field].value),n[t.field].isMandatory&&(t.isMandatory=n[t.field].isMandatory),n[t.field].need&&(t.isMandatory=n[t.field].need),n[t.field].beforeShow&&(t.beforeShow=n[t.field].beforeShow),n[t.field].telSettings&&(t.telSettings?Object.keys(n[t.field].telSettings).forEach(function(e){t.telSettings[e]=n[t.field].telSettings[e]}):t.telSettings=n[t.field].telSettings),n[t.field].datetimepickersettings&&(t.datetimepickersettings?Object.keys(n[t.field].datetimepickersettings).forEach(function(e){t.datetimepickersettings[e]=n[t.field].datetimepickersettings[e]}):t.datetimepickersettings=n[t.field].datetimepickersettings),n[t.field].errorMessage&&(t.errorMessage=n[t.field].errorMessage),n[t.field].validationPattern&&(t.validationPattern=n[t.field].validationPattern),n[t.field].image&&(t.image=n[t.field].image),n[t.field].imageClass&&(t.imageClass=n[t.field].imageClass));var a=document.createElement("label"),o=document.createElement("input"),r=document.createElement("div");if(t.dataType&&(t.datatype=t.dataType),"dropdown"===t.datatype){t.options=t.options||t.value;var i=t.displayName||t.field;(o=createDropdownElement(t.options,i)).name=t.field}else o.type=t.datatype,t.placeholder?a.innerHTML=t.placeholder:a.textContent=t.displayName||t.field,o.placeholder=t.placeholder||t.displayName||t.field,o.placeholder=getButtonsText(o.placeholder),t.value&&(o.value=t.value);t.name&&(o.name=t.name),o.classList.add("form-control"),o.style.fontStyle="inherit",t.readonly&&o.setAttribute("readonly","readonly"),t.min&&(o.min=t.min),t.max&&(o.max=t.max),r.classList.add("invalid-feedback","d-none"),r.textContent=t.errorMessage;var s=void 0,l=void 0;if(t.image){var d=createIconElement(t.image);if(d){var c="icon-container";t.imageClass&&(c=c+","+t.imageClass),l=genericContainer(["input-container"],genericContainer(c=c.split(","),d),o)}}if(l||(l=genericContainer([],o)),"checkbox"===t.datatype?(o.name=t.field,o.classList.remove("form-control"),equalsIgnoreCase(t.value,"true")&&(o.checked=!0),(s=columnContainer([],l,a,r)).classList.add("checkbox"),r.style.display="block"):s=t.useLabel?columnContainer([],a,l,r):columnContainer([],l,r),n&&n.Mandatory&&n.Mandatory.includes(t.field)&&(t.isMandatory=!0),"tel"===t.datatype&&t.validationSource===L){var u="IN";n&&n.CountryCode&&(u=n.CountryCode);var m={geoIpLookup:function(e){e(u)},hiddenInput:"full_number",initialCountry:"auto",placeholderNumberType:"MOBILE",preferredCountries:["in","us"],separateDialCode:!0,utilsScript:k};t.telSettings&&Object.keys(t.telSettings).forEach(function(e){m[e]=t.telSettings[e]}),o.value||(o.setAttribute("type","number"),o.setAttribute("onkeydown","javascript: return event.keyCode == 69 ? false : true"));var p=window.intlTelInput(o,m);o.style.paddingLeft="85px",r.style.display="block",t.pluginObj=p}return o.addEventListener("change",handleFormInputChange),{colEle:s,inputElementRef:o,inputContainer:l,feedbackElementRef:r}},handleFormValues:handleFormValues};function kenytCreateForm(n,i,t,e){var a=n.tag||"div",s=document.createElement(a);s.classList.add("form");var o=document.createElement("span"),r=document.createElement("p");o.classList.add("h6","font-weight-bold"),r.classList.add("m-0"),o.textContent=null!=i.Title?i.Title:n.title,r.textContent=null!=i.Description?i.Description:n.description,s.appendChild(rowContainer(["mt-1"],columnContainer(["text-center"],o,r)));var l=void 0;n.fields.forEach(function(r){var e=vn.createInputRowFromField(r,i),a=e.colEle;if(a){if(r.inputElementRef=e.inputElementRef,r.inputContainer=e.inputContainer,r.feedbackElementRef=e.feedbackElementRef,r.takeHalfRow&&a.classList.add("col-6"),l)l.appendChild(a),s.appendChild(l),l=null;else{var t=rowContainer(["mt-2"],a);s.appendChild(t),r.takeHalfRow&&(l=t)}if(r.need&&n.fields.forEach(function(o){if(r.need===o.field&&o&&o.inputElementRef){if("datetime"===o.datatype){!r.beforeShow&&o.Slots&&(r.beforeShow=function(e){var n=this,t=Vt.getDateKeys(e),a=r.value;t.every(function(e){return!o.Slots[e]||(a=o.Slots[e],!1)}),a||(a="10 AM, 11 AM, 12 PM, 1 PM, 2 PM, 3 PM, 4 PM, 5 PM, 6 PM, 7 PM, 8 PM"),this.inputElementRef.innerHTML="",a.forEach||(a=a.split(",")),a.forEach(function(e){var t=document.createElement("option");t.innerText=e,t.value=e,n.inputElementRef.appendChild(t)})});var t=o.datetimepickersettings.onChangeDateTime;o.datetimepickersettings.onChangeDateTime=function(e){t&&t(e),r.beforeShow&&r.beforeShow(e),kenytShowElements(r.inputContainer),scrollToEnd(z)}}else o.inputElementRef.addEventListener("change",function(){kenytShowElements(r.inputContainer),scrollToEnd(z)},!1);hideElements(r.inputContainer)}}),r.addMore){r.extraInputs=r.extraInputs||[];var o=document.createElement("button");o.textContent=" + ",o.classList.add("btn","primary-button","add-more-btn"),o.addEventListener("click",function(e){e.preventDefault();var t=createInputRowFromField(r,i),n=rowContainer(["mt-2"],t.colEle);a.parentNode.parentNode.insertBefore(n,a.parentNode.nextSibling),r.extraInputs.push({inputElementRef:t.inputElementRef,feedbackElementRef:t.feedbackElementRef}),4==r.extraInputs.length&&hideElements(o)}),a.appendChild(o)}}});var d=document.createElement("button");d.textContent="Cancel",d.classList.add("btn","btn-secondary"),e&&d.addEventListener("click",function(){e()});var c=document.createElement("button");return c.textContent=" "+getButtonsText("Submit")+" ",c.classList.add("btn","primary-button"),e||c.classList.add("mr-2"),n.onSubmit?s.onsubmit=n.onSubmit:t&&c.addEventListener("click",function(e){t(e,n.fields,n.submit,n.submitType)}),e?s.appendChild(rowContainer(["mt-2"],columnContainer(["text-center"],c,d))):s.appendChild(rowContainer(["mt-2"],columnContainer(["text-center"],c))),s}function kenytShowElements(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){e&&e.classList.contains("d-none")&&e.classList.remove("d-none")})}function kenytOverrideIframeWindowForPortal(){document.getElementById("chatWindow").classList.add("k-hide")}function capitalizeInitialCharacter(e){return e.split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}).join(" ")}function addSpacesBetweenCapitals(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z])([a-z])/g,"$1 $2$3")}