"use strict";var P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kenytChatBubbleJs=function(){var r,s={EVENT_USER_CALL_INCOMING:"user_call_incoming",EVENT_USER_CALL_ACCEPTED:"user_call_accepted",EVENT_USER_CALL_REJECTED:"user_call_rejected",EVENT_USER_CALL_DISCONNECT_SELF:"user_call_disconnect_self",EVENT_USER_CALL_DISCONNECT_SERVER:"user_call_disconnect_server",EVENT_USER_CALL_CONNECTION_ESTABLISHED:"user_call_connection_established",EVENT_USER_CALL_CONNECTION_CLOSED:"user_call_connection_closed",EVENT_USER_CALL_CONNECTION_FAILED:"user_call_connection_failed"};function trackError(e,t){var n,a=e&&e.lineno||"0",o=e&&e.colno||"0",i="["+(e&&e.filename||"unknown-file")+":"+a+":"+o+"] "+(e&&e.message||"null");n={eventName:"exception",details:{description:i,fatal:t||!1},isException:!0},notifyChatWindow(A.ReportGoogleAnalyticsEvent,n),console.debug(new Date+" "+i)}window.dataLayer=window.dataLayer||[];var c={},e="data-unreadcount",d="kenytCallRinger",u="kenytIncomingCall",t=document.kenytRootUrl||"https://www.kenyt.ai";t.includes("kenyt.ai")&&(t+="/botapp");var n,m,p={CALL_RING_SOUND:t+"/ChatbotUI/audio/incoming_call.mp3",TRACKING_URL_PREFIX:t+"/api/tracking/trackactivity?activityId='"},g=document.getElementById("kenytChatBubble"),f=document.getElementById("chatbox-container"),a=!1,o=0<window.location.href.indexOf("ampframe.html"),h=' \n    <div class="kenyt-media-container">\n        <video id="local" autoplay playsinline muted></video>\n        <div class="action-bar w-100">\n            <button class="call-action bg-green" id="call-start" title="Start call"><i class="fas fa-phone rotate-135"></i></button>\n            <button class="call-action bg-green" id="call-accept" title="Accept call"><i class="fas fa-phone"></i></button>\n            <button class="call-action bg-white" id="call-microphone-toggle" data-isenabled="true" title="Toggle microphone"><i class="fas fa-microphone"></i></button>\n            <button class="call-action bg-red" id="call-end" title="End call"><i class="fas fa-phone rotate-225"></i></button>\n            <button class="call-action bg-white" id="call-video-toggle" data-isenabled="true" title="Toggle video"><i class="fas fa-video"></i></button>\n            <button class="call-action bg-white" id="call-camera-toggle" data-isenabled="false" title="Toggle camera"><i class="fas fa-retweet"></i></button>\n            <button class="call-action bg-red" id="call-screenshare-toggle" data-isenabled="false" title="Toggle screen share"><i class="fas fa-desktop"></i></button>\n            <div class="float-right m-2 mr-3">\n                <button class="call-action bg-white" id="call-fullscreen-toggle" data-isfullscreen="false" title="Toggle fullscreen"><i class="fas fa-expand-arrows-alt"></i></button>\n            </div>\n        </div>\n        <video id="remote" autoplay playsinline></video>\n    </div>',y='\n    <div class="incoming-call text-center py-4">\n        <p>\n            <i class="fas fa-phone-volume fa-3x fa-inverse incoming-call-icon text-success"></i> \n            <span class="incoming-call-text ml-2">Incoming Call</span>\n        </p>\n        <div class="incoming-call-action text-left" id="accept-video-call">\n            <button class="call-action bg-green text-white"><span class="fas fa-video"></span></button>\n            <span>Accept</span>\n        </div>\n        <div class="incoming-call-action text-left" id="reject-call">\n            <button class="call-action bg-danger text-white"><span class="fas fa-phone rotate-225"></span></button>\n            <span>Dismiss</span>\n        </div>\n    </div>\n    ',v="kenyt-highlightArea",C='\n        <div class="kenyt-highlightArea"></div>\n    ',b=(document&&document.querySelector(".chatWithUsMessage"),"__kenytsession__"),i=new Date,S=0,E={audio:{echoCancellation:!0,noiseSuppression:!0},video:{facingMode:"user"}},w={audio:{echoCancellation:!0,noiseSuppression:!0},video:{facingMode:"environment"}},l={iceServers:[{urls:["stun:bn-turn1.xirsys.com"]},{username:"4Ts0wdSOWv7YcYBEli_S3pJfs7xktfm-ZMxmJ8zQxvcQeu0zvMvUFmepCr3i4t8uAAAAAF6lNP9rZW55dGluYw==",credential:"aae708e6-878d-11ea-b80d-9646de0e6ccd",urls:["turn:bn-turn1.xirsys.com:80?transport=udp","turn:bn-turn1.xirsys.com:3478?transport=udp","turn:bn-turn1.xirsys.com:80?transport=tcp","turn:bn-turn1.xirsys.com:3478?transport=tcp","turns:bn-turn1.xirsys.com:443?transport=tcp","turns:bn-turn1.xirsys.com:5349?transport=tcp"]}]},L=4e3,A={UnreadMessage:"kenytUnreadMessage",ChatWindowClose:"kenytChatWindowClose",ChatWindowOpen:"kenytChatWindowOpen",FullScreenImage:"kenytFullScreenImage",NavigateToPage:"kenytNavigateToPage",ToggleFullScreen:"kenytToggleFullscreen",ForceFullHeight:"kenytForceFullHeight",TextColor:"kenytTextColor",IsWindowMinimizedResponse:"kenytIsWindowMinimizedResponse",WindowHover:"kenytWindowHover",GetPageTitle:"kenytPageTitle",GetReferrer:"kenytPageReferrer",Initialize:"kenytInitialize",PageInfoRequest:"kenytPageInfoRequest",PageInfoResponse:"kenytPageInfoResponse",CustomEventDispatch:"kenytCustomEventDispatch",SettingsUpdate:"kenytSettingsUpdate",UpdateChatBubbleColor:"kenytUpdateChatBubbleColor",UpdateBotPosition:"kenytUpdateBotPosition",MediaStreamingCommand:"kenytMediaStreamingCommand",SendMessage:"kenytSendMessage",ReportGoogleAnalyticsEvent:"reportGoogleAnalyticsEvent",OpenRazorpayForm:"kenytOpenRazorpayForm",SubmitRazorpayPayment:"kenytSubmitRazorpayPayment",OpenCashfreeForm:"kenytOpenCashfreeForm",SubmitCashfreePayment:"kenytSubmitCashfreePayment"},k={center:"position-center",left:"position-left",right:"position-right"},T=null,I=function(){var e="__feature_test";try{return window.sessionStorage.setItem(e,e),window.sessionStorage.removeItem(e),!0}catch(e){return!1}}();function openChatWindow(){n&&window.clearInterval(n),f&&(f.classList.remove("k-hide"),g.classList.add("k-hide")),notifyChatWindow(A.IsWindowMinimizedResponse,!1),g.removeEventListener("click",openChatWindow),g.addEventListener("click",closeChatWindow),g.hasAttribute(e)&&g.removeAttribute(e),updateAmpFrameWindowSize()}function closeChatWindow(){if(document.querySelector("#chatbox-container")&&(f.classList.add("k-hide"),g.classList.remove("k-hide")),notifyChatWindow(A.IsWindowMinimizedResponse,!0),a){var e=g.querySelector(".chatWithUsMessage");e&&(e.style.display="none")}g.removeEventListener("click",closeChatWindow),g.addEventListener("click",openChatWindow),updateAmpFrameWindowSize()}function plusSlides(e,t){setSlideByNumber(e,+e.getAttribute("current-slide-number")+ +t)}function setSlideByNumber(e,t){if(e){var n=e.getElementsByClassName("img-card");t>n.length?t=1:t<1&&(t=n.length);for(var a=0;a<n.length;a++)n[a].style.display="none";n[t-1].style.display="flex",e.setAttribute("current-slide-number",t)}}function resetHeight(){f&&f.classList.contains("full-height")&&f.classList.remove("full-height")}function updateAmpFrameWindowSize(){if(o){var e=document.querySelector("#chatbox-container"),t=100,n=100;"none"===e.style.display?n=t=100:e.classList&&(n=e.classList.contains("k-hide")?t=100:e.classList.contains("force-fullscreen")?t=1e3:e.classList.contains("full-height")?(t=370,1e3):isMobileDevice()?(t=370,350):(t=370,470)),t&&100<=t&&n&&100<=n&&window.parent.postMessage({sentinel:"amp",type:"embed-size",width:t,height:n},"*")}}function isMobileDevice(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function notifyChatWindow(e,t){var n=document.querySelector("#kenytChatWindow").contentWindow;if(n){var a={type:e,value:t};n.postMessage(a,"*")}else console.warn("[Kenyt.AI] Iframe load error")}function getCurrentPageInfo(){return{PageTitle:document.title,PageUrl:window.location.href,StartTime:i,SessionId:m}}function getCurrentTrackingSession(){var e=window.location.search;return e&&(e=e.substring(1)),{SessionId:m,Updated:!1,FirstPageQueryPrm:e,History:[getCurrentPageInfo()]}}function isNonEmptyString(e){return e&&"string"==typeof e&&0<e.trim().length}function readFromLocalStorage(e){var t=null;if(I){var n=window.localStorage.getItem(e);isNonEmptyString(n)&&(t=JSON.parse(n))}return t}function writeToLocalStorage(e,t){I&&isNonEmptyString(e)&&t&&window.localStorage.setItem(e,JSON.stringify(t))}function handleError(e){console.error(e),e&&(e.message=e.message||"",e.message="Handle Error: "+e.message),trackError(e,!0)}function notifyMediaStreamingCommand(e,t,n){var a={Type:e,Command:t,Data:n},o=JSON.parse(JSON.stringify(a));console.log("Outgoing Signal : ",o),notifyChatWindow(A.MediaStreamingCommand,o)}function closeIncomingCallPopup(){console.log("closeIncomingCallPopup");var e,t=document.getElementById(u);t&&t.remove(),e=document.getElementById(d),window.setTimeout(function(){e.pause()},0)}function showCallPopup(e){if(console.log("showCallPopup",e),!document.querySelector(".kenyt-media-container")){var t=htmlToElement(h);(c=c||{}).endCallButton=t.querySelector("button#call-end"),c.startCallButton=t.querySelector("button#call-start"),c.acceptCallButton=t.querySelector("button#call-accept"),c.localMediaElement=t.querySelector("video#local"),c.remoteMediaElement=t.querySelector("video#remote"),c.showReject=t.querySelector("button#call-reject"),c.startCallButton.addEventListener("click",function(){handleStartCallButtonClicked()}),c.endCallButton.addEventListener("click",function(){notifyChatWindow(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_DISCONNECT_SELF,isException:!1}),updateMediaStreamingPopup("Ending call",!0,!1,!1),stopPeerConnection(),notifyMediaStreamingCommand("MediaPlayer","EndCall",""),closeCallPopup()}),c.acceptCallButton.addEventListener("click",function(){handleAcceptCallButtonClicked()});var n=t.querySelector("#call-fullscreen-toggle"),a=t.querySelector("#call-microphone-toggle"),i=t.querySelector("#call-video-toggle"),l=t.querySelector("#call-screenshare-toggle");navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices||l.setAttribute("hidden","true");var r=t.querySelector("#call-camera-toggle");navigator.mediaDevices.enumerateDevices().then(function(e){var t=0;e.forEach(function(e){"videoinput"===e.kind&&t++}),S=t,console.log("number of cameras",S),1<S?showCameraSwitch(r):hideCameraSwitch(r)}),console.log(r),!1===c.mediaContraints.video&&(i.classList.remove("bg-white"),i.querySelector("i").classList.remove("fa-video"),i.classList.add("bg-red"),i.querySelector("i").classList.add("fa-video-slash"),i.setAttribute("data-isenabled","false")),n.addEventListener("click",function(){"true"===n.getAttribute("data-isfullscreen")?(t.classList.remove("fullscreen"),n.querySelector("i").classList.remove("fa-compress"),n.querySelector("i").classList.add("fa-expand-arrows-alt"),n.setAttribute("data-isfullscreen","false"),dragElement(t)):(t.classList.add("fullscreen"),n.querySelector("i").classList.remove("fa-expand-arrows-alt"),n.querySelector("i").classList.add("fa-compress"),n.setAttribute("data-isfullscreen","true"),t.onmousedown=null)}),a.addEventListener("click",function(){"true"===a.getAttribute("data-isenabled")?(a.classList.remove("bg-white"),a.querySelector("i").classList.remove("fa-microphone"),a.classList.add("bg-red"),a.querySelector("i").classList.add("fa-microphone-slash"),a.setAttribute("data-isenabled","false"),c.localUserStream.getAudioTracks().forEach(function(e){return e.enabled=!1})):(a.classList.remove("bg-red"),a.querySelector("i").classList.remove("fa-microphone-slash"),a.classList.add("bg-white"),a.querySelector("i").classList.add("fa-microphone"),a.setAttribute("data-isenabled","true"),c.localUserStream.getAudioTracks().forEach(function(e){return e.enabled=!0}))}),i.addEventListener("click",function(){var e=i.getAttribute("data-isenabled"),t=l.getAttribute("data-isenabled");"true"===e?(i.classList.remove("bg-white"),i.querySelector("i").classList.remove("fa-video"),i.classList.add("bg-red"),i.querySelector("i").classList.add("fa-video-slash"),i.setAttribute("data-isenabled","false"),disableVideo(),"true"===t&&enableScreenShare(l)):(i.classList.add("bg-white"),i.querySelector("i").classList.add("fa-video"),i.classList.remove("bg-red"),i.querySelector("i").classList.remove("fa-video-slash"),i.setAttribute("data-isenabled","true"),enableVideo(),disableScreenShare(),removeHighlightArea())}),r.addEventListener("click",function(){var e,t,n=r.getAttribute("data-isenabled"),a=i.getAttribute("data-isenabled"),o=l.getAttribute("data-isenabled");n="true"===n?(r.setAttribute("data-isenabled","false"),"false"):(r.setAttribute("data-isenabled","true"),"true"),e=n,t=o,"true"===a&&"false"===t&&(c.localUserStream.getVideoTracks().forEach(function(e){e.stop()}),c.mediaContraints="true"===e?w:E,navigator.mediaDevices.getUserMedia(c.mediaContraints).then(function(e){e&&setVideoStream(e)}).catch(handleError))}),l.addEventListener("click",function(){var e=i.getAttribute("data-isenabled");"true"===l.getAttribute("data-isenabled")?(l.classList.remove("bg-white"),l.classList.add("bg-red"),l.setAttribute("data-isenabled","false"),disableScreenShare(),notifyMediaStreamingCommand("MediaPlayer","DisableAgentScreenHighlight",""),"true"===e&&enableVideo()):(l.classList.add("bg-white"),l.classList.remove("bg-red"),l.setAttribute("data-isenabled","true"),enableScreenShare(l),disableVideo())}),removeHighlightArea(),updateMediaStreamingPopup("",!0,!1,!1),document.body.appendChild(t),dragElement(t)}}function disableVideo(){c.localUserStream.getVideoTracks().forEach(function(e){return e.enabled=!1}),hideCameraSwitch()}function enableVideo(){setVideoStream(c.localUserStream),showCameraSwitch()}function disableScreenShare(){c.localDisplayStream&&(c.localDisplayStream.getTracks().forEach(function(e){return e.stop()}),c.localDisplayStream=null),showCameraSwitch(),removeHighlightArea()}function enableScreenShare(t){navigator.mediaDevices.getDisplayMedia().then(function(e){c.localDisplayStream=e;c.localDisplayStream.oninactive=function(e){return function(e,t){if(console.log("Screen share inactive"),t){var n=t.getAttribute("data-isenabled");"true"===n&&t.click()}}(0,t)},setVideoStream(c.localDisplayStream),console.log("Enable Agent Highlight"),notifyMediaStreamingCommand("MediaPlayer","EnableAgentScreenHighlight","")}).catch(function(e){e.message=e.message||"",e.message="Screen Sharing: "+e.message,trackError(e.message,!1),console.log("Error in displaying media",e);var t=document.getElementById("call-screenshare-toggle"),n=document.getElementById("call-video-toggle").getAttribute("data-isenabled");t.classList.remove("bg-white"),t.classList.add("bg-red"),t.setAttribute("data-isenabled","false"),disableScreenShare(),"true"===n&&enableVideo()}),hideCameraSwitch()}function showCameraSwitch(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e||(e=htmlToElement(h).querySelector("#call-camera-toggle"));1<S&&(console.log("Enabling camera button"),e.removeAttribute("hidden"))}function hideCameraSwitch(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e||(e=htmlToElement(h).querySelector("#call-camera-toggle"));console.log("Disbabling camera button"),e.setAttribute("hidden","true")}function setVideoStream(e){e.getVideoTracks().forEach(function(e){return e.enabled=!0}),c.localMediaElement.srcObject=e;for(var t=0;t<c.senders.length;t++){var n=c.senders[t];if(n&&n.track&&"video"===n.track.kind){n.replaceTrack(e.getVideoTracks()[0]);break}}}function htmlToElement(e){e=e.trim();var t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}function updateMediaStreamingPopup(e,t,n,a,o){console.log("updateMediaStreamingPopup"),c&&(c.messageBox&&(c.messageBox.innerText=e),c.startCallButton&&(t?(c.startCallButton.disabled=!1,c.startCallButton.classList.remove("k-hide")):(c.startCallButton.disabled=!0,c.startCallButton.classList.add("k-hide"))),c.acceptCallButton&&(n?(c.acceptCallButton.disabled=!1,c.acceptCallButton.classList.remove("k-hide")):(c.acceptCallButton.disabled=!0,c.acceptCallButton.classList.add("k-hide"))),c.endCallButton&&(a?(c.endCallButton.disabled=!1,c.endCallButton.classList.remove("k-hide")):(c.endCallButton.disabled=!0,c.endCallButton.classList.add("k-hide"))))}function handleStartCallButtonClicked(){updateMediaStreamingPopup("Waiting for agent to accept",!1,!1,!0),notifyMediaStreamingCommand("MediaPlayer","StartCall","")}function handleAcceptCallButtonClicked(){notifyChatWindow(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_ACCEPTED,isException:!1}),updateMediaStreamingPopup("Thanks for accepting, connecting with agent",!1,!1,!0),notifyMediaStreamingCommand("MediaPlayer","AcceptCall","")}function initializePeerConnection(){if(console.log("initializePeerConnection"),!c.peerConnection)try{var e=new RTCPeerConnection(l);e.onicecandidate=handleICECandidate,e.onnegotiationneeded=function(){console.log("creating offer"),e.createOffer().then(setLocalAndSendOffer).catch(handleError)},e.ontrack=handleRemoteStreamAdded,c.peerConnection=e,notifyChatWindow(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_CONNECTION_ESTABLISHED,isException:!1})}catch(e){console.log("Failed to initialize RTC Peer connection"),handleError(e),notifyChatWindow(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_CONNECTION_FAILED,isException:!1})}}function handleICECandidate(e){(console.log("handleICECandidate"),console.log("icecandidate event: ",e),e.candidate)?notifyMediaStreamingCommand("WebRtc","",{type:"candidate",data:e.candidate}):console.log("End of candidates.")}function handleRemoteStreamAdded(e){console.log("handleRemoteStreamAdded",e),c.remoteMediaElement&&(c.remoteMediaElement.srcObject=e.streams[0],console.log("Remote stream added to remote media element"),c.remoteMediaElement.autoplay=!0,c.remoteMediaElement.playsInline=!0,e.streams.forEach(function(e){e.onremovetrack=handleRemoteStreamRemoved,console.log("remote track ",e)}))}function handleRemoteStreamRemoved(e){console.log("Remote stream removed. Event: ",e)}function saveMediaAndAddTracks(t){console.log("saveMediaAndAddTracks"),c.localMediaElement.srcObject=t,initializePeerConnection(),c.senders||(c.senders=[]),t.getTracks().forEach(function(e){c.senders.push(c.peerConnection.addTrack(e,t)),console.log("local track ",e)})}function setLocalAndSendOffer(e){console.log("setLocalAndSendOffer"),c.peerConnection.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),notifyMediaStreamingCommand("WebRtc","",e)}function stopPeerConnection(){if(console.log("stopPeerConnection"),c.peerConnection&&(c.peerConnection.getSenders().forEach(function(e){c.peerConnection.removeTrack(e)}),c.peerConnection.close(),c.peerConnection=null),c.localMediaElement&&stopStreamedVideo(c.localMediaElement),c.remoteMediaElement&&stopStreamedVideo(c.remoteMediaElement),stopActiveStreams(c.localUserStream),stopActiveStreams(c.localDisplayStream),updateMediaStreamingPopup("Call disconnected",!0,!1,!1),notifyChatWindow(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_CONNECTION_CLOSED,isException:!1}),r){var e=((new Date).valueOf()-r.valueOf())/1e3;console.log("Call duration in seconds = "+e)}}function stopStreamedVideo(e){(console.log("stopStreamedVideo"),e&&e.srcObject)&&(e.srcObject.getTracks().forEach(function(e){e.stop()}),e.srcObject=null)}function stopActiveStreams(e){console.log("stopping streams"),e&&e.getTracks().forEach(function(e){return e.stop()})}function closeCallPopup(){console.log("closeCallPopup");var e=document.querySelector(".kenyt-media-container");e&&e.remove()}function removeHighlightArea(){console.log("Removing highlight area");var e=document.getElementById(v);e&&e.remove()}function dragElement(t){var n=0,a=0,o=0,i=0;function elementDrag(e){(e=e||window.event).preventDefault(),n=o-e.clientX,a=i-e.clientY,o=e.clientX,i=e.clientY,t.style.top=t.offsetTop-a+"px",t.style.left=t.offsetLeft-n+"px"}function closeDragElement(){document.onmouseup=null,document.onmousemove=null}t.onmousedown=function(e){(e=e||window.event).preventDefault(),o=e.clientX,i=e.clientY,document.onmouseup=closeDragElement,document.onmousemove=elementDrag}}return g&&g.addEventListener("click",openChatWindow),f&&f.addEventListener("mouseover",function(){notifyChatWindow(A.WindowHover)}),window.addEventListener("click",function(){resetHeight()}),window.addEventListener("touchstart",function(){resetHeight()}),window.addEventListener("message",function(e){if("object"===P(e.data)&&e.data.type){var t=e.data;if(t.type===A.ChatWindowOpen)openChatWindow();else if(t.type===A.ChatWindowClose)closeChatWindow();else if(t.type===A.ToggleFullScreen)!function(e){var t=document.querySelector("#chatbox-container");e&&t&&("maximize"===e?t.classList.add("force-fullscreen"):"minimize"===e&&t.classList.remove("force-fullscreen"));updateAmpFrameWindowSize()}(t.value);else if(t.type===A.ForceFullHeight)!function(){f&&!f.classList.contains("force-fullscreen")&&f.classList.add("full-height");updateAmpFrameWindowSize()}();else if(t.type===A.FullScreenImage)!function(l){var e=document.querySelector("body"),r=document.createElement("div");r.classList.add("kenyt-fullscreen-container"),r.setAttribute("current-slide-number",l.currentSlideNumber);var t=document.createElement("div");t.classList.add("next","navigation"),t.addEventListener("click",function(){plusSlides(r,1)}),t.textContent="❯";var n=document.createElement("div");n.classList.add("prev","navigation"),n.addEventListener("click",function(){plusSlides(r,-1)}),n.textContent="❮";var a=document.createElement("span");a.innerHTML="&times;",a.classList.add("kenyt-popup-close"),a.addEventListener("click",function(){hideFullScreenContainer()}),r.appendChild(n),r.appendChild(t);var s=1;function hideFullScreenContainer(){var e=document.querySelector(".kenyt-fullscreen-container");e&&e.remove(),document.removeEventListener("keyup",onKeyPress)}l.slides.forEach(function(e){var t=document.createElement("div");t.classList.add("img-card");var n=document.createElement("div");n.classList.add("numberText","text"),n.textContent=s+"/"+l.slides.length;var a=document.createElement("div");a.classList.add("img-container");var o=document.createElement("img");o.src=e.imageUrl;var i=document.createElement("div");i.classList.add("captionText","text"),i.textContent=e.caption,a.appendChild(o),t.appendChild(n),t.appendChild(a),t.appendChild(i),r.appendChild(t),s++}),r.appendChild(a),setSlideByNumber(r,l.currentSlideNumber),e.appendChild(r),document.addEventListener("keyup",onKeyPress),document.activeElement&&document.activeElement.blur();document.focus&&document.focus();function onKeyPress(e){27===e.keyCode?hideFullScreenContainer():37===e.keyCode?plusSlides(r,-1):39===e.keyCode&&plusSlides(r,1)}}(t.value);else if(t.type===A.NavigateToPage){var n=t.value;!function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e?t?window.location.href=e:window.open(e,"_blank"):console.warn("[Kenyt.AI] Cannot navigate to page - Invalid URL")}(n.url,n.openInSamePage||!1)}else if(t.type===A.TextColor)g.style.color=t.value||g.style.color;else if(t.type===A.Initialize)m=t.value,function(){var e=readFromLocalStorage(b);if(e)if(e.SessionId===m){if(e.Updated)return console.debug("Tracking data already sent");e.History||(e.History=[]),e.History.push(getCurrentPageInfo())}else e=getCurrentTrackingSession();else e=getCurrentTrackingSession();writeToLocalStorage(b,e)}(),notifyChatWindow(A.GetPageTitle,document.title||""),notifyChatWindow(A.GetReferrer,document.referrer||"");else if(t.type===A.PageInfoRequest)!function(){var e=readFromLocalStorage(b);e||(e=getCurrentTrackingSession());void 0!==e.History&&0<e.History.length&&notifyChatWindow(A.PageInfoResponse,e.History);e.Updated=!0,e.History=[],writeToLocalStorage(b,e)}();else if(t.type===A.CustomEventDispatch){var a=t.value;if(a){var o=new CustomEvent("kenytEvent",{detail:{eventType:a.EventName||null,data:a.EventData||null},bubbles:!0});document.dispatchEvent(o)}}else if(t.type===A.UpdateChatBubbleColor){if(t.value){var i=g.getElementsByClassName("kprimary-bg");Array.from(i).forEach(function(e){e.style.backgroundColor=t.value}),i=g.getElementsByClassName("kprimary-color"),Array.from(i).forEach(function(e){e.style.color=t.value}),i=g.getElementsByClassName("kprimary-border"),Array.from(i).forEach(function(e){e.style.borderColor=t.value})}}else if(t.type===A.UpdateBotPosition&&t.value){var l=t.value.toLowerCase();k[l]&&(Object.keys(k).forEach(function(e){g.classList.remove(k[e]),f.classList.remove(k[e])}),g.classList.add(k[l]),f.classList.add(k[l]))}else t.type===A.MediaStreamingCommand?function(e){console.log("handleMediaStreamingCommand");var t=JSON.parse(JSON.stringify(e));console.log("Incoming Signal : ",t),"MediaPlayer"===e.Type?(a=e,console.log("handleMediaPlayerCommands",a),console.log("command: "+(a.Command||"<empty>")),"OpenMediaPlayer"===a.Command?(showCallPopup(a.Data),notifyMediaStreamingCommand("Log","OpenMediaPlayerCommand Executed","")):"CloseMediaPlayer"===a.Command?(function(){console.log("closeCallPopup"),stopPeerConnection();var e=document.querySelector(".kenyt-media-container");e&&e.remove()}(),notifyMediaStreamingCommand("Log","CloseMediaPlayerCommand Executed","")):"StartCall"===a.Command?(showCallPopup(a.Data),notifyMediaStreamingCommand("Log"," Executed","")):"AcceptCall"===a.Command?notifyMediaStreamingCommand("Log","AcceptCallCommand Executed",""):"EndCall"===a.Command?(stopPeerConnection(),closeCallPopup(),notifyMediaStreamingCommand("Log","End Call Command Executed","")):"ScreenHighlightStarted"===a.Command?(o=a.Data,console.log("highlighting screen",o),function(e){console.log("Adding highlight area");var t=htmlToElement(C);if(t.setAttribute("id",v),t&&t.style){var n=window.screen.availHeight,a=window.screen.availWidth,o=n/e.WindowHeight,i=a/e.WindowWidth,l=o*e.Top;e.IsFullScreen||e.Bottom,t.style.left=i*e.Left+"px",t.style.right=i*e.Right+"px",t.style.height=o*e.Height+"px",t.style.width=i*e.Width+"px",t.style.top=l+"px",t.style.X=i*e.X,t.style.Y=o*e.Y,t.style.visibility="visible",document.body.appendChild(t)}}(o)):"ScreenHighlightEnded"===a.Command&&(console.log("highlight screen ended"),removeHighlightArea())):"WebRtc"===e.Type?function(e){if("answer"===e.type)console.log("received answer"),initializePeerConnection(),c.peerConnection&&(console.log("setting remote description"),c.peerConnection.setRemoteDescription(e).then(function(){console.log("remote description set successfully")}).catch(function(){console.log("remote description set failed")}));else if("candidate"===e.type&&(initializePeerConnection(),c.peerConnection)){var t=new RTCIceCandidate({sdpMLineIndex:e.data.sdpMLineIndex,candidate:e.data.candidate});c.peerConnection.addIceCandidate(t)}if("offer"===e.type&&(initializePeerConnection(),c.peerConnection)){navigator.mediaDevices.getUserMedia(c.mediaContraints).then(function(e){c.localUserStream=e}),saveMediaAndAddTracks(c.localUserStream),c.peerConnection.setRemoteDescription(new RTCSessionDescription(e)),console.log("creating answer");c.peerConnection.createAnswer({offerToReceiveVideo:!0,offerToReceiveAudio:!0}).then(function(e){console.log("created answer successfully"),c.peerConnection.setLocalDescription(e),notifyMediaStreamingCommand("WebRtc","",e)}).catch(this.handleError),this.state="Connected with user"}}(e.Data):"Broadcast"===e.Type?function(e){if("IncomingCall"===e.Command)!function(){console.log("showIncomingCallPopup");var e=htmlToElement(y);e.setAttribute("id",u),e.querySelector("#accept-video-call").addEventListener("click",function(){closeIncomingCallPopup(),c.mediaContraints=E,showCallPopup(null),handleAcceptCallButtonClicked(),r=new Date}),e.querySelector("#reject-call").addEventListener("click",function(){closeIncomingCallPopup(),updateMediaStreamingPopup("Rejected the call with agent",!1,!1,!0),notifyChatWindow(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_REJECTED,isException:!1}),notifyMediaStreamingCommand("MediaPlayer","RejectCall",""),console.log("Rejected Call")}),document.body.appendChild(e),function(){var e=document.getElementById(d);e||(e=function(){var e=document.createElement("audio");e.setAttribute("preload","auto"),e.setAttribute("autobuffer",""),e.setAttribute("loop",""),e.setAttribute("id",d);var t=document.createElement("source");return t.src=p.CALL_RING_SOUND,e.appendChild(t),document.body.appendChild(e),e}());window.setTimeout(function(){e.currentTime=0,e.play()},0)}()}(),notifyChatWindow(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_INCOMING,isException:!1});else if("CallAccepted"===e.Command)updateMediaStreamingPopup("Call Accepted",!1,!1,!0);else if("InitiateMediaConnection"===e.Command){if(c&&(initializePeerConnection(),c.peerConnection))try{navigator.mediaDevices.getUserMedia(c.mediaContraints).then(function(e){c.localUserStream=e,saveMediaAndAddTracks(c.localUserStream)})}catch(e){handleError(e)}updateMediaStreamingPopup("Initiating Connection",!1,!1,!0)}else"CallDisconnected"!==e.Command&&"CallMissed"!==e.Command||(notifyChatWindow(A.ReportGoogleAnalyticsEvent,{eventName:s.EVENT_USER_CALL_DISCONNECT_SERVER,isException:!1}),stopPeerConnection(),closeIncomingCallPopup(),updateMediaStreamingPopup(e.Command,!0,!1,!1),setTimeout((closeCallPopup(),void notifyMediaStreamingCommand("MediaPlayer","CloseMediaPlayer","")),L))}(e):"UserChat"===e.Type&&"StartCall"===(n=e).Command&&(console.log("User wants to start call from chat"),showCallPopup(n.data),handleStartCallButtonClicked());var n;var a,o}(t.value):t.type===A.OpenRazorpayForm?function(e){var t=document.getElementById("krazorpay-btn"),n=document.getElementById(e.OrderId);if(n){var a=n.getElementsByTagName("input")[0];a.click()}else{t.innerHTML="";var o=function(a){var e=document.createElement("form");e.setAttribute("id",a.OrderId),e.setAttribute("class","option-pill pointer");var t=document.createElement("script");t.setAttribute("src","https://checkout.razorpay.com/v1/checkout.js"),a.Callback&&a.CallbackUrl?t.setAttribute("data-callback_url",a.CallbackUrl):(t.setAttribute("data-key",a.RazorpayKeyId),t.setAttribute("data-amount",a.Amount),t.setAttribute("data-currency",a.Currency),t.setAttribute("data-order_id",a.OrderId),t.setAttribute("data-buttontext",a.ButtonText),t.setAttribute("data-name",a.Name),t.setAttribute("data-description",a.Description),t.setAttribute("data-prefill.name",a.LeadName),t.setAttribute("data-prefill.email",a.LeadEmail),t.setAttribute("data-prefill.contact",a.LeadPhone),t.setAttribute("data-theme.color",a.FrameColor),e.setAttribute("action","javascript:kenytChatBubbleJs.onRazorpayPaymentSuccess("+a.OrderId+")"));return t.addEventListener("load",function(e){if(a.Callback&&a.CallbackUrl){var t={key:a.RazorpayKeyId,currency:a.Currency,name:a.Name,description:a.Description,order_id:a.OrderId,callback_url:a.CallbackUrl,prefill:{name:a.LeadName,email:a.LeadEmail,contact:a.LeadPhone},theme:{color:a.FrameColor}},n=new Razorpay(t);n.on("payment.failed",function(e){}),n.open()}else this.nextElementSibling.click()}),e.appendChild(t),e.addEventListener("click",function(e){e.stopPropagation()}),e}(e);t.appendChild(o)}}(t.value):t.type===A.OpenCashfreeForm&&function(e){var t=document.getElementById("kcashfree-btn"),n=document.getElementById(e.OrderId);if(void 0!==e.OrderId&&n){var a=n.getElementsByTagName("input")[0];a.click()}else{t.innerHTML="";var o=function(t){var e=document.createElement("form");e.setAttribute("id",t.OrderId),e.setAttribute("class","option-pill pointer");var n=document.createElement("script");n.setAttribute("src","https://sdk.cashfree.com/js/v3/cashfree.js");var a={},o=null;return n.addEventListener("load",function(e){t.paymentSessionId?(o=Cashfree({mode:"production"}),a={paymentSessionId:t.paymentSessionId,redirectTarget:"_modal"},o.checkout(a).then(function(e){e.error&&(console.log("User has closed the popup or there is some payment error, Check for Payment Status"),console.log(e.error)),e.redirect&&console.log("Payment will be redirected"),e.paymentDetails&&(console.log("Payment has been completed, Check for Payment Status"),console.log(e.paymentDetails.paymentMessage),document.getElementById("kcashfree-btn").innerHTML="")})):this.nextElementSibling.click()}),e.appendChild(n),e.addEventListener("click",function(e){e.stopPropagation()}),e}(e);t.appendChild(o)}}(t.value)}},!1),isMobileDevice()&&"https://www.kenyt.ai/botapp/chatbotui/test.html?botname=13"===window.location.href&&window.visualViewport&&(T=window.visualViewport.height,window.visualViewport.addEventListener("resize",function(){var e=window.visualViewport.height,t=T-e;if(150<Math.abs(t)&&isMobileDevice()){var n=Math.max(t,0);console.log("Detected keyboard height:",n),0===n?f.style.removeProperty("height"):f.style.cssText="height: calc(93vh - "+n+"px) !important;"}T=e})),updateAmpFrameWindowSize(),function(){var e=null,t=null,n={},a=window.location.search.split("?");if(1<a.length){var o=a[1].split("&");if(0<o.length)for(var i in o){var l=o[i].split("=");if(1<l.length){var r=l[0],s=l[1];n[r]=s}}}if(null!=n.aId&&(t=n.aId),t?function(e,t,n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var o="expires="+a.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"}("aId",t,15):t=function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}("aId"),t&&(console.log("activityid:"+t),e=p.TRACKING_URL_PREFIX+t),e){var c=new XMLHttpRequest;c.open("POST",e,!0),c.send()}}(),{onRazorpayPaymentSuccess:function(e){for(var t={},n=e.getElementsByTagName("input"),a=0;a<n.length;a++){var o=n[a],i=o.getAttribute("name"),l=o.getAttribute("value");i&&l&&(t[i]=l)}document.getElementById("krazorpay-btn").innerHTML="",notifyChatWindow(A.SubmitRazorpayPayment,t)},notifyChatWindow:notifyChatWindow}}();